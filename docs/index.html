<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>FeedHenry Mobile Security</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:90%;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}

</style>
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f0f3f3; }
.listingblock .pygments .tok-c { color: #0099FF; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { color: #AA0000; background-color: #FFAAAA } /* Error */
.listingblock .pygments .tok-k { color: #006699; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #555555 } /* Operator */
.listingblock .pygments .tok-cm { color: #0099FF; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #009999 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #0099FF; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #0099FF; font-weight: bold; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { background-color: #FFCCCC; border: 1px solid #CC0000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #003300; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { background-color: #CCFFCC; border: 1px solid #00CC00 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #AAAAAA } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000099; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #003300; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #99CC66 } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #006699; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #006699; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #006699; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #006699 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #006699; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #007788; font-weight: bold } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #FF6600 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #CC3300 } /* Literal.String */
.listingblock .pygments .tok-na { color: #330099 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #336666 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #00AA88; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #336600 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #9999FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #CC0000; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #CC00FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #9999FF } /* Name.Label */
.listingblock .pygments .tok-nn { color: #00CCFF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #330099; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #003333 } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #000000; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #FF6600 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #FF6600 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #FF6600 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #FF6600 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #FF6600 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #CC3300 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #CC3300 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #CC3300; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #CC3300 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #CC3300; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #CC3300 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #AA0000 } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #CC3300 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #33AAAA } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #CC3300 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #FFCC33 } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #336666 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #003333 } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #003333 } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #003333 } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #FF6600 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#feedhenry_mobile_security">FeedHenry Mobile Security</a>
<ul class="sectlevel1">
<li><a href="#mobile_security_recommendations_overview">1. Mobile Security Recommendations Overview</a>
<ul class="sectlevel2">
<li><a href="#authentication_session_management">1.1. Authentication &amp; Session Management</a></li>
<li><a href="#data_storage_summary">1.2. Data Storage Summary</a></li>
<li><a href="#network_security">1.3. Network Security</a></li>
<li><a href="#mobile_app_self_defence">1.4. Mobile App Self-Defence</a></li>
<li><a href="#handling_sensitive_data_overview">1.5. Handling Sensitive Data Overview</a></li>
<li><a href="#cryptography_summary">1.6. Cryptography Summary</a></li>
</ul>
</li>
<li><a href="#references_2">2. References</a>
<ul class="sectlevel2">
<li><a href="#owasp_top_10_mobile_risks">2.1. OWASP Top 10 Mobile Risks</a></li>
<li><a href="#mobile_application_security_requirements">2.2. Mobile Application Security Requirements</a></li>
<li><a href="#secure_mobile_development_guidelines">2.3. Secure Mobile Development Guidelines</a></li>
<li><a href="#owasp_cheat_sheet_series">2.4. OWASP Cheat Sheet Series</a></li>
<li><a href="#owasp_mobile_verification_standard">2.5. OWASP Mobile Verification Standard</a></li>
<li><a href="#owasp_threat_model_project">2.6. OWASP Threat Model Project</a></li>
<li><a href="#owasp_m_tools">2.7. OWASP M-Tools</a></li>
<li><a href="#ios_security_whitepaper">2.8. iOS Security Whitepaper</a></li>
<li><a href="#android_security_guide">2.9. Android Security Guide</a></li>
<li><a href="#android_developer_security_guide">2.10. Android Developer Security Guide</a></li>
<li><a href="#cordova_security_guide">2.11. Cordova Security Guide</a></li>
<li><a href="#vetting_the_security_of_mobile_applications">2.12. Vetting the Security of Mobile Applications</a></li>
<li><a href="#niap_mobile_app_vetting">2.13. NIAP Mobile App Vetting</a></li>
<li><a href="#dhs_study_on_mobile_device_security">2.14. DHS Study on Mobile Device Security</a></li>
<li><a href="#guidelines_for_managing_the_security_of_mobile_devices_in_the_enterprise">2.15. Guidelines for Managing the Security of Mobile Devices in the Enterprise</a></li>
<li><a href="#mobile_banking_applications_security_challenges">2.16. Mobile Banking Applications Security Challenges</a></li>
<li><a href="#secure_mobile_development_guide">2.17. Secure Mobile Development Guide</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="assets/fh_redhat_logo.png" alt="fh redhat logo">
</div>
</div>
<h1 id="feedhenry_mobile_security" class="sect0">FeedHenry Mobile Security</h1>
<div class="sect1">
<h2 id="mobile_security_recommendations_overview">1. Mobile Security Recommendations Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="authentication_session_management">1.1. Authentication &amp; Session Management</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Do&#8217;s</th>
<th class="tableblock halign-left valign-top">Dont&#8217;s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Perform Authentication on the Server Side.</strong> <em>(The client side should never be trusted)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use the Fingerprint Scanner solely for Authentication.</strong> <em>(Possible False Positives [1])</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use Randomly Generated access tokens instead of sending user credentials in requests.</strong> <em>(At worst, a temporary session token can therefore only be stolen)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use Pattern Locks for Authentication.</strong> <em>(Lack of Entropy, Vulnerable to Smudge Attacks [2])</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>A password policy is enforced at the remote endpoint.</strong> <em>(Prevent easily guessable passwords from being used)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use a short Pin code solely authentication.</strong> <em>(Easily brute forced and the end user may reuse the device security pin)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sessions are terminated at the remote endpoint after a predefined time.</strong> <em>(Sessions token lifetimes should be kept short to limit the attack window if an valid session token is stolen)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Do not use any values for authenticating a user like device identifiers or geo-location.</strong> <em>(These can be spoofed easily)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Temporarily lock out a user after a number of failed login attempts.</strong> <em>(Prevent an endless brute force attack)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Avoid relying on any roles or permission information that comes from the mobile device itself.</strong> <em>(The client side and user input should not be trusted)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use contextual anomaly based detection to take into account the users IP, geographic location, time of day as part of the authentication phase.</strong> <em>(Helps detect unusual login activity)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Log user related information.</strong> <em>(Personal information data leak)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>A second factor of authentication exists and is enforced.</strong> <em>(Extra layer of protection in case another authentication factor has been compromised)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fail authentication with a Generic Error.</strong> <em>(The login screen should not show hints on the existence of a username/email address etc)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Step-up authentication is used for carrying out sensitive actions in an application.</strong> <em>(Useful when a user&#8217;s device is stolen and they have already authenticated through the app)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use OAuth1.0</strong>. <em>(OAuth1.0 has been found to be vulnerable to session fixation. Use OAuth 1.0a or OAuth 2.0 instead)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow the user to see their current login sessions and allow them to logout of other sessions via the app.</strong> <em>(The end user will be able to detect rogue sessions with the most accuracy instead of using anomaly detection)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Perform local integrity checks within the code to detect any unauthorized code changes before doing offline authentication.</strong> <em>(Tampering may allow authentication bypasses)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Where offline access to data is needed, perform an account/application lockout and/or application data wipe after X number of invalid password attempts.</strong> <em>(Wipe application data when a threat is imminent)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Perform a check at the start of each activity/screen to see if the user is in a logged in state and if not, switch to the login state.</strong> <em>(A session could expire during use or over time. Also check that the user has a role that allows them to access to certain app view).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>When an application’s session is timed out, the application should discard and clear all memory associated with the user data, and any master keys used to decrypt the data.</strong> <em>(Prevent data leakage after the user is no longer in an active session with the server).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Store a masked user identifier instead of the actual username, and replace the user identifier value in authentication with a hash value.</strong> <em>(If a username/id is being used in the mobile app for identification purposes only (not for display in the UI), then consider sending a related mapped token to the mobile device instead.)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Implement Secure Password Recovery Mechanism</strong>. <em>(To allow a user to recover their account using security questions only they should know the answers too and sending a recovery code using a side channel such as SMS)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="references">1.1.1. References</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The probability of a random person unlocking a given iPhone with Touch ID is 1 in 50,000. <a href="https://support.apple.com/en-ie/HT204587">Apple Support</a></p>
</li>
<li>
<p>Penn State researchers managed to identify the pass code patterns on two smartphones, 68% of the time, using photographs taken under different lighting conditions, and camera positions. <a href="https://www.usenix.org/legacy/events/woot10/tech/full_papers/Aviv.pdf">Smudge Attacks on Smartphone Touch Screens</a></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="implementation">1.1.2. Implementation</h4>
<div class="sect4">
<h5 id="overview">Overview</h5>
<div class="paragraph">
<p>An Authentication &amp; Session Management implementation has been provided in our <a href="https://github.com/feedhenry/mobile-security-android-template">Mobile Security Android Template</a> App.</p>
</div>
<div class="paragraph">
<p>The Application uses <a href="http://openid.net/connect/">OpenID Connect</a> for authentication and access control. The Open Source Identity and Access Management server, <a href="http://www.keycloak.org">Keycloak</a>, is being used as an Identity Broker.
The OpenID library <a href="https://github.com/openid/AppAuth-Android">AppAuth-Android</a> is being used for communicating with an OpenID Connect Provider/Broker.</p>
</div>
<div class="paragraph">
<p>The Keycloak server is enforcing a number of Security Controls on the mobile app.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://github.com/feedhenry/mobile-security/blob/master/projects/keycloak/secure-app-realm.json#L6-L11">Brute force detection</a> on the login screen.</p>
</li>
<li>
<p><a href="https://github.com/feedhenry/mobile-security/blob/master/projects/keycloak/secure-app-realm.json#L12">Account lockouts</a> for failed login attempts.</p>
</li>
<li>
<p><a href="https://github.com/feedhenry/mobile-security/blob/master/projects/keycloak/secure-app-realm.json#L101">2FA</a> for mobile users.</p>
</li>
<li>
<p><a href="http://www.keycloak.org/docs/latest/server_admin/topics/sessions/administering.html">Session management</a> for mobile users.</p>
</li>
<li>
<p><a href="https://github.com/feedhenry/mobile-security/blob/master/projects/keycloak/secure-app-realm.json#L13-L17">Audit tracing</a> of auth events.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="code_examples">Code Examples</h5>
<div class="paragraph">
<p>The main code logic is found under <a href="https://github.com/feedhenry/mobile-security-android-template/tree/master/app/src/main/java/com/feedhenry/securenativeandroidtemplate/features/authentication">mobile-security-android-template/&#8230;&#8203;/authentication</a>.</p>
</div>
<div class="paragraph">
<p>There is also an <a href="https://github.com/feedhenry/mobile-security-android-template/blob/master/app/src/main/java/com/feedhenry/securenativeandroidtemplate/mvp/components/AuthHelper.java">authentication helper class</a> for retrieving information about the users auth state from other places inside the app.</p>
</div>
<div class="paragraph">
<p>The following code snippets below describe the main authentication code logic in the mobile app.</p>
</div>
<div class="sect5">
<h6 id="openid_connect_performing_the_authentication_request">OpenID Connect: Performing the Authentication Request</h6>
<div class="paragraph">
<p>This function is used to perform a redirect to the Identity Providers login screen. The OpenID Connect Auth and Token endpoints must be specified to make AppAuth aware of the URI used to perform the authentication on, as well as the URI used to perform the token exchange.
Once we have setup the necessary AppAuth configuration, we can create the new Authorization Request. Here, we provide the endpoints for the OpenID Connect provider as well as the client ID, response type and redirect URI. We then perform the auth request and create a new intent which will handle the auth response from the system browser. The authentication phase will occur in a system browser in a safe context outside of the application.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Create the config for the initial Keycloak auth request to get a temporary token and create an intent to handle the response</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">performAuthRequest</span><span class="tok-o">(</span><span class="tok-n">Activity</span> <span class="tok-n">fromActivity</span><span class="tok-o">,</span> <span class="tok-n">Callback</span> <span class="tok-n">authCallback</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authCallback</span> <span class="tok-o">=</span> <span class="tok-n">authCallback</span><span class="tok-o">;</span>
    <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authenticationConfiguration</span><span class="tok-o">.</span><span class="tok-na">isValid</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authCallback</span><span class="tok-o">.</span><span class="tok-na">onError</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authenticationConfiguration</span><span class="tok-o">.</span><span class="tok-na">getConfigurationError</span><span class="tok-o">());</span>
        <span class="tok-k">return</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-c1">// Setup the config for the AuthorizationService</span>
    <span class="tok-n">serviceConfig</span> <span class="tok-o">=</span>
            <span class="tok-k">new</span> <span class="tok-nf">AuthorizationServiceConfiguration</span><span class="tok-o">(</span>
                    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authenticationConfiguration</span><span class="tok-o">.</span><span class="tok-na">getAuthenticationEndpoint</span><span class="tok-o">(),</span> <span class="tok-c1">// the clients keycloak authorization endpoint</span>
                    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authenticationConfiguration</span><span class="tok-o">.</span><span class="tok-na">getTokenEndpoint</span><span class="tok-o">());</span> <span class="tok-c1">// the clients keycloak token endpoint</span>

    <span class="tok-c1">// Persist the AuthorizationServiceConfiguration</span>
    <span class="tok-n">authState</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">AuthState</span><span class="tok-o">(</span><span class="tok-n">serviceConfig</span><span class="tok-o">);</span>

    <span class="tok-c1">// Prevent the app opening the keycloak view in chrome custom tabs, instead open it in the native browser</span>
    <span class="tok-n">AppAuthConfiguration</span> <span class="tok-n">appAuthConfig</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AppAuthConfiguration</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">setBrowserMatcher</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">BrowserBlacklist</span><span class="tok-o">(</span>
                    <span class="tok-n">VersionedBrowserMatcher</span><span class="tok-o">.</span><span class="tok-na">CHROME_CUSTOM_TAB</span><span class="tok-o">))</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>

    <span class="tok-c1">// create a new auth service with the auth config</span>
    <span class="tok-n">authService</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">AuthorizationService</span><span class="tok-o">(</span><span class="tok-n">context</span><span class="tok-o">,</span> <span class="tok-n">appAuthConfig</span><span class="tok-o">);</span>

    <span class="tok-n">AuthorizationRequest</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-n">authRequestBuilder</span> <span class="tok-o">=</span>
            <span class="tok-k">new</span> <span class="tok-n">AuthorizationRequest</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">(</span>
                    <span class="tok-n">serviceConfig</span><span class="tok-o">,</span> <span class="tok-c1">// the authorization service configuration</span>
                    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authenticationConfiguration</span><span class="tok-o">.</span><span class="tok-na">getClientId</span><span class="tok-o">(),</span> <span class="tok-c1">// the client ID, typically pre-registered and static</span>
                    <span class="tok-n">ResponseTypeValues</span><span class="tok-o">.</span><span class="tok-na">CODE</span><span class="tok-o">,</span> <span class="tok-c1">// the response_type value: we want a code</span>
                    <span class="tok-n">REDIRECT_URI</span><span class="tok-o">)</span> <span class="tok-c1">// the redirect URI to which the auth response is sent</span>
                    <span class="tok-o">.</span><span class="tok-na">setScopes</span><span class="tok-o">(</span><span class="tok-n">OPEN_ID_SCOPE</span><span class="tok-o">);</span>

    <span class="tok-n">authRequest</span> <span class="tok-o">=</span> <span class="tok-n">authRequestBuilder</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-c1">// perform the auth request</span>
    <span class="tok-n">Intent</span> <span class="tok-n">authIntent</span> <span class="tok-o">=</span> <span class="tok-n">authService</span><span class="tok-o">.</span><span class="tok-na">getAuthorizationRequestIntent</span><span class="tok-o">(</span><span class="tok-n">authRequest</span><span class="tok-o">);</span>
    <span class="tok-n">fromActivity</span><span class="tok-o">.</span><span class="tok-na">startActivityForResult</span><span class="tok-o">(</span><span class="tok-n">authIntent</span><span class="tok-o">,</span> <span class="tok-n">Constants</span><span class="tok-o">.</span><span class="tok-na">REQUEST_CODES</span><span class="tok-o">.</span><span class="tok-na">AUTH_CODE</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="openid_connect_handling_the_authentication_response">OpenID Connect: Handling the Authentication Response</h6>
<div class="paragraph">
<p>Once the Authentication phase has ended, the user will be redirected back to the mobile app from the system browser.
A check is performed in the MainActivity for incoming intents. Any incoming intents that match the Android auth response intent will be directed to the below function.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Checks if the incoming intent matches the Keycloak Auth response intent</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @param intent - the intent to check</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onAuthResult</span><span class="tok-o">(</span><span class="tok-nd">@Nullable</span> <span class="tok-n">Intent</span> <span class="tok-n">intent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">intent</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">handleAuthorizationResponse</span><span class="tok-o">(</span><span class="tok-n">intent</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the intent is not null, we inspect it to check whether the authentication was successful or not. If the authentication failed, we are handling this in another function which will display a failure message to the user.
If the authentication was a success, we then make a call to the <code>exchangeToken()</code> function to swap our temporary token for the identity, access and refresh tokens.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Handles the initial auth response and create a new request to the token endpoint to get the actual tokens</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @param intent - the auth response intent</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">handleAuthorizationResponse</span><span class="tok-o">(</span><span class="tok-n">Intent</span> <span class="tok-n">intent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">AuthorizationResponse</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">AuthorizationResponse</span><span class="tok-o">.</span><span class="tok-na">fromIntent</span><span class="tok-o">(</span><span class="tok-n">intent</span><span class="tok-o">);</span>
    <span class="tok-n">AuthorizationException</span> <span class="tok-n">error</span> <span class="tok-o">=</span> <span class="tok-n">AuthorizationException</span><span class="tok-o">.</span><span class="tok-na">fromIntent</span><span class="tok-o">(</span><span class="tok-n">intent</span><span class="tok-o">);</span>

    <span class="tok-c1">// update the auth state</span>
    <span class="tok-n">authState</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">,</span> <span class="tok-n">error</span><span class="tok-o">);</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">exchangeTokens</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-n">authFailed</span><span class="tok-o">(</span><span class="tok-n">error</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="openid_connect_exchanging_tokens">OpenID Connect: Exchanging Tokens</h6>
<div class="paragraph">
<p>Here, we send our temporary token to the the token endpoint on the OpenID Connect provider. If this token is valid, we will receive an access, identity and refresh token.
We can now form an Identity for the logged in user based on the tokens being returned.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Token exchange against the token endpoint</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @param response - the auth response from the intent/server</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">exchangeTokens</span><span class="tok-o">(</span><span class="tok-n">AuthorizationResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">authService</span><span class="tok-o">.</span><span class="tok-na">performTokenRequest</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">createTokenExchangeRequest</span><span class="tok-o">(),</span> <span class="tok-k">new</span> <span class="tok-n">AuthorizationService</span><span class="tok-o">.</span><span class="tok-na">TokenResponseCallback</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nd">@Override</span>
        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onTokenRequestCompleted</span><span class="tok-o">(</span><span class="tok-nd">@Nullable</span> <span class="tok-n">TokenResponse</span> <span class="tok-n">tokenResponse</span><span class="tok-o">,</span> <span class="tok-nd">@Nullable</span> <span class="tok-n">AuthorizationException</span> <span class="tok-n">exception</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">tokenResponse</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">authState</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-n">tokenResponse</span><span class="tok-o">,</span> <span class="tok-n">exception</span><span class="tok-o">);</span>
                <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">writeAuthState</span><span class="tok-o">(</span><span class="tok-n">authState</span><span class="tok-o">);</span>

                <span class="tok-n">JSONObject</span> <span class="tok-n">decodedIdentityData</span> <span class="tok-o">=</span> <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">getIdentityInformation</span><span class="tok-o">();</span>
                <span class="tok-n">Identity</span> <span class="tok-n">newIdentity</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Identity</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;());</span>

                <span class="tok-k">try</span> <span class="tok-o">{</span>
                    <span class="tok-n">newIdentity</span> <span class="tok-o">=</span> <span class="tok-n">Identity</span><span class="tok-o">.</span><span class="tok-na">fromJson</span><span class="tok-o">(</span><span class="tok-n">decodedIdentityData</span><span class="tok-o">);</span>
                <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">JSONException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                    <span class="tok-n">Log</span><span class="tok-o">.</span><span class="tok-na">i</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Decoding Access Token Failed&quot;</span><span class="tok-o">,</span> <span class="tok-n">e</span><span class="tok-o">);</span>
                <span class="tok-o">}</span>

                <span class="tok-n">authSuccess</span><span class="tok-o">(</span><span class="tok-n">newIdentity</span><span class="tok-o">);</span>
            <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
                <span class="tok-n">authFailed</span><span class="tok-o">(</span><span class="tok-n">exception</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">});</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="openid_connect_logout">OpenID Connect: Logout</h6>
<div class="paragraph">
<p>To logout of the application, we must make a call to the logout endpoint on the OpenID Connect provider along with providing the identity token and a redirect URI.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Perform a logout request against the openid connect server</span>
<span class="tok-cm"> * @param logoutCallback - the logout callback</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">logout</span><span class="tok-o">(</span><span class="tok-n">Callback</span> <span class="tok-n">logoutCallback</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">logoutCallback</span> <span class="tok-o">=</span> <span class="tok-n">logoutCallback</span><span class="tok-o">;</span>
    <span class="tok-n">String</span> <span class="tok-n">identityToken</span> <span class="tok-o">=</span> <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">getIdentityToken</span><span class="tok-o">();</span>

    <span class="tok-c1">// Construct the Keycloak logout URL</span>
    <span class="tok-n">String</span> <span class="tok-n">logoutRequestUri</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authenticationConfiguration</span><span class="tok-o">.</span><span class="tok-na">getLogoutUrl</span><span class="tok-o">(</span><span class="tok-n">identityToken</span><span class="tok-o">,</span> <span class="tok-n">REDIRECT_URI</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>

    <span class="tok-kt">boolean</span> <span class="tok-n">sendAccessToken</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>

    <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">createRequest</span><span class="tok-o">(</span><span class="tok-n">logoutRequestUri</span><span class="tok-o">,</span> <span class="tok-n">sendAccessToken</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">okhttp3</span><span class="tok-o">.</span><span class="tok-na">Callback</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nd">@Override</span>
        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onFailure</span><span class="tok-o">(</span><span class="tok-n">Call</span> <span class="tok-n">call</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">logoutFailed</span><span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>

        <span class="tok-nd">@Override</span>
        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onResponse</span><span class="tok-o">(</span><span class="tok-n">Call</span> <span class="tok-n">call</span><span class="tok-o">,</span> <span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
            <span class="tok-c1">// nullify the auth state</span>
            <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">writeAuthState</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">);</span>
            <span class="tok-n">logoutSuccess</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
    <span class="tok-o">});</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="auth_helper_class_reading_writing_the_auth_state">Auth Helper Class: Reading/Writing the Auth State</h6>
<div class="paragraph">
<p>As mentioned earlier, an auth helper class has been provided to for easy querying of the auth state and retrieval of other useful information.</p>
</div>
<div class="paragraph">
<p>The Auth State can be read using the code below and called using <code>AuthHelper.readAuthState()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Read the auth state from shared preferences</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">private</span> <span class="tok-n">AuthState</span> <span class="tok-nf">readAuthState</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">currentState</span> <span class="tok-o">=</span> <span class="tok-n">mPrefs</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-n">KEY_STATE</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">currentState</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">AuthState</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">AuthState</span><span class="tok-o">.</span><span class="tok-na">jsonDeserialize</span><span class="tok-o">(</span><span class="tok-n">currentState</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">JSONException</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Log</span><span class="tok-o">.</span><span class="tok-na">w</span><span class="tok-o">(</span><span class="tok-s">&quot;AuthState&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Failed to deserialize stored auth state: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">ex</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">AuthState</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can write a new Auth State using the code below and can be called using <code>AuthHelper.writeAuthState(Authstate state)</code>.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Write the auth state to shared preferences</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @param state - The Authstate to write to shared preferences</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">writeAuthState</span><span class="tok-o">(</span><span class="tok-nd">@Nullable</span> <span class="tok-n">AuthState</span> <span class="tok-n">state</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authState</span> <span class="tok-o">=</span> <span class="tok-n">state</span><span class="tok-o">;</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authState</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authState</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">AuthState</span><span class="tok-o">();</span>
        <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">mPrefs</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">().</span><span class="tok-na">remove</span><span class="tok-o">(</span><span class="tok-n">KEY_STATE</span><span class="tok-o">).</span><span class="tok-na">commit</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">IllegalStateException</span><span class="tok-o">(</span><span class="tok-s">&quot;Failed to write state to shared prefs&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">mPrefs</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">().</span><span class="tok-na">putString</span><span class="tok-o">(</span><span class="tok-n">KEY_STATE</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">authState</span><span class="tok-o">.</span><span class="tok-na">jsonSerializeString</span><span class="tok-o">()).</span><span class="tok-na">commit</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">IllegalStateException</span><span class="tok-o">(</span><span class="tok-s">&quot;Failed to write state to shared prefs&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="auth_helper_class_getting_identity_information">Auth Helper Class: Getting Identity Information</h6>
<div class="paragraph">
<p>This function can be used to get the users identity/access information from the auth state. The users identity is returned as a JSONObject.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Get the authenticated users identity information</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-n">JSONObject</span> <span class="tok-nf">getIdentityInformation</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">accessToken</span> <span class="tok-o">=</span> <span class="tok-n">getAccessToken</span><span class="tok-o">();</span>
    <span class="tok-n">JSONObject</span> <span class="tok-n">decodedIdentityData</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">JSONObject</span><span class="tok-o">();</span>

    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Decode the Access Token to Extract the Identity Information</span>
        <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">splitToken</span> <span class="tok-o">=</span> <span class="tok-n">accessToken</span><span class="tok-o">.</span><span class="tok-na">split</span><span class="tok-o">(</span><span class="tok-s">&quot;\\.&quot;</span><span class="tok-o">);</span>
        <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">decodedBytes</span> <span class="tok-o">=</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">decode</span><span class="tok-o">(</span><span class="tok-n">splitToken</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">URL_SAFE</span><span class="tok-o">);</span>
        <span class="tok-n">String</span> <span class="tok-n">decoded</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">decodedBytes</span><span class="tok-o">,</span> <span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-n">decodedIdentityData</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">JSONObject</span><span class="tok-o">(</span><span class="tok-n">decoded</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">JSONException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>

    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">UnsupportedEncodingException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Log</span><span class="tok-o">.</span><span class="tok-na">e</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Error Decoding Access Token&quot;</span><span class="tok-o">,</span> <span class="tok-n">e</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">decodedIdentityData</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="auth_helper_class_making_authenticated_bearer_requests">Auth Helper Class: Making Authenticated Bearer Requests</h6>
<div class="paragraph">
<p>The <code>createRequest()</code> function allows you to make HTTP calls against resources that require a valid Access Token (Such as a cloud app protected by Keycloak).
The function accepts a URL in the form of a String, a boolean value to state if you want the access token to be sent with the request, along with a <a href="http://square.github.io/okhttp/">OkHttp</a> callback.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Make a request to a resource that requires the access token to be sent with the request</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-n">Call</span> <span class="tok-nf">createRequest</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">requestUrl</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">sendAccessToken</span><span class="tok-o">,</span> <span class="tok-n">okhttp3</span><span class="tok-o">.</span><span class="tok-na">Callback</span> <span class="tok-n">callback</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">URL</span> <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">URL</span><span class="tok-o">(</span><span class="tok-n">requestUrl</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">MalformedURLException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
    <span class="tok-n">String</span> <span class="tok-n">serverHostname</span> <span class="tok-o">=</span> <span class="tok-n">url</span><span class="tok-o">.</span><span class="tok-na">getHost</span><span class="tok-o">();</span>

    <span class="tok-n">HttpsURLConnection</span> <span class="tok-n">connection</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">connection</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">HttpsURLConnection</span><span class="tok-o">)</span> <span class="tok-n">url</span><span class="tok-o">.</span><span class="tok-na">openConnection</span><span class="tok-o">();</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-n">SSLSocketFactory</span> <span class="tok-n">sslSocketFactory</span> <span class="tok-o">=</span> <span class="tok-n">TrustKit</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">getSSLSocketFactory</span><span class="tok-o">(</span><span class="tok-n">serverHostname</span><span class="tok-o">);</span>
    <span class="tok-n">X509TrustManager</span> <span class="tok-n">trustManager</span> <span class="tok-o">=</span> <span class="tok-n">TrustKit</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">getTrustManager</span><span class="tok-o">(</span><span class="tok-n">serverHostname</span><span class="tok-o">);</span>
    <span class="tok-n">connection</span><span class="tok-o">.</span><span class="tok-na">setSSLSocketFactory</span><span class="tok-o">(</span><span class="tok-n">sslSocketFactory</span><span class="tok-o">);</span>

    <span class="tok-n">OkHttpClient</span> <span class="tok-n">httpClient</span> <span class="tok-o">=</span> <span class="tok-n">HttpHelper</span><span class="tok-o">.</span><span class="tok-na">getHttpClient</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">sslSocketFactory</span><span class="tok-o">(</span><span class="tok-n">sslSocketFactory</span><span class="tok-o">,</span> <span class="tok-n">trustManager</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">connectTimeout</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-n">TimeUnit</span><span class="tok-o">.</span><span class="tok-na">SECONDS</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>

    <span class="tok-n">Request</span> <span class="tok-n">request</span><span class="tok-o">;</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sendAccessToken</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Ensure that a non-expired access token is being used for the request</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">getNeedsTokenRefresh</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-n">setNeedsTokenRefresh</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>

        <span class="tok-n">String</span> <span class="tok-n">accessToken</span> <span class="tok-o">=</span> <span class="tok-n">getAccessToken</span><span class="tok-o">();</span>
        <span class="tok-n">request</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">url</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">addHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Authorization&quot;</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;Bearer %s&quot;</span><span class="tok-o">,</span> <span class="tok-n">accessToken</span><span class="tok-o">))</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-n">request</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">url</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>


    <span class="tok-n">Call</span> <span class="tok-n">call</span> <span class="tok-o">=</span> <span class="tok-n">httpClient</span><span class="tok-o">.</span><span class="tok-na">newCall</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">);</span>
    <span class="tok-n">call</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-n">callback</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">call</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="auth_helper_class_other_helper_functions">Auth Helper Class: Other Helper Functions</h6>
<div class="paragraph">
<p>There are also a number of other functions in the helper class to get some auth related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isAuthorized()</code> - Returns a boolean value for if the user is authenticated or authorized (for OAuth).</p>
</li>
<li>
<p><code>getAccessToken()</code> - Returns a String of the Access Token.</p>
</li>
<li>
<p><code>getIdentityToken()</code> - Returns a String of the Identity Token.</p>
</li>
<li>
<p><code>getNeedsTokenRefresh()</code> - Returns a boolean value for if a new access token needs to be required.</p>
</li>
<li>
<p><code>setNeedsTokenRefresh()</code> - Set a flag to say that a new access token is required.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="data_storage_summary">1.2. Data Storage Summary</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do&#8217;s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dont&#8217;s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Classify data storage according to sensitivity and apply controls accordingly</strong> <em>(To understand what information should be protected)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Store any sensitive data on a mobile device where possible</strong> <em>(Prevent data leak)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>When storing sensitive data on the device, use a file encryption API provided by the OS or other trusted source</strong> <em>(Secure Cryptography)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Write data to persistent memory accessible to other applications without encryption</strong> <em>(Shared storage is untrusted)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use file encryption API’s which use a secret key protected by the device unlock code and deletable on remote wipe if available</strong> <em>(Protect secret key)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Including the keys in the same attacker-readable directory as the encrypted content</strong> <em>(Can be used to decrypt data)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Make use of remote wipe and kill switch APIs to remove sensitive information from the device in the event of theft or loss</strong> <em>(Prevent data leak if the device is lost)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Take screeenshots contain sensitive data</strong> <em>(Avoid sensitive data is exposed through screenshots)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use a time based (expiry) type of control which will wipe sensitive data from the mobile device once the application has not communicated with its servers for a given period of time</strong> <em>(Less chance to decrypt data by using brute force)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Leak permission-protected data to other applications</strong> <em>(Prevent other apps access sensitive data)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Automatic application shutdown and/or lockout after X minutes of inactivity</strong> <em>(Less chance of data leak)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow third party keyboards to be used for inputs that may contain sensitive data</strong> <em>(Prevent data leak)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that OS level storage encryption is enabled and the device is protected by a PIN or passphrase</strong> <em>(Ensure data encryption by default)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Backup or synchronize sensitive data</strong> <em>(Prevent data leak)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Restrict the data that is shared with other applications</strong> <em>(Prevent other apps access sensitive data)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Log sensitive information</strong> <em>(Prevent data leak through logs)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Nullify any variables that hold keys after use</strong> <em>(Secure keys in memory)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>using immutable objects for sensitive keys or passwords such as in Android java.lang.String and use char array instead</strong> <em>(Secure keys in memory)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Restrict broadcast messages (e.g., Android Broadcast Intents) to authorized applications</strong> <em>(Prevent other apps access sensitive data)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Disable Auto Correction and Autosuggestion for inputs that contain sensitive data</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Disable cut, copy and paste functionalities for inputs that may contain sensitive data or restrict the pasteboard to be accessible only from this application</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Delete application caches on app termination</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Clear cookies and data in Webview on app termination</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Remove sesitive data from views when in background</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="implementation_2">1.2.1. Implementation</h4>
<div class="sect4">
<h5 id="overview_2">Overview</h5>
<div class="paragraph">
<p>We have implemented a feature in the sample app to allow users to manage secret notes. This feature is used to showcase the best practices around secure data storage.</p>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<img src="https://raw.githubusercontent.com/feedhenry/mobile-security-android-template/master/screenshots/storage_menu.png" alt="storage menu" width="270" height="480">
</div>
</div>
<div class="imageblock left">
<div class="content">
<img src="https://raw.githubusercontent.com/feedhenry/mobile-security-android-template/master/screenshots/storage_main.png" alt="storage main" width="270" height="480">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The secret notes can be saved to either file system or database (SQLite). In both cases, the notes will be encrypted automatically when persisted, and decrypted automatically when loaded into the app.</p>
</div>
</div>
<div class="sect4">
<h5 id="secret_key_management">Secret Key Management</h5>
<div class="paragraph">
<p>Secret keys are being used to encrypt/decrypt the notes. To make sure the secret keys are securely persisted, in most cases, the OS&#8217;s keystore should be used to persist the secret key.</p>
</div>
<div class="paragraph">
<p>However, for Android, there is a difference between Android M and pre-Android M.</p>
</div>
<div class="sect5">
<h6 id="android_m_and_later">Android M and later</h6>
<div class="paragraph">
<p>In Android M and later versions, the KeyStore API supports generating and persist secret key, so the implementation is quite straight forward:</p>
</div>
<div class="listingblock">
<div class="title">Generate Secret Key</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Generate the AES key for encryption/decryption. The key will be 128bit and it can only be used with AES/GCM/NoPadding mode.</span>
<span class="tok-cm"> * @param keyAlias the key alias</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">generateAESKey</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">keyAlias</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">KeyGenerator</span> <span class="tok-n">keyGenerator</span> <span class="tok-o">=</span> <span class="tok-n">KeyGenerator</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">KEY_ALGORITHM_AES</span><span class="tok-o">,</span> <span class="tok-n">ANDROID_KEY_STORE</span><span class="tok-o">);</span>
    <span class="tok-c1">//TODO: further control if user authentication is required for accessing the keys</span>
    <span class="tok-n">KeyGenParameterSpec</span> <span class="tok-n">keyGenerationParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">KeyGenParameterSpec</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">(</span><span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">PURPOSE_ENCRYPT</span> <span class="tok-o">|</span> <span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">PURPOSE_DECRYPT</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setKeySize</span><span class="tok-o">(</span><span class="tok-n">AES_KEYSIZE_128</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setBlockModes</span><span class="tok-o">(</span><span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">BLOCK_MODE_GCM</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setEncryptionPaddings</span><span class="tok-o">(</span><span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">ENCRYPTION_PADDING_NONE</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setRandomizedEncryptionRequired</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-n">keyGenerator</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">keyGenerationParameters</span><span class="tok-o">);</span>
    <span class="tok-n">keyGenerator</span><span class="tok-o">.</span><span class="tok-na">generateKey</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="pre_android_m">Pre-Android M</h6>
<div class="paragraph">
<p>However, in pre-Android M, the KeyStore API only supports generating public/private key pairs, so we can&#8217;t persist the secret key using the keystore.</p>
</div>
<div class="paragraph">
<p>Instead, we will have to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate the secret key without using the KeyStore</p>
<div class="listingblock">
<div class="title">Generate Secret</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-kd">private</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">generateSecretKey</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">size</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">NoSuchAlgorithmException</span> <span class="tok-o">{</span>
    <span class="tok-n">KeyGenerator</span> <span class="tok-n">keyGen</span> <span class="tok-o">=</span> <span class="tok-n">KeyGenerator</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">KEY_ALGORITHM_AES</span><span class="tok-o">);</span>
    <span class="tok-n">keyGen</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">size</span><span class="tok-o">);</span>
    <span class="tok-n">SecretKey</span> <span class="tok-n">secretKey</span> <span class="tok-o">=</span> <span class="tok-n">keyGen</span><span class="tok-o">.</span><span class="tok-na">generateKey</span><span class="tok-o">();</span>
    <span class="tok-k">return</span> <span class="tok-n">secretKey</span><span class="tok-o">.</span><span class="tok-na">getEncoded</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</li>
<li>
<p>Generate a public/private key pair using the KeyStore</p>
<div class="listingblock">
<div class="title">Generate Keypair</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">generatePrivateKeyPair</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">keyAlias</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-c1">//pre android-M, the keystore only support RSA key generation. So here we will generate a RSA keypair first, then generate the AES key.</span>
    <span class="tok-c1">//we then encrypt the AES key using the generated RSA public key, and save it using the SharedPreferences</span>
    <span class="tok-n">Calendar</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
    <span class="tok-n">Calendar</span> <span class="tok-n">end</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
    <span class="tok-n">end</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">YEAR</span><span class="tok-o">,</span> <span class="tok-mi">99</span><span class="tok-o">);</span>
    <span class="tok-n">KeyPairGeneratorSpec</span> <span class="tok-n">generatorSpec</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">KeyPairGeneratorSpec</span>
            <span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">(</span><span class="tok-n">context</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setAlias</span><span class="tok-o">(</span><span class="tok-n">keyAlias</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setSubject</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">X500Principal</span><span class="tok-o">(</span><span class="tok-s">&quot;CN=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">keyAlias</span><span class="tok-o">))</span>
            <span class="tok-o">.</span><span class="tok-na">setSerialNumber</span><span class="tok-o">(</span><span class="tok-n">BigInteger</span><span class="tok-o">.</span><span class="tok-na">TEN</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setStartDate</span><span class="tok-o">(</span><span class="tok-n">start</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">())</span>
            <span class="tok-o">.</span><span class="tok-na">setEndDate</span><span class="tok-o">(</span><span class="tok-n">end</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">())</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-n">KeyPairGenerator</span> <span class="tok-n">generator</span> <span class="tok-o">=</span> <span class="tok-n">KeyPairGenerator</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">KEY_ALGORITHM_RSA</span><span class="tok-o">,</span> <span class="tok-n">ANDROID_KEY_STORE</span><span class="tok-o">);</span>
    <span class="tok-n">generator</span><span class="tok-o">.</span><span class="tok-na">initialize</span><span class="tok-o">(</span><span class="tok-n">generatorSpec</span><span class="tok-o">);</span>
    <span class="tok-n">generator</span><span class="tok-o">.</span><span class="tok-na">generateKeyPair</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</li>
<li>
<p>Encrypt the generated secret key with the generated public key and persist the encrypted secret key using private SharedPreferences.</p>
<div class="listingblock">
<div class="title">Encrypt Secret</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">generateAESKey</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">keyAlias</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">secretKey</span> <span class="tok-o">=</span> <span class="tok-n">generateSecretKey</span><span class="tok-o">(</span><span class="tok-n">AES_KEYSIZE_128</span><span class="tok-o">);</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">encryptedKey</span> <span class="tok-o">=</span> <span class="tok-n">rsaEncrypt</span><span class="tok-o">(</span><span class="tok-n">secretKey</span><span class="tok-o">);</span>
    <span class="tok-n">String</span> <span class="tok-n">encodedSecretKey</span> <span class="tok-o">=</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">encodeToString</span><span class="tok-o">(</span><span class="tok-n">encryptedKey</span><span class="tok-o">,</span> <span class="tok-n">BASE64_FLAG</span><span class="tok-o">);</span>
    <span class="tok-n">SharedPreferences</span><span class="tok-o">.</span><span class="tok-na">Editor</span> <span class="tok-n">editor</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">sharedPreferences</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">();</span>
    <span class="tok-n">editor</span><span class="tok-o">.</span><span class="tok-na">putString</span><span class="tok-o">(</span><span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-n">encodedSecretKey</span><span class="tok-o">);</span>
    <span class="tok-n">editor</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</li>
<li>
<p>To load the secret key, the generated key pair needs to be loaded first, and then use the private key to decrypt the encrypted secret key.</p>
<div class="listingblock">
<div class="title">Decrypt Secret</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-n">Key</span> <span class="tok-nf">getSecretKey</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">keyAlias</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">encodedKey</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">sharedPreferences</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">encodedKey</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">encryptedKeyBytes</span> <span class="tok-o">=</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">decode</span><span class="tok-o">(</span><span class="tok-n">encodedKey</span><span class="tok-o">,</span> <span class="tok-n">BASE64_FLAG</span><span class="tok-o">);</span>
        <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">keyBytes</span> <span class="tok-o">=</span> <span class="tok-n">rsaDecrypt</span><span class="tok-o">(</span><span class="tok-n">encryptedKeyBytes</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">SecretKeySpec</span><span class="tok-o">(</span><span class="tok-n">keyBytes</span><span class="tok-o">,</span> <span class="tok-n">KeyProperties</span><span class="tok-o">.</span><span class="tok-na">KEY_ALGORITHM_AES</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The alternative option is to ask the user to provide a password. The password will be used to encrypt/decrypt the secret key. This does mean that the user will have to remember the password and enter it everytime when using the app.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="encrypt_decrypt_the_secret_key">Encrypt/decrypt the secret key</h5>
<div class="paragraph">
<p>RSA encryption/decryption is used to encrypt/decrypt the secret key. It can be used to encrypt/decrypt relatively small amount of data.</p>
</div>
<div class="paragraph">
<p>You can perform RSA encryption/decryption in Android like this:</p>
</div>
<div class="listingblock">
<div class="title">RSA Encryption</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Perform encryption using RSA</span>
<span class="tok-cm"> * @param mode the RSA encryption alg</span>
<span class="tok-cm"> * @param keyEntry the private/public key entry</span>
<span class="tok-cm"> * @param text the data to encrypt</span>
<span class="tok-cm"> * @return the encrypted ddata</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">encrypt</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">mode</span><span class="tok-o">,</span> <span class="tok-n">KeyStore</span><span class="tok-o">.</span><span class="tok-na">PrivateKeyEntry</span> <span class="tok-n">keyEntry</span><span class="tok-o">,</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">text</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-c1">// Encrypt the text</span>
    <span class="tok-n">Cipher</span> <span class="tok-n">inputCipher</span> <span class="tok-o">=</span> <span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">mode</span><span class="tok-o">);</span>
    <span class="tok-n">inputCipher</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">ENCRYPT_MODE</span><span class="tok-o">,</span> <span class="tok-n">keyEntry</span><span class="tok-o">.</span><span class="tok-na">getCertificate</span><span class="tok-o">().</span><span class="tok-na">getPublicKey</span><span class="tok-o">());</span>
    <span class="tok-c1">//The key to encrypt should be either 16 (128 bit) or 32 (256 bit) in size, well below the block size for RSA (should be around 214 bytes)</span>
    <span class="tok-n">ByteArrayOutputStream</span> <span class="tok-n">outputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ByteArrayOutputStream</span><span class="tok-o">();</span>
    <span class="tok-n">CipherOutputStream</span> <span class="tok-n">cipherOutputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">CipherOutputStream</span><span class="tok-o">(</span><span class="tok-n">outputStream</span><span class="tok-o">,</span> <span class="tok-n">inputCipher</span><span class="tok-o">);</span>
    <span class="tok-n">cipherOutputStream</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-n">text</span><span class="tok-o">);</span>
    <span class="tok-n">cipherOutputStream</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>

    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">vals</span> <span class="tok-o">=</span> <span class="tok-n">outputStream</span><span class="tok-o">.</span><span class="tok-na">toByteArray</span><span class="tok-o">();</span>
    <span class="tok-k">return</span> <span class="tok-n">vals</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">RSA Decryption</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Perform decryption using RSA</span>
<span class="tok-cm"> * @param mode the RSA decryption alg</span>
<span class="tok-cm"> * @param keyEntry the private/public key entry</span>
<span class="tok-cm"> * @param toDecrypt the encrypted data</span>
<span class="tok-cm"> * @return the decrypted data</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">decrypt</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">mode</span><span class="tok-o">,</span> <span class="tok-n">KeyStore</span><span class="tok-o">.</span><span class="tok-na">PrivateKeyEntry</span> <span class="tok-n">keyEntry</span><span class="tok-o">,</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">toDecrypt</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">Cipher</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">mode</span><span class="tok-o">);</span>
    <span class="tok-n">output</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">DECRYPT_MODE</span><span class="tok-o">,</span> <span class="tok-n">keyEntry</span><span class="tok-o">.</span><span class="tok-na">getPrivateKey</span><span class="tok-o">());</span>
    <span class="tok-n">ByteArrayInputStream</span> <span class="tok-n">inputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ByteArrayInputStream</span><span class="tok-o">(</span><span class="tok-n">toDecrypt</span><span class="tok-o">);</span>
    <span class="tok-n">CipherInputStream</span> <span class="tok-n">cipherInputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">CipherInputStream</span><span class="tok-o">(</span><span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">output</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">StreamUtils</span><span class="tok-o">.</span><span class="tok-na">readStreamBytes</span><span class="tok-o">(</span><span class="tok-n">cipherInputStream</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="encrypt_decrypt_the_content_of_notes">Encrypt/decrypt the content of notes</h5>
<div class="paragraph">
<p>Once we have the secret key, we can use it to encrypt/decrypt the content of the notes using AES.</p>
</div>
<div class="paragraph">
<p>You can perform data encryption/decryption in Android like this:</p>
</div>
<div class="listingblock">
<div class="title">Encryption</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Encrypt the given text.</span>
<span class="tok-cm"> * @param keyAlias The alias of the key in the keystore that will be used for the encryption.</span>
<span class="tok-cm"> * @param plainText the text to encrypt</span>
<span class="tok-cm"> * @return the encrypted data. The first 12 bytes will be the IV (initial vector) used for the encryption.</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">encrypt</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">plainText</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">SecretKey</span> <span class="tok-n">secretKey</span> <span class="tok-o">=</span> <span class="tok-n">loadOrGenerateSecretKey</span><span class="tok-o">(</span><span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span>
    <span class="tok-n">Cipher</span> <span class="tok-n">cipher</span> <span class="tok-o">=</span> <span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">secureKeyStore</span><span class="tok-o">.</span><span class="tok-na">getSupportedAESMode</span><span class="tok-o">());</span>
    <span class="tok-n">cipher</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">ENCRYPT_MODE</span><span class="tok-o">,</span> <span class="tok-n">secretKey</span><span class="tok-o">);</span>
    <span class="tok-c1">//get the iv that is being used</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">iv</span> <span class="tok-o">=</span> <span class="tok-n">cipher</span><span class="tok-o">.</span><span class="tok-na">getIV</span><span class="tok-o">();</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">encrypted</span> <span class="tok-o">=</span> <span class="tok-n">cipher</span><span class="tok-o">.</span><span class="tok-na">doFinal</span><span class="tok-o">(</span><span class="tok-n">plainText</span><span class="tok-o">);</span>
    <span class="tok-n">GCMEncrypted</span> <span class="tok-n">encryptedData</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">GCMEncrypted</span><span class="tok-o">(</span><span class="tok-n">iv</span><span class="tok-o">,</span> <span class="tok-n">encrypted</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">encryptedData</span><span class="tok-o">.</span><span class="tok-na">toByteArray</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Decryption</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Decrypt the given encrypted data</span>
<span class="tok-cm"> * @param keyAlias The alias of the key in the keystore that will be used for the decryption.</span>
<span class="tok-cm"> * @param encryptedText the text to decrypt. The first 12 bytes should be the IV used for encryption.</span>
<span class="tok-cm"> * @return the plain text data</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">decrypt</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">encryptedText</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">GCMEncrypted</span> <span class="tok-n">encryptedData</span> <span class="tok-o">=</span> <span class="tok-n">GCMEncrypted</span><span class="tok-o">.</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-n">encryptedText</span><span class="tok-o">);</span>
    <span class="tok-n">SecretKey</span> <span class="tok-n">secretKey</span> <span class="tok-o">=</span> <span class="tok-n">loadOrGenerateSecretKey</span><span class="tok-o">(</span><span class="tok-n">keyAlias</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
    <span class="tok-n">Cipher</span> <span class="tok-n">cipher</span> <span class="tok-o">=</span> <span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(</span><span class="tok-n">secureKeyStore</span><span class="tok-o">.</span><span class="tok-na">getSupportedAESMode</span><span class="tok-o">());</span>
    <span class="tok-n">cipher</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">Cipher</span><span class="tok-o">.</span><span class="tok-na">DECRYPT_MODE</span><span class="tok-o">,</span> <span class="tok-n">secretKey</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-nf">GCMParameterSpec</span><span class="tok-o">(</span><span class="tok-n">GCMEncrypted</span><span class="tok-o">.</span><span class="tok-na">GCM_TAG_LENGTH</span><span class="tok-o">,</span> <span class="tok-n">encryptedData</span><span class="tok-o">.</span><span class="tok-na">iv</span><span class="tok-o">));</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">plainText</span> <span class="tok-o">=</span> <span class="tok-n">cipher</span><span class="tok-o">.</span><span class="tok-na">doFinal</span><span class="tok-o">(</span><span class="tok-n">encryptedData</span><span class="tok-o">.</span><span class="tok-na">encryptedData</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">plainText</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="persist_data_using_file_system">Persist data using file system</h5>
<div class="paragraph">
<p>When a secret note is created, it can be persisted to the file system. We should encrypt the file when it is being persisted, and decrypt it when it is being loaded:</p>
</div>
<div class="listingblock">
<div class="title">File Encryption</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Encrypt the file when saving to the file system</span>
<span class="tok-cm"> * @param fileName the name of the file</span>
<span class="tok-cm"> * @param fileContent the content of the file</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">writeFileWithEncryption</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">fileName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">fileContent</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">GeneralSecurityException</span> <span class="tok-o">{</span>
    <span class="tok-n">File</span> <span class="tok-n">outputFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">File</span><span class="tok-o">(</span><span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">getFilesDir</span><span class="tok-o">(),</span> <span class="tok-n">fileName</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">outputFile</span><span class="tok-o">.</span><span class="tok-na">exists</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">outputFile</span><span class="tok-o">.</span><span class="tok-na">createNewFile</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
    <span class="tok-n">OutputStream</span> <span class="tok-n">outStream</span> <span class="tok-o">=</span> <span class="tok-n">aesCrypto</span><span class="tok-o">.</span><span class="tok-na">encryptStream</span><span class="tok-o">(</span><span class="tok-n">fileName</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-nf">FileOutputStream</span><span class="tok-o">(</span><span class="tok-n">outputFile</span><span class="tok-o">));</span>
    <span class="tok-n">outStream</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-n">fileContent</span><span class="tok-o">.</span><span class="tok-na">getBytes</span><span class="tok-o">(</span><span class="tok-s">&quot;utf-8&quot;</span><span class="tok-o">));</span>
    <span class="tok-n">outStream</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">();</span>
    <span class="tok-n">outStream</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">File Decryption</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Read the content of the file, and decrypt it automatically</span>
<span class="tok-cm"> * @param fileName the name of the file</span>
<span class="tok-cm"> * @return the decrypted file content</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-nf">readFileWithDecryption</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">fileName</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">GeneralSecurityException</span> <span class="tok-o">{</span>
    <span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span> <span class="tok-o">=</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">openFileInput</span><span class="tok-o">(</span><span class="tok-n">fileName</span><span class="tok-o">);</span>
    <span class="tok-n">InputStream</span> <span class="tok-n">decryptedStream</span> <span class="tok-o">=</span> <span class="tok-n">aesCrypto</span><span class="tok-o">.</span><span class="tok-na">decryptStream</span><span class="tok-o">(</span><span class="tok-n">fileName</span><span class="tok-o">,</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>

    <span class="tok-k">return</span> <span class="tok-n">StreamUtils</span><span class="tok-o">.</span><span class="tok-na">readStream</span><span class="tok-o">(</span><span class="tok-n">decryptedStream</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="persist_data_using_database_sqlite">Persist data using database (SQLite)</h5>
<div class="paragraph">
<p>To securely persist data to the database, a library called <a href="https://www.zetetic.net/sqlcipher/">SqlCipher</a> is used. The library will automatically manage the encryption/decryption of the sqlite database file. It is easy to use, and requires minimum changes to the code.</p>
</div>
<div class="paragraph">
<p>To encrypt/decrypt the database, a password is required. You can ask the user to provide the password. In our sample application, we generated a random password and then protected using a public/private key pair. The password is saved to the private SharedPreferences.</p>
</div>
<div class="listingblock">
<div class="title">SqlCipher Password</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Get the password to protect the database</span>
<span class="tok-cm"> * @return the password</span>
<span class="tok-cm"> * @throws GeneralSecurityException</span>
<span class="tok-cm"> * @throws IOException</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-nf">getDbPassword</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">GeneralSecurityException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">encryptedDbPass</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">sharedPreferences</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-n">DB_KEY_PREF_NAME</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">encryptedDbPass</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">passwordToEncrypt</span> <span class="tok-o">=</span> <span class="tok-n">randomPassword</span><span class="tok-o">();</span>
        <span class="tok-n">encryptedDbPass</span> <span class="tok-o">=</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">encodeToString</span><span class="tok-o">(</span><span class="tok-n">rsaCrypto</span><span class="tok-o">.</span><span class="tok-na">encrypt</span><span class="tok-o">(</span><span class="tok-n">ENCRYPT_KEY_ALIAS</span><span class="tok-o">,</span> <span class="tok-n">passwordToEncrypt</span><span class="tok-o">.</span><span class="tok-na">getBytes</span><span class="tok-o">(</span><span class="tok-s">&quot;utf-8&quot;</span><span class="tok-o">)),</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">NO_WRAP</span><span class="tok-o">);</span>
        <span class="tok-n">SharedPreferences</span><span class="tok-o">.</span><span class="tok-na">Editor</span> <span class="tok-n">editor</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">sharedPreferences</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">();</span>
        <span class="tok-n">editor</span><span class="tok-o">.</span><span class="tok-na">putString</span><span class="tok-o">(</span><span class="tok-n">DB_KEY_PREF_NAME</span><span class="tok-o">,</span> <span class="tok-n">encryptedDbPass</span><span class="tok-o">).</span><span class="tok-na">commit</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
    <span class="tok-n">String</span> <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">rsaCrypto</span><span class="tok-o">.</span><span class="tok-na">decrypt</span><span class="tok-o">(</span><span class="tok-n">ENCRYPT_KEY_ALIAS</span><span class="tok-o">,</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">decode</span><span class="tok-o">(</span><span class="tok-n">encryptedDbPass</span><span class="tok-o">,</span> <span class="tok-n">Base64</span><span class="tok-o">.</span><span class="tok-na">NO_WRAP</span><span class="tok-o">)),</span> <span class="tok-s">&quot;utf-8&quot;</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">password</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="network_security">1.3. Network Security</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Do&#8217;s</th>
<th class="tableblock halign-left valign-top">Dont&#8217;s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Include a Backup Cert Pin.</strong> <em>(Retain app connectivity if new keys on server are used or the CA is changed)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pin the full certificate</strong>. <em>(The full cert, and potentially backup certs are available for inspection, the certificate is bundled with the app meaning that when a cert expires the app must be rebuilt with a new cert)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Perform Certificate Pinning using the hash of the public key - SubjectPublicKeyInfo of the X.509 certificate.</strong> <em>(Allows you to anonymize a certificate or public key and ensures an attacker does not see the reserved certificate or public key in advance of its use).</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Send sensitive data without certificate pinning.</strong> <em>(Creates higher risk as an attacker with network privileges, or who has compromised TLS, is better positioned to intercept data)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Perform proper certificate validation if the platform doesn&#8217;t allow true certificate pinning.</strong> <em>(Adds an extra precautionary check when sending sensitive data)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Establish connections with endpoints that offer a different certificate or key, even if signed by a trusted CA.</strong> <em>(The channel is not trusted.)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use TLS for network encryption.</strong> <em>(SSL 2.0 and 3.0 have been deprecated by the IETF)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use Mixed SSL sessions</strong>. <em>(The users session ID can be exposed over non HTTPS requests)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use a secure channel consistently throughout the app</strong>. <em>(Ensure that some network calls are not sent in plaintext)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use localhost network ports for handling sensitive IPC.</strong> <em>(The interface is accessible by other applications on the device)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app doesn’t rely on a single insecure communication channel such as email or SMS for critical operations, such as enrollments and account recovery.</strong> <em>(Use a hardware token or secure channel as GCM or Apple Push notifications)</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Don’t rely on unauthenticated SMS data to perform sensitive commands.</strong> <em>(The input may be malicious, be spoofed or sniffed using another app with SMS read permissions)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app uses some form of whitelisting to control access to external domains.</strong> <em>(Limit the outbound requests to predefined trusted domains).</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Avoid sending crash logs over the network in plaintext</strong>. <em>(Logs can contain sensitive or important information about the user and/or the application)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pay particular attention to validating all data received from and sent to non-trusted third party apps/plugins before incorporating their use into an application.</strong> <em>(Some plugins can interact with ad networks etc)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Consider using HTTP Strict Transport Security (HSTS).</strong> <em>(Protect against protocol downgrade attacks and cookie hijacking)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Make sure that you don’t trust data downloaded from HTTP or other insecure protocols.</strong> <em>(Validate the data before using it in an application)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Require User Approval before Executing a Function that Transmits PII over a Network</strong>. <em>(Inform the user that their data is being transferred over a network or being sent to another location)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>For highly sensitive values, implement additional encryption in transit.</strong> <em>(Improved protection in case the secure channel somehow compromised)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="implementation_3">1.3.1. Implementation</h4>
<div class="sect4">
<h5 id="overview_3">Overview</h5>
<div class="paragraph">
<p>A number of features were added to enhance the security of the channel between the Mobile App and the Authentication or API Server.</p>
</div>
</div>
<div class="sect4">
<h5 id="code_examples_2">Code Examples</h5>
<div class="paragraph">
<p>The main code logic for certificate pinning is found under <a href="https://github.com/feedhenry/mobile-security-android-template/blob/master/app/src/main/java/com/feedhenry/securenativeandroidtemplate/domain/services/AuthStateService.java">here</a> in the AuthStateService class.</p>
</div>
<div class="sect5">
<h6 id="certificate_pinning">Certificate Pinning</h6>
<div class="paragraph">
<p>Certificate Pinning has been implemented in the Application using the SPKI technique. This ensures easier maintenance and improved security by anonymizing the certificate information in the application.
The <a href="https://github.com/datatheorem/TrustKit-Android">TrustKit Android</a> library is being utilised to allow certificate pinning to work with older API levels.</p>
</div>
<div class="paragraph">
<p>The Android <a href="https://developer.android.com/training/articles/security-config.html">Network Security Configuration</a> XML file defined the pins of the server you want to pin against.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="tok-nt">&lt;network-security-config&gt;</span>
    <span class="tok-nt">&lt;domain-config</span> <span class="tok-na">cleartextTrafficPermitted=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;domain</span> <span class="tok-na">includeSubdomains=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>osm1.skunkhenry.com<span class="tok-nt">&lt;/domain&gt;</span>
        <span class="tok-nt">&lt;pin-set&gt;</span>
            // primary
            <span class="tok-nt">&lt;pin</span> <span class="tok-na">digest=</span><span class="tok-s">&quot;SHA-256&quot;</span><span class="tok-nt">&gt;</span>jAoDAV3WG9IKcu0YJ1ZVTuEVqdcglfiQRqmfy3+ieoc=<span class="tok-nt">&lt;/pin&gt;</span>
            // backup
            <span class="tok-nt">&lt;pin</span> <span class="tok-na">digest=</span><span class="tok-s">&quot;SHA-256&quot;</span><span class="tok-nt">&gt;</span>XAoDAV3WG9IKcu0YJ1ZVTuEVqdcglfiQRqmfy3+ieoc=<span class="tok-nt">&lt;/pin&gt;</span>
        <span class="tok-nt">&lt;/pin-set&gt;</span>

        // Set this to true for production, at least 2 unique pins must be provided above!
        <span class="tok-nt">&lt;trustkit-config</span> <span class="tok-na">enforcePinning=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;&lt;/trustkit-config&gt;</span>
    <span class="tok-nt">&lt;/domain-config&gt;</span>
    <span class="tok-nt">&lt;debug-overrides&gt;</span>
        <span class="tok-nt">&lt;trust-anchors&gt;</span>
            <span class="tok-c">&lt;!-- Trust preinstalled CAs --&gt;</span>
            <span class="tok-nt">&lt;certificates</span> <span class="tok-na">src=</span><span class="tok-s">&quot;system&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-c">&lt;!-- Additionally trust user added CAs --&gt;</span>
            <span class="tok-nt">&lt;certificates</span> <span class="tok-na">src=</span><span class="tok-s">&quot;user&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/trust-anchors&gt;</span>
    <span class="tok-nt">&lt;/debug-overrides&gt;</span>
<span class="tok-nt">&lt;/network-security-config&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can get the pin for a website using OpenSSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>openssl s_client -servername www.example.com -connect www.example.com:443 | openssl x509 -pubkey -noout | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | openssl enc -base64</code></pre>
</div>
</div>
<div class="paragraph">
<p>A HTTP request function has been created to perform requests to the Authentication servers. The <code>createRequest()</code> functions performs pinning verification on the requests.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Make a request to a resource that requires the access token to be sent with the request</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-n">Call</span> <span class="tok-nf">createRequest</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">requestUrl</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">sendAccessToken</span><span class="tok-o">,</span> <span class="tok-n">okhttp3</span><span class="tok-o">.</span><span class="tok-na">Callback</span> <span class="tok-n">callback</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">URL</span> <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">URL</span><span class="tok-o">(</span><span class="tok-n">requestUrl</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">MalformedURLException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
    <span class="tok-n">String</span> <span class="tok-n">serverHostname</span> <span class="tok-o">=</span> <span class="tok-n">url</span><span class="tok-o">.</span><span class="tok-na">getHost</span><span class="tok-o">();</span>

    <span class="tok-n">HttpsURLConnection</span> <span class="tok-n">connection</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">connection</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">HttpsURLConnection</span><span class="tok-o">)</span> <span class="tok-n">url</span><span class="tok-o">.</span><span class="tok-na">openConnection</span><span class="tok-o">();</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-n">SSLSocketFactory</span> <span class="tok-n">sslSocketFactory</span> <span class="tok-o">=</span> <span class="tok-n">TrustKit</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">getSSLSocketFactory</span><span class="tok-o">(</span><span class="tok-n">serverHostname</span><span class="tok-o">);</span>
    <span class="tok-n">X509TrustManager</span> <span class="tok-n">trustManager</span> <span class="tok-o">=</span> <span class="tok-n">TrustKit</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">getTrustManager</span><span class="tok-o">(</span><span class="tok-n">serverHostname</span><span class="tok-o">);</span>
    <span class="tok-n">connection</span><span class="tok-o">.</span><span class="tok-na">setSSLSocketFactory</span><span class="tok-o">(</span><span class="tok-n">sslSocketFactory</span><span class="tok-o">);</span>

    <span class="tok-n">OkHttpClient</span> <span class="tok-n">httpClient</span> <span class="tok-o">=</span> <span class="tok-n">HttpHelper</span><span class="tok-o">.</span><span class="tok-na">getHttpClient</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">sslSocketFactory</span><span class="tok-o">(</span><span class="tok-n">sslSocketFactory</span><span class="tok-o">,</span> <span class="tok-n">trustManager</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">connectTimeout</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-n">TimeUnit</span><span class="tok-o">.</span><span class="tok-na">SECONDS</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>

    <span class="tok-n">Request</span> <span class="tok-n">request</span><span class="tok-o">;</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sendAccessToken</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Ensure that a non-expired access token is being used for the request</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">getNeedsTokenRefresh</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-n">setNeedsTokenRefresh</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>

        <span class="tok-n">String</span> <span class="tok-n">accessToken</span> <span class="tok-o">=</span> <span class="tok-n">getAccessToken</span><span class="tok-o">();</span>
        <span class="tok-n">request</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">url</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">addHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Authorization&quot;</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;Bearer %s&quot;</span><span class="tok-o">,</span> <span class="tok-n">accessToken</span><span class="tok-o">))</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-n">request</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">url</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>


    <span class="tok-n">Call</span> <span class="tok-n">call</span> <span class="tok-o">=</span> <span class="tok-n">httpClient</span><span class="tok-o">.</span><span class="tok-na">newCall</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">);</span>
    <span class="tok-n">call</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-n">callback</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">call</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A function has also been provided to check if the OkHTTP callback failure exception was due to a certificate validation issue.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Check if an exception is caused by a certificate verification error</span>
<span class="tok-cm"> * @param e</span>
<span class="tok-cm"> * @return</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">checkCertificateVerificationError</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">boolean</span> <span class="tok-n">certificateVerificationError</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getCause</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span>
            <span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getCause</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">().</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s">&quot;Certificate validation failed&quot;</span><span class="tok-o">)</span> <span class="tok-o">||</span>
            <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getCause</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">().</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s">&quot;Pin verification failed&quot;</span><span class="tok-o">)))</span> <span class="tok-o">{</span>
        <span class="tok-n">certificateVerificationError</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">certificateVerificationError</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="invoking_remote_apis">Invoking remote APIs</h6>
<div class="paragraph">
<p>When remote APIs are being invoked, before sending the data, you should make sure the client does have the required permission. If the client doesn&#8217;t have the required permission, the client should not perform the request at all:</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nd">@Override</span>
<span class="tok-kd">protected</span> <span class="tok-n">ClientStatus</span> <span class="tok-nf">doInBackground</span><span class="tok-o">(</span><span class="tok-n">Void</span><span class="tok-o">...</span> <span class="tok-n">voids</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ClientStatus</span> <span class="tok-n">status</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-kt">boolean</span> <span class="tok-n">hasPermission</span> <span class="tok-o">=</span> <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">hasRole</span><span class="tok-o">(</span><span class="tok-n">requiredRole</span><span class="tok-o">);</span>
        <span class="tok-kt">long</span> <span class="tok-n">numberOfNotes</span> <span class="tok-o">=</span> <span class="tok-n">noteRepository</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">();</span>
        <span class="tok-n">status</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ClientStatus</span><span class="tok-o">(</span><span class="tok-n">hasPermission</span><span class="tok-o">,</span> <span class="tok-n">numberOfNotes</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">status</span><span class="tok-o">;</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Log</span><span class="tok-o">.</span><span class="tok-na">e</span><span class="tok-o">(</span><span class="tok-n">TAG</span><span class="tok-o">,</span> <span class="tok-s">&quot;Error - Exception&quot;</span><span class="tok-o">,</span> <span class="tok-n">e</span><span class="tok-o">);</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">error</span> <span class="tok-o">=</span> <span class="tok-n">e</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">status</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, just checking the permission on the client is not enough. You should always check the user permission on the backend API server as well:</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">Unresolved</span> <span class="tok-nx">directive</span> <span class="tok-k">in</span> <span class="tok-nx">mobileNetworkOverview</span><span class="tok-p">.</span><span class="tok-nx">adoc</span> <span class="tok-o">-</span> <span class="tok-nx">include</span><span class="tok-o">::</span><span class="tok-nx">https</span><span class="tok-o">:</span><span class="tok-c1">//raw.githubusercontent.com/feedhenry/mobile-security/blob/master/projects/api-server/index.js[tags=checkPermission]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should also perform certificate pinning checks when calling remote APIs:</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</div></td><td class="code"><span class="tok-nd">@Override</span>
<span class="tok-kd">protected</span> <span class="tok-n">Long</span> <span class="tok-nf">doInBackground</span><span class="tok-o">(</span><span class="tok-n">Void</span><span class="tok-o">...</span> <span class="tok-n">voids</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">apiUrl</span> <span class="tok-o">=</span> <span class="tok-n">apiServerConfiguration</span><span class="tok-o">.</span><span class="tok-na">getNoteAPIUrl</span><span class="tok-o">();</span>
    <span class="tok-n">String</span> <span class="tok-n">accessToken</span> <span class="tok-o">=</span> <span class="tok-n">authStateService</span><span class="tok-o">.</span><span class="tok-na">getAccessToken</span><span class="tok-o">();</span>
    <span class="tok-kt">long</span> <span class="tok-n">uploaded</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">URL</span> <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">URL</span><span class="tok-o">(</span><span class="tok-n">apiUrl</span><span class="tok-o">);</span>
        <span class="tok-n">String</span> <span class="tok-n">hostname</span> <span class="tok-o">=</span> <span class="tok-n">url</span><span class="tok-o">.</span><span class="tok-na">getHost</span><span class="tok-o">();</span>

        <span class="tok-n">SSLSocketFactory</span> <span class="tok-n">sslSocketFactory</span> <span class="tok-o">=</span> <span class="tok-n">TrustKit</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">getSSLSocketFactory</span><span class="tok-o">(</span><span class="tok-n">hostname</span><span class="tok-o">);</span>
        <span class="tok-n">X509TrustManager</span> <span class="tok-n">trustManager</span> <span class="tok-o">=</span> <span class="tok-n">TrustKit</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">getTrustManager</span><span class="tok-o">(</span><span class="tok-n">hostname</span><span class="tok-o">);</span>

        <span class="tok-n">OkHttpClient</span> <span class="tok-n">httpClient</span> <span class="tok-o">=</span> <span class="tok-n">HttpHelper</span><span class="tok-o">.</span><span class="tok-na">getHttpClient</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">sslSocketFactory</span><span class="tok-o">(</span><span class="tok-n">sslSocketFactory</span><span class="tok-o">,</span> <span class="tok-n">trustManager</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">connectTimeout</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-n">TimeUnit</span><span class="tok-o">.</span><span class="tok-na">SECONDS</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>

        <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Note</span><span class="tok-o">&gt;</span> <span class="tok-n">notes</span> <span class="tok-o">=</span> <span class="tok-n">noteRepository</span><span class="tok-o">.</span><span class="tok-na">listNotes</span><span class="tok-o">();</span>
        <span class="tok-kt">long</span> <span class="tok-n">totalNumber</span> <span class="tok-o">=</span> <span class="tok-n">notes</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">();</span>
        <span class="tok-kt">long</span> <span class="tok-n">currentCount</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Note</span> <span class="tok-n">note</span> <span class="tok-o">:</span> <span class="tok-n">notes</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isCancelled</span><span class="tok-o">()</span> <span class="tok-o">||</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">error</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-k">break</span><span class="tok-o">;</span>
            <span class="tok-o">}</span>
            <span class="tok-n">Note</span> <span class="tok-n">readNote</span> <span class="tok-o">=</span> <span class="tok-n">noteRepository</span><span class="tok-o">.</span><span class="tok-na">readNote</span><span class="tok-o">(</span><span class="tok-n">note</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
            <span class="tok-n">RequestBody</span> <span class="tok-n">requestBody</span> <span class="tok-o">=</span> <span class="tok-n">RequestBody</span><span class="tok-o">.</span><span class="tok-na">create</span><span class="tok-o">(</span><span class="tok-n">JSON</span><span class="tok-o">,</span> <span class="tok-n">readNote</span><span class="tok-o">.</span><span class="tok-na">toJson</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">());</span>
            <span class="tok-n">Request</span> <span class="tok-n">request</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">Builder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">url</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">requestBody</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">addHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Authorization&quot;</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;Bearer %s&quot;</span><span class="tok-o">,</span> <span class="tok-n">accessToken</span><span class="tok-o">))</span>
                    <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
            <span class="tok-n">Response</span> <span class="tok-n">res</span> <span class="tok-o">=</span> <span class="tok-n">httpClient</span><span class="tok-o">.</span><span class="tok-na">newCall</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">).</span><span class="tok-na">execute</span><span class="tok-o">();</span>
            <span class="tok-n">currentCount</span><span class="tok-o">++;</span>
            <span class="tok-n">publishProgress</span><span class="tok-o">(</span><span class="tok-n">currentCount</span><span class="tok-o">,</span> <span class="tok-n">totalNumber</span><span class="tok-o">);</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">res</span><span class="tok-o">.</span><span class="tok-na">isSuccessful</span><span class="tok-o">())</span> <span class="tok-o">{</span>
                <span class="tok-n">uploaded</span><span class="tok-o">++;</span>
            <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
                <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">error</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Exception</span><span class="tok-o">(</span><span class="tok-n">res</span><span class="tok-o">.</span><span class="tok-na">body</span><span class="tok-o">().</span><span class="tok-na">string</span><span class="tok-o">());</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Log</span><span class="tok-o">.</span><span class="tok-na">e</span><span class="tok-o">(</span><span class="tok-n">TAG</span><span class="tok-o">,</span> <span class="tok-s">&quot;Error - Exception&quot;</span><span class="tok-o">,</span> <span class="tok-n">e</span><span class="tok-o">);</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">error</span> <span class="tok-o">=</span> <span class="tok-n">e</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">uploaded</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mobile_app_self_defence">1.4. Mobile App Self-Defence</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Do&#8217;s</th>
<th class="tableblock halign-left valign-top">Dont&#8217;s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Detect compromised environments (rooted/jaibreak) at runtime and react accordingly</strong> <em>(Ensure the environment is not tampered with)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Obfuscation is not protection, assume everything in the code is public.</strong> <em>(Application code <strong>can</strong> be deobfuscated)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Integrity check of the binary</strong> <em>(Ensure the app itself is not tampered with)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify and check the integrity of dynamic resources</strong> <em>(Ensure those resources are not tampered with)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Disable debugging in the application settings</strong> <em>(Make sure the app is not debuggable)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Check if the device is in developer mode if supported by platform</strong> <em>(Prevent app debugging)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Check if debugger is attached and/or if the process is being traced</strong> <em>(Prevent app debugging)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Check lockscreen/passcode is enabled on the device</strong> <em>(Make sure device is secure)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Consider blocking access if devices are out of date</strong> <em>(Ensure device has no known vulnerabilities)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app implements two or more functionally independent methods of root detection.</strong> <em>(Use a dual verification approach)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app implements multiple functionally independent debugging defences.</strong> <em>(Prevent a debugger from being attached that can view app data).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app detects, and response to, being run in an emulator using any method.</strong> <em>(An emulator can be tampered with more easily than a hardware device)</em>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app detects, and responds to, modifications of process memory, including relocation table patches and injected code.</strong> <em>(Ensure that the operating environment of the App is safe before running it.)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify all executable files and libraries belonging to the app are either encrypted on the file level and/or important code and data segments inside the executables are encrypted or packed.</strong> <em>(Sensitive or secret code/resources should be protected.)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that the app implements a 'device binding' functionality when a mobile device is treated as being trusted. Verify that the device fingerprint is derived from multiple device properties.</strong> <em>(Improve device identity/integrity).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verify that if the architecture requires sensitive computations be performed on the client-side, these computations are isolated from the operating system by using a hardware-based SE or TEE.</strong> <em>(Sensitive operations should be carried out away from the main processor in a Trusted Execution Environment).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Perform user interaction anomaly detection.</strong> <em>(Allows the identification of abnormal app usage by a user that may be malicious).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Consider only starting the app if it is running on the latest version or block requests from old versions of the app.</strong> <em>(Older versions maybe have logic or security issues).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Out-of-appstore security updates should be shipped using an encrypted connection.</strong> <em>(Ensure that the security patch has not been tampered with in transit).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ensure that the installation package and its updates shall be digitally signed such that its platform can cryptographically verify them prior to installation.</strong> <em>(Verify integrity before applying the update).</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="implementation_4">1.4.1. Implementation</h4>
<div class="sect4">
<h5 id="overview_4">Overview</h5>
<div class="paragraph">
<p>A number of checks were implemented to assess the security of the underlying device running the application.</p>
</div>
</div>
<div class="sect4">
<h5 id="code_examples_3">Code Examples</h5>
<div class="paragraph">
<p>The main code logic is found under <a href="https://github.com/feedhenry/mobile-security-android-template/tree/master/app/src/main/java/com/feedhenry/securenativeandroidtemplate/features/device">here</a>.</p>
</div>
<div class="paragraph">
<p>The following code snippets below describe the main device trust detection logic in the mobile app.</p>
</div>
<div class="sect5">
<h6 id="detecting_root_access">Detecting Root Access</h6>
<div class="paragraph">
<p>Device Root Access detection has been added using the <a href="https://github.com/scottyab/rootbeer">Rootbeer</a> library. This library uses a number of different checks to check if root access is present on the device.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Detect if the device is rooted.</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">detectRoot</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">totalTests</span><span class="tok-o">++;</span>
    <span class="tok-n">RootBeer</span> <span class="tok-n">rootBeer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">RootBeer</span><span class="tok-o">(</span><span class="tok-n">context</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">rootBeer</span><span class="tok-o">.</span><span class="tok-na">isRooted</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">rootAccess</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">root_detected_positive</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_if_lock_screen_set">Detecting if Lock Screen Set</h6>
<div class="paragraph">
<p>Detecting if the Android device has a lock screen set (with pin, fingerprint, pattern etc) can be checked using the <a href="https://developer.android.com/reference/android/app/KeyguardManager.html">KeyguardManager</a> class in Android M or higher.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Detect if the device has a lock screen setup (pin, password etc).</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">detectDeviceLock</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">VERSION</span><span class="tok-o">.</span><span class="tok-na">SDK_INT</span> <span class="tok-o">&gt;=</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">VERSION_CODES</span><span class="tok-o">.</span><span class="tok-na">M</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">totalTests</span><span class="tok-o">++;</span>
        <span class="tok-n">KeyguardManager</span> <span class="tok-n">keyguardManager</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">KeyguardManager</span><span class="tok-o">)</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">getSystemService</span><span class="tok-o">(</span><span class="tok-n">KEYGUARD_SERVICE</span><span class="tok-o">);</span>
        <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">keyguardManager</span><span class="tok-o">.</span><span class="tok-na">isDeviceSecure</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">lockScreenSetup</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">device_lock_detected_negative</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-n">lockScreenSetup</span><span class="tok-o">.</span><span class="tok-na">setVisibility</span><span class="tok-o">(</span><span class="tok-n">View</span><span class="tok-o">.</span><span class="tok-na">GONE</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_if_debugger_is_attached">Detecting if Debugger is Attached</h6>
<div class="paragraph">
<p>Detecting if an Android debugger is attached to the application can be checked using the <a href="https://developer.android.com/reference/android/os/Debug.html">Debug</a> class.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Detect if a debugger is attached to the application.</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">debuggerDetected</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">totalTests</span><span class="tok-o">++;</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">Debug</span><span class="tok-o">.</span><span class="tok-na">isDebuggerConnected</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">debuggerAccess</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">debugger_detected_positive</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_emulator_access">Detecting Emulator Access</h6>
<div class="paragraph">
<p>Detecting if the Application is being run on an emulator can be performed by checking a number of sources for evidence of emulator access.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Helper function to detect if the host is an emulator</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @return boolean</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmulator</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">FINGERPRINT</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;generic&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">||</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">FINGERPRINT</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;unknown&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">||</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">MODEL</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s">&quot;google_sdk&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">||</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">MODEL</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s">&quot;Emulator&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">||</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">MODEL</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s">&quot;Android SDK built for x86&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">||</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">SERIAL</span> <span class="tok-o">==</span> <span class="tok-kc">null</span>
            <span class="tok-o">||</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">MANUFACTURER</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s">&quot;Genymotion&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">||</span> <span class="tok-o">(</span><span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">BRAND</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;generic&quot;</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">DEVICE</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;generic&quot;</span><span class="tok-o">))</span>
            <span class="tok-o">||</span> <span class="tok-s">&quot;google_sdk&quot;</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">PRODUCT</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_hooking_framework_apps">Detecting Hooking Framework Apps</h6>
<div class="paragraph">
<p>There are some simple checks added to the application to check if the <a href="http://repo.xposed.info/module/de.robv.android.xposed.installer">Xposed Framework</a> or <a href="http://www.cydiasubstrate.com">Cydia Substrate</a> are installed on the device, which can be used to attack and tamper with logic in an Android applications.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Detect if a hooking framework application is installed on the device</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">detectHookingFramework</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">totalTests</span><span class="tok-o">++;</span>
    <span class="tok-n">String</span> <span class="tok-n">xposedPackageName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;de.robv.android.xposed.installer&quot;</span><span class="tok-o">;</span>
    <span class="tok-n">String</span> <span class="tok-n">substratePackageName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;com.saurik.substrate&quot;</span><span class="tok-o">;</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">checkAppInstalled</span><span class="tok-o">(</span><span class="tok-n">xposedPackageName</span><span class="tok-o">)</span> <span class="tok-o">||</span> <span class="tok-n">checkAppInstalled</span><span class="tok-o">(</span><span class="tok-n">substratePackageName</span><span class="tok-o">))</span> <span class="tok-o">{</span>
        <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">hookingDetected</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">hooking_detected_positive</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_app_data_backup_enabled">Detecting App Data Backup Enabled</h6>
<div class="paragraph">
<p>The application can check if the <code>allowBackup</code> flag in the applications <code>AndroidManifest.xml</code> file is set to true. If this flag is set to true, it is possible for an attacker to recover application data from the device without requiring root access.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Function to check if the backup flag is enabled in the application manifest file</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">detectBackupEnabled</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">totalTests</span><span class="tok-o">++;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">PackageInfo</span> <span class="tok-n">packageInfo</span><span class="tok-o">;</span>
        <span class="tok-n">packageInfo</span> <span class="tok-o">=</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">getPackageManager</span><span class="tok-o">().</span><span class="tok-na">getPackageInfo</span><span class="tok-o">(</span><span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">getPackageName</span><span class="tok-o">(),</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
        <span class="tok-k">if</span> <span class="tok-o">((</span><span class="tok-n">packageInfo</span><span class="tok-o">.</span><span class="tok-na">applicationInfo</span><span class="tok-o">.</span><span class="tok-na">flags</span> <span class="tok-o">&amp;</span> <span class="tok-n">ApplicationInfo</span><span class="tok-o">.</span><span class="tok-na">FLAG_ALLOW_BACKUP</span><span class="tok-o">)</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">allowBackup</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">allow_backup_detected_positive</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">PackageManager</span><span class="tok-o">.</span><span class="tok-na">NameNotFoundException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_out_of_date_os_version">Detecting Out of Date OS Version</h6>
<div class="paragraph">
<p>The devices OS version can be checked using the <a href="https://developer.android.com/reference/android/os/Build.html">Build</a> class to see if the device is not running the latest of Android.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Function to check if the device is running the latest Android OS</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">detectLatestOS</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// todo: find if there is a better way to define what the latest android version is</span>
    <span class="tok-kt">int</span> <span class="tok-n">latestOsApiLevel</span> <span class="tok-o">=</span> <span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">VERSION_CODES</span><span class="tok-o">.</span><span class="tok-na">M</span><span class="tok-o">;</span>
    <span class="tok-n">totalTests</span><span class="tok-o">++;</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">Build</span><span class="tok-o">.</span><span class="tok-na">VERSION</span><span class="tok-o">.</span><span class="tok-na">SDK_INT</span> <span class="tok-o">&lt;</span> <span class="tok-n">latestOsApiLevel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">deviceOS</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">device_os_latest_negative</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="detecting_developer_mode_enabled">Detecting Developer Mode Enabled</h6>
<div class="paragraph">
<p>The Developer Mode status can be checked using the <a href="https://developer.android.com/reference/android/provider/Settings.html">Settings</a> class in Android.</p>
</div>
<div class="listingblock">
<div class="title">Code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span class="tok-cm">/**</span>
<span class="tok-cm"> * Detect if the developer options mode is enabled on the device</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">detectDeveloperOptions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">totalTests</span><span class="tok-o">++;</span>
    <span class="tok-kt">int</span> <span class="tok-n">devOptionsEnabled</span> <span class="tok-o">=</span> <span class="tok-n">Settings</span><span class="tok-o">.</span><span class="tok-na">Secure</span><span class="tok-o">.</span><span class="tok-na">getInt</span><span class="tok-o">(</span><span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">getContentResolver</span><span class="tok-o">(),</span>
            <span class="tok-n">Settings</span><span class="tok-o">.</span><span class="tok-na">Global</span><span class="tok-o">.</span><span class="tok-na">DEVELOPMENT_SETTINGS_ENABLED</span><span class="tok-o">,</span>
            <span class="tok-mi">0</span><span class="tok-o">);</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">devOptionsEnabled</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">setDetected</span><span class="tok-o">(</span><span class="tok-n">developerOptions</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">.</span><span class="tok-na">string</span><span class="tok-o">.</span><span class="tok-na">developer_options_positive</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling_sensitive_data_overview">1.5. Handling Sensitive Data Overview</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do&#8217;s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dont&#8217;s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sensitive data should stay in RAM for as little time as possible</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Send sensitive data over alternate channels (e.g, SMS, MMS, or notifications)</strong> <em>(They are not encrypted)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Address Space Layout Randomization (ASLR) should be taken advantage of</strong> <em>(Limit the impact of attacks such as buffer overflow)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Encryption keys remain in RAM during the instance lifecycle of the app.</strong> <em>(Prevent the key from being read from memory)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>minimize the use of APIs that access sensitive or personal user data</strong> <em>(Prevent data leak)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Write data to log files</strong> <em>(Other applications can access the log data)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Consider using a hash or non-reversible form of the data</strong> <em>(To protect the original data)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Store/cache sensitive data on the device</strong> <em>(It can be leakded)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>minimize the frequency of asking for user credentials. Instead use an authorization token and refresh it</strong> <em>(Less chance of exposing user credentials)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>storing/logging GPS data</strong> <em>(Protect user privacy)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use secure POST to send user data, with XSRF token protection</strong> <em>(Query params in URL are logged)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sending crash logs over the network in plaintext</strong> <em>(Can contain sensitive info)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Add an additional layer of verified, third-party encryption (e.g., SQLCipher) to the data as device encryption is not sufficient</strong> <em>(Extra layer of protection)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="cryptography_summary">1.6. Cryptography Summary</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Do&#8217;s</th>
<th class="tableblock halign-left valign-top">Dont&#8217;s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply cryptographic standards that will withstand the test of time for at least 10 years into the future</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Including the keys in the same attacker-readable directory as the encrypted content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <a href="http://csrc.nist.gov/groups/STM/cmvp/documents/140-1/140val-all.htm">NIST FIPS-validated</a> crypto modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use of hardcoded keys within the binary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use NIST approved or NSA approved key management technology and processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creation and Use of Custom Encryption Protocols</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended minimal key lengths and algorithms
</p><p class="tableblock">Key exchange : Diffie–Hellman with a minimum of 2048 bits
</p><p class="tableblock">Message Integrity: HMAC-SHA2 (or HMAC-SHA-256)
</p><p class="tableblock">Message Hash: SHA2 256 bits
</p><p class="tableblock">Assymetric encryption: RSA 2048 bits
</p><p class="tableblock">Symmetric-key algorithm: AES 128 bits (CBC or GCM)
</p><p class="tableblock">Password Hashing: PBKDF2, Scrypt, Bcrypt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use of Insecure and/or Deprecated Algorithms, like RC2, MD5, MD4, SHA1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the same cryptographic key for multiple purposes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random values are generated using a sufficiently secure random number generator</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references_2">2. References</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="owasp_top_10_mobile_risks">2.1. OWASP Top 10 Mobile Risks</h3>
<div class="paragraph">
<p>This is a summary of the <a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=Top_10_Mobile_Risks">OWASP Top 10 Mobile Risks Project for 2017</a>.</p>
</div>
<div class="sect3">
<h4 id="m1_improper_platform_usage">2.1.1. M1 - Improper Platform Usage</h4>
<div class="sect4">
<h5 id="threat_agents">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Misuse of a platform feature or failure to use platform security controls (Include Android intents, platform permissions, misuse of TouchID, the Keychain etc).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>The organization must expose a web service or API call that is consumed by the mobile app.</p>
</li>
<li>
<p>The exposed service or API call is implemented using insecure coding techniques that produce an <a href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project">OWASP Web Top Ten or Cloud Top Ten</a> within the server.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Violation of published guidelines</p>
</li>
<li>
<p>Violation of convention or common practice</p>
</li>
<li>
<p>Unintentional Misuse</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Secure coding and configuration practices must be used on server-side of the mobile application. See the  <a href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project">OWASP Web Top Ten or Cloud Top Ten</a> projects.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m2_insecure_data_storage">2.1.2. M2 - Insecure Data Storage</h4>
<div class="sect4">
<h5 id="threat_agents_2">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>An adversary that has attained a lost/stolen mobile device</p>
</li>
<li>
<p>Malware or another repackaged app acting on the adversary&#8217;s behalf that executes on the mobile device.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_2">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Development teams assume that users or malware will not have access to a mobile device&#8217;s filesystem and subsequent sensitive information in data-stores on the device</p>
</li>
<li>
<p>Usage of poor encryption libraries</p>
</li>
<li>
<p>Rooting or jailbreaking a mobile device circumvents any encryption protections</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_2">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Data stored insecurely includes, but is not limited to, the following:</p>
<div class="ulist">
<ul>
<li>
<p>SQL databases</p>
</li>
<li>
<p>Log files</p>
</li>
<li>
<p>XML data stores ou manifest files</p>
</li>
<li>
<p>Binary data stores</p>
</li>
<li>
<p>Cookie stores</p>
</li>
<li>
<p>SD card</p>
</li>
<li>
<p>Cloud synced</p>
</li>
</ul>
</div>
</li>
<li>
<p>Unintended data leakage includes, but is not limited to, vulnerabilities from:</p>
<div class="ulist">
<ul>
<li>
<p>The OS</p>
</li>
<li>
<p>Frameworks</p>
</li>
<li>
<p>Compiler environment</p>
</li>
<li>
<p>New hardware</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_2">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Understand the information assets the app processes and how the APIs handle those assets. E.g.</p>
<div class="ulist">
<ul>
<li>
<p>URL caching (both request and response)</p>
</li>
<li>
<p>Keyboard press caching</p>
</li>
<li>
<p>Copy/Paste buffer caching</p>
</li>
<li>
<p>Application backgrounding</p>
</li>
<li>
<p>Intermediate data</p>
</li>
<li>
<p>Logging</p>
</li>
<li>
<p>HTML5 data storage</p>
</li>
<li>
<p>Browser cookie objects</p>
</li>
<li>
<p>Analytics data sent to 3rd parties</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m3_insecure_communication">2.1.3. M3 - Insecure Communication</h4>
<div class="sect4">
<h5 id="threat_agents_3">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>An adversary that shares your local network (compromised or monitored Wi-Fi)</p>
</li>
<li>
<p>Carrier or network devices (routers, cell towers, proxy&#8217;s, etc)</p>
</li>
<li>
<p>Malware on your mobile device</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_3">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Do not protect network traffic</p>
</li>
<li>
<p>Use SSL/TLS during authentication but not elsewhere</p>
</li>
<li>
<p>The use of transport security does not mean the app has implemented it correctly</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_3">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Lack of certificate inspection</p>
<div class="ulist">
<ul>
<li>
<p>the mobile app fails to inspect the certificate offered by the server and the mobile app unconditionally accepts any certificate offered to it by the server</p>
</li>
</ul>
</div>
</li>
<li>
<p>Weak handshake negotiation</p>
<div class="ulist">
<ul>
<li>
<p>The client successfully negotiates with the server to use a weak cipher suite that results in weak encryption that can be easily decrypted by the adversary.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Privacy information leakage</p>
<div class="ulist">
<ul>
<li>
<p>The mobile app transmits personally identifiable information to an endpoint via non-secure channels instead of over SSL.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_3">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>General Best Practices</p>
<div class="ulist">
<ul>
<li>
<p>Assume that the network layer is not secure and is susceptible to eavesdropping.</p>
</li>
<li>
<p>Apply SSL/TLS to transport channels that the mobile app will use to transmit sensitive data to a backend API or web service.</p>
</li>
<li>
<p>Account for outside entities like third-party analytics companies, social networks, etc. by using their SSL versions when an application runs a routine via the browser/webkit. Avoid mixed SSL sessions as they may expose the user’s session ID.</p>
</li>
<li>
<p>Use strong, industry standard cipher suites with appropriate key lengths.</p>
</li>
<li>
<p>Use certificates signed by a trusted CA provider.</p>
</li>
<li>
<p>Never allow self-signed certificates, and consider certificate pinning for security conscious applications.</p>
</li>
<li>
<p>Always require SSL chain verification.</p>
</li>
<li>
<p>Only establish a secure connection after verifying the identity of the endpoint server using trusted certificates in the key chain.</p>
</li>
<li>
<p>Alert users through the UI if the mobile app detects an invalid certificate.</p>
</li>
<li>
<p>Do not send sensitive data over alternate channels (e.g, SMS, MMS, or notifications).</p>
</li>
<li>
<p>If possible, apply a separate layer of encryption to any sensitive data before it is given to the SSL channel. In the event that future vulnerabilities are discovered in the SSL implementation, the encrypted data will provide a secondary defense against confidentiality violation.</p>
</li>
</ul>
</div>
</li>
<li>
<p>iOS Specific Best Practices</p>
<div class="ulist">
<ul>
<li>
<p>Ensure that certificates are valid and fail closed.</p>
</li>
<li>
<p>When using CFNetwork, consider using the Secure Transport API to designate trusted client certificates. In almost all situations, NSStreamSocketSecurityLevelTLSv1 should be used for higher standard cipher strength.</p>
</li>
<li>
<p>After development, ensure all NSURL calls (or wrappers of NSURL) do not allow self signed or invalid certificates such as the NSURL class method setAllowsAnyHTTPSCertificate.</p>
</li>
<li>
<p>Consider using certificate pinning by doing the following: export your certificate, include it in your app bundle, and anchor it to your trust object. Using the NSURL method connection:willSendRequestForAuthenticationChallenge: will now accept your cert.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Android Specific Best Practices</p>
<div class="ulist">
<ul>
<li>
<p>Remove all code after the development cycle that may allow the application to accept all certificates such as org.apache.http.conn.ssl.AllowAllHostnameVerifier or SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER. These are equivalent to trusting all certificates.</p>
</li>
<li>
<p>If using a class which extends SSLSocketFactory, make sure checkServerTrusted method is properly implemented so that server certificate is correctly checked.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m4_insecure_authentication">2.1.4. M4 - Insecure Authentication</h4>
<div class="sect4">
<h5 id="threat_agents_4">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Through automated attacks that use available or custom-built tools</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_4">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Poor or missing authentication schemes</p>
</li>
<li>
<p>Authentication requirements for mobile apps can be quite different from traditional web authentication schemes due to availability requirements.</p>
</li>
<li>
<p>Mobile apps may have uptime requirements that require offline authentication</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_4">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app is able to anonymously execute a backend API service request without providing an access token</p>
</li>
<li>
<p>The mobile app stores passwords or shared secrets locally on the device</p>
</li>
<li>
<p>The mobile app uses a weak password policy to simplify entering a password</p>
</li>
<li>
<p>The mobile app uses a feature like TouchID</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_4">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Authentication requirements of mobile applications should match that of the web application component</p>
</li>
<li>
<p>Authenticating a user locally can lead to client-side bypass vulnerabilities.</p>
</li>
<li>
<p>Where possible, ensure that all authentication requests are performed server-side.</p>
</li>
<li>
<p>If client-side storage of data is required, the data will need to be encrypted using an encryption key that is securely derived from the user’s login credentials.</p>
</li>
<li>
<p>Persistent authentication (Remember Me) functionality implemented within mobile applications should never store a user’s password on the device</p>
</li>
<li>
<p>Ideally, mobile applications should utilize a device-specific authentication token that can be revoked within the mobile application by the user</p>
</li>
<li>
<p>Do not use any spoof-able values for authenticating a user (like device identifiers or geo-location)</p>
</li>
<li>
<p>Persistent authentication within mobile applications should be implemented as opt-in and not be enabled by default</p>
</li>
<li>
<p>If possible, do not allow users to provide 4-digit PIN numbers for authentication passwords</p>
</li>
<li>
<p>Developers should assume all client-side authorization and authentication controls can be bypassed by malicious users. Authorization and authentication controls must be re-enforced on the server-side whenever possible</p>
</li>
<li>
<p>Due to offline usage requirements, mobile apps may be required to perform local authentication or authorization checks within the mobile app&#8217;s code. If this is the case, developers should instrument local integrity checks within their code to detect any unauthorized code changes.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m5_insufficient_cryptography">2.1.5. M5 - Insufficient Cryptography</h4>
<div class="sect4">
<h5 id="threat_agents_5">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Anyone with physical access to data that has been encrypted improperly</p>
</li>
<li>
<p>Mobile malware acting on an adversary&#8217;s behalf</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_5">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Weak encryption algorithms or flaws within the encryption process</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_5">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app may use a process behind the encryption / decryption that is fundamentally flawed and can be exploited by the adversary to decrypt sensitive data</p>
</li>
<li>
<p>The mobile app may implement or leverage an encryption / decryption algorithm that is weak in nature and can be directly decrypted by the adversary</p>
</li>
<li>
<p>Poor Key Management Processes</p>
<div class="ulist">
<ul>
<li>
<p>Including the keys in the same attacker-readable directory as the encrypted content</p>
</li>
<li>
<p>Making the keys otherwise available to the attacker</p>
</li>
<li>
<p>Avoid the use of hardcoded keys within your binary</p>
</li>
<li>
<p>Keys may be intercepted via binary attacks</p>
</li>
</ul>
</div>
</li>
<li>
<p>Creation and Use of Custom Encryption Protocols</p>
</li>
<li>
<p>Use of Insecure and/or Deprecated Algorithms</p>
<div class="ulist">
<ul>
<li>
<p>RC2</p>
</li>
<li>
<p>MD4</p>
</li>
<li>
<p>MD5</p>
</li>
<li>
<p>SHA1</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_5">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Avoid the storage of any sensitive data on a mobile device where possible</p>
</li>
<li>
<p>Apply cryptographic standards that will withstand the test of time for at least 10 years into the future</p>
</li>
<li>
<p>Follow the NIST guidelines on recommended algorithms</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m6_insecure_authorization">2.1.6. M6 - Insecure Authorization</h4>
<div class="sect4">
<h5 id="threat_agents_6">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Through automated attacks that use available or custom-built tools</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_6">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Poor or missing authorization schemes</p>
</li>
<li>
<p>Authorization requirements are more vulnerable when making authorization decisions within the mobile device instead of through a remote server</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_6">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Presence of Insecure Direct Object Reference (IDOR) vulnerabilities</p>
</li>
<li>
<p>Hidden Endpoints</p>
</li>
<li>
<p>User Role or Permission Transmissions</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_6">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Verify the roles and permissions of the authenticated user using only information contained in backend systems. Avoid relying on any roles or permission information that comes from the mobile device itself</p>
</li>
<li>
<p>Backend code should independently verify that any incoming identifiers associated with a request (operands of a requested operation) that come along with the identify match up and belong to the incoming identity</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m7_poor_code_quality">2.1.7. M7 - Poor Code Quality</h4>
<div class="sect4">
<h5 id="threat_agents_7">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Pass untrusted inputs to method calls made within mobile code</p>
</li>
<li>
<p>Poor code-quality issues are typically exploited via malware or phishing scams</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_7">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Memory leaks, buffer overflows, and other less severe issues that result in bad programming practice</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_7">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Using the wrong API, using an API insecurely, using insecure language constructs, or some other code-level issue</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_7">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Maintain consistent coding patterns that everyone in the organization agrees upon</p>
</li>
<li>
<p>Write code that is easy to read and well-documented</p>
</li>
<li>
<p>When using buffers, always validate that the the lengths of any incoming buffer data will not exceed the length of the target buffer</p>
</li>
<li>
<p>Via automation, identify buffer overflows and memory leaks through the use of third-party static analysis tools</p>
</li>
<li>
<p>Prioritize solving buffer overflows and memory leaks over other 'code quality' issues</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m8_code_tampering">2.1.8. M8 - Code Tampering</h4>
<div class="sect4">
<h5 id="threat_agents_8">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Via malicious forms of the apps hosted in third-party app stores</p>
</li>
<li>
<p>Trick the user into installing the app via phishing attacks</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_8">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>An attacker can either directly modify the code, change the contents of memory dynamically, change or replace the system APIs that the application uses, or modify the application&#8217;s data and resources.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_8">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Technically, all mobile code is vulnerable to code tampering</p>
</li>
<li>
<p>It is important to ask yourself if it is worth detecting and trying to prevent unauthorized code modification.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_8">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Try and detect compromised environments (rooted/jaibreak) at runtime and react accordingly (report to the server or shutdown)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m9_reverse_engineering">2.1.9. M9 - Reverse Engineering</h4>
<div class="sect4">
<h5 id="threat_agents_9">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>Download the targeted app from an app store and analyze it within their own local environment using a suite of different tools.</p>
</li>
<li>
<p>Relatively affordable and well-understood tools</p>
<div class="ulist">
<ul>
<li>
<p>IDA Pro</p>
</li>
<li>
<p>Hopper</p>
</li>
<li>
<p>otool</p>
</li>
<li>
<p>strings</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_9">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Code written in languages / frameworks that allow for dynamic introspection at runtime (Java, .NET, Objective C, Swift) are particularly at risk for reverse engineering.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_9">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Generally, most applications are susceptible to reverse engineering due to the inherent nature of code.</p>
</li>
<li>
<p>An app is said to be susceptible to reverse engineering if an attacker can do any of the following things</p>
<div class="ulist">
<ul>
<li>
<p>Clearly understand the contents of a binary&#8217;s string table</p>
</li>
<li>
<p>Accurately perform cross-functional analysis</p>
</li>
<li>
<p>Derive a reasonably accurate recreation of the source code from the binary</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_9">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Use an obfuscation tool</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="m10_extraneous_functionality">2.1.10. M10 - Extraneous Functionality</h4>
<div class="sect4">
<h5 id="threat_agents_10">Threat Agents</h5>
<div class="ulist">
<ul>
<li>
<p>An attacker seeks to understand extraneous functionality within a mobile app in order to discover hidden functionality in in backend systems</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="weekness_10">Weekness</h5>
<div class="ulist">
<ul>
<li>
<p>Functionality that exposes information related to back-end test, demo, staging, or UAT environments should not be included in a production build</p>
</li>
<li>
<p>Administrative API endpoints, or unofficial endpoints should not be included in final production builds</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vulnerabilities_10">Vulnerabilities</h5>
<div class="ulist">
<ul>
<li>
<p>Developers include hidden backdoor functionality or other internal development security controls that are not intended to be released into a production environment</p>
</li>
<li>
<p>Leaving functionality enabled in the app that was not intended to be released</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="preventations_10">Preventations</h5>
<div class="ulist">
<ul>
<li>
<p>Examine the app&#8217;s configuration settings to discover any hidden switches</p>
</li>
<li>
<p>Verify that all test code is not included in the final production build of the app</p>
</li>
<li>
<p>Examine all API endpoints accessed by the mobile app to verify that these endpoints are well documented and publicly available</p>
</li>
<li>
<p>Examine all log statements to ensure nothing overly descriptive about the backend is being written to the logs</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mobile_application_security_requirements">2.2. Mobile Application Security Requirements</h3>
<div class="paragraph">
<p>This is a review this the <a href="https://www.stigviewer.com/stig/mobile_application_security_requirements_guide/">Mobile Application Security Requirements</a>.</p>
</div>
<div class="sect3">
<h4 id="requirements_in_categories">2.2.1. Requirements in Categories</h4>
<div class="paragraph">
<p>The requirements can be grouped in the following categories</p>
</div>
<div class="sect4">
<h5 id="design_high_level_requirement">Design &amp; High Level Requirement</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must enforce organization-defined limitations on the embedding of data types within other data types.</p>
</li>
<li>
<p>The mobile app must not record or forward sensor data unless explicitly authorized to do so.</p>
</li>
<li>
<p>The mobile app must initialize all parameter values on startup.</p>
</li>
<li>
<p>The mobile app must not be vulnerable to race conditions.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="authentication_authorisation">Authentication &amp; Authorisation</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must implement organization-defined out-of-band authentication under organization-defined conditions.</p>
</li>
<li>
<p>The mobile app must electronically verify Personal Identity Verification (PIV) credentials.</p>
</li>
<li>
<p>The mobile app must fail to an initial state when the application unexpectedly terminates, unless it maintains a secure state at all times.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="secure_data_storage">Secure Data Storage</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must remove temporary files when it terminates.</p>
</li>
<li>
<p>The mobile app must remove cookies or information used to track a users identity when it terminates.</p>
</li>
<li>
<p>The mobile app must not write data to persistent memory accessible to other applications.</p>
</li>
<li>
<p>The mobile app must not lock or set permissions on application files in a manner such that the operating system or an approved backup application cannot copy the files.</p>
</li>
<li>
<p>The mobile app must not change the file permissions of any files other than those dedicated to its own operation.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="secure_network_communication">Secure Network Communication</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must protect the confidentiality and integrity of transmitted information.</p>
</li>
<li>
<p>The mobile app must not transmit error messages to any entity other than authorized audit logs, the MDM, or the device display.</p>
</li>
<li>
<p>The mobile app must utilize ports or protocols in a manner consistent with DoD Ports and Protocols guidance.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="trusted_third_party_libaries">Trusted Third-party libaries</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must not include source code, unreferenced code or subroutines that are never invoked during operation, except for software components and libraries from approved third-party products.</p>
</li>
<li>
<p>The mobile app source code must not contain adware or known malware.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="interaction_with_os_other_apps">Interaction with OS/Other Apps</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must not modify, request, or assign values for operating system parameters unless necessary to perform application functions.</p>
</li>
<li>
<p>The mobile app must not execute as a privileged operating system process unless necessary to perform any app functions.</p>
</li>
<li>
<p>The mobile app must not enable other applications or non-privileged processes to modify software libraries.</p>
</li>
<li>
<p>The mobile app must prevent organization-defined software from executing at higher privilege levels than users executing the software.</p>
</li>
<li>
<p>The mobile app must validate information output from software programs and/or applications defined in SI-15, CCI-0002770 to ensure the information is consistent with the expected content.</p>
</li>
<li>
<p>The mobile app must synchronize internal information system clocks to the MOS-based authoritative time source.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="safe_app_memory_management">Safe App Memory Management</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app must not call functions vulnerable to buffer overflows.</p>
</li>
<li>
<p>The mobile app must not be vulnerable to integer arithmetic vulnerabilities.</p>
</li>
<li>
<p>The mobile app must clear or overwrite memory blocks used to process potentially sensitive data. Sensitive data may include PII, a user&#8217;s location, or authentication credentials.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="secure_cryptography">Secure Cryptography</h5>
<div class="ulist">
<ul>
<li>
<p>Mobile apps involved in the production, control, and distribution of asymmetric cryptographic keys must use approved PKI Class 3 or class 4 certificates and hardware tokens that protect the user&#8217;s private key.</p>
</li>
<li>
<p>Mobile apps involved in the production, control, and distribution of asymmetric cryptographic keys must use approved PKI Class 3 certificates or prepositioned keying material.</p>
</li>
<li>
<p>If the underlying MOS does not provide NIST FIPS-validated crypto modules, the mobile app must implement NIST FIPS-validated cryptography for the following: to provision digital signatures; to generate cryptographic hashes; and to protect unclassified information requiring confidentiality and cryptographic protection in accordance with applicable federal laws, Executive Orders, directives, policies, regulations, and standards.</p>
</li>
<li>
<p>The mobile app must accept Public Key Infrastructure (PKI) credentials.</p>
</li>
<li>
<p>The mobile app must implement NSA-approved cryptography to protect classified information in accordance with applicable federal laws, Executive Orders, directives, policies, regulations, and standards.</p>
</li>
<li>
<p>Mobile apps involved in the production, control, and distribution of symmetric cryptographic keys must use NIST approved or NSA approved key management technology and processes.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="references_to_external_resources">References to External Resources</h5>
<div class="ulist">
<ul>
<li>
<p>The mobile app code must not contain hardcoded references to resources external to the app.</p>
</li>
<li>
<p>A mobile app must not call APIs or otherwise invoke resources external to the mobile app unless such activity serves the documented purposes of the mobile app.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="code_signing">Code Signing</h5>
<div class="ulist">
<ul>
<li>
<p>Unless the MOS manages app signing, the mobile app installation package must be digitally signed in accordance with FIPS 186-3 approved methods.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="secure_mobile_development_guidelines">2.3. Secure Mobile Development Guidelines</h3>
<div class="paragraph">
<p>This is a summary of how to develop secure mobile applications. It is generated based on the contents form the following sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=Secure_M-Development">OWASP Mobile Development Guidelines</a>.</p>
</li>
<li>
<p>The <a href="https://www.enisa.europa.eu/publications/smartphone-secure-development-guidelines-2016">ENISA Smartphone Secure Development Guidelines</a></p>
</li>
<li>
<p>The <a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=Top_10_Mobile_Controls">OWASP Top 10 Mobile Controls</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="authentication_and_password_management">2.3.1. Authentication and Password Management</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instances where the mobile application requires a user to create a password or PIN (eg for offline access), the application should never use a PIN but enforce a password which follows a strong password policy.</p>
</li>
<li>
<p>Mobile devices may offer the possibility of using password patterns which are never to be utilized in place of passwords as sufficient entropy cannot be ensured and they are easily vulnerable to smudge-attacks.</p>
</li>
<li>
<p>Mobile devices may also offer the possibility of using biometric input to perform authentication which should never be used due to issues with false positives/negatives, among others.</p>
</li>
<li>
<p>Wipe/clear memory locations holding passwords directly after their hashes are calculated.</p>
</li>
<li>
<p>Based on risk assessment of the mobile application, consider utilizing two-factor authentication.</p>
</li>
<li>
<p>In scenarios where offline access to data is needed, add an intentional X second delay to the password entry process after each unsuccessful entry attempt (2 is reasonable, also consider a value which doubles after each incorrect attempt).</p>
</li>
<li>
<p>In scenarios where offline access to data is needed, perform an account/application lockout and/or application data wipe after X number of invalid password attempts (10 for example).</p>
</li>
<li>
<p>Based on a risk evaluation, consider adding context information (such as IP location, etc…) during authentication processes in order to perform Login Anomaly Detection.</p>
</li>
<li>
<p>Instead of passwords consider using longer term authorization tokens that can be securely stored on the device</p>
</li>
<li>
<p>Consider using asymmetric cryptography for authentication and authorization purposes.</p>
</li>
<li>
<p>If a password based authentication mechanism is used, ensure that a strong a password policy is being followed. Consider enforcing restrictions about password length and formation, reuse of old user passwords, use of common passwords, password duration, etc. However, do not maintain any representation of the password strength in application storage or the back-end server as it may expose the password in preimage attacks.</p>
</li>
<li>
<p>Do not reveal registered usernames and remove any fingerprint of their existence from verbose error messages.</p>
</li>
<li>
<p>Use authentication that ties back to the end user identity (rather than only to the device identity).</p>
</li>
<li>
<p>If the credentials or keys appear in the user interface (UI) components, try to release the UI frames immediately after use.</p>
</li>
<li>
<p>Ensure passwords and keys are not visible in cache or logs.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="communication_security">2.3.2. Communication Security</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure the application actually and properly validates (by checking the expiration date, issuer, subject, etc…) the server’s SSL certificate.</p>
</li>
<li>
<p>The application should only communicate with and accept data from authorized domain names/systems.</p>
</li>
<li>
<p>To protect against attacks which utilize software such as SSLStrip, implement controls to detect if the connection is not HTTPS with every request using HTTP Strict Transport Security (HSTS).</p>
</li>
<li>
<p>When using SSL/TLS, use certificates signed by trusted Certificate Authority (CA) providers.</p>
</li>
<li>
<p>Enforce secure TLS versions. Safely abort the connection, if this is not possible</p>
</li>
<li>
<p>Introduce certificate pinning.</p>
</li>
<li>
<p>Design the user interface in a way that warns the user if the peer certificate does not match the expected certificate and provide the ability to abort any further interaction.</p>
</li>
<li>
<p>SMS and MMS should not be used to send sensitive data</p>
</li>
<li>
<p>Always use platform supported or vetted frameworks for establishing secure communication channels.</p>
</li>
<li>
<p>Ensure adequate logs on the server are retained about established connections.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="data_storage_and_protection">2.3.3. Data Storage and Protection</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Classify data storage according to sensitivity and apply controls accordingly (e.g. passwords, personal data, location, error logs, etc.). Process, store and use data according to its classification</p>
</li>
<li>
<p>Store sensitive data on the server instead of the client-end device, whenever possible. Assume any data written to device can be recovered.</p>
</li>
<li>
<p>When storing sensitive data on the device, use a file encryption API provided by the OS or other trusted source.</p>
</li>
<li>
<p>Use file encryption API’s which use a secret key protected by the device unlock code and deletable on remote wipe if available.</p>
</li>
<li>
<p>Beyond the time required by the application, don’t store sensitive information on the device (e.g. GPS/tracking).</p>
</li>
<li>
<p>Do not store temp/cached data in a world readable directory. Assume shared storage is untrusted.</p>
</li>
<li>
<p>Use the PBKDF2 function to generate strong keys for encryption algorithms while ensuring high entropy as much as possible. The number of iterations should be set as high as may be tolerated for the environment (with a minimum of 1000 iterations) while maintaining acceptable performance.</p>
</li>
<li>
<p>Sensitive data (such as encryption keys, passwords, credit card #’s, etc…) should stay in RAM for as little time as possible.</p>
</li>
<li>
<p>Encryption keys should not remain in RAM during the instance lifecycle of the app. Instead, keys should be generated real time for encryption/decryption as needed and discarded each time.</p>
</li>
<li>
<p>Address Space Layout Randomization (ASLR) should be taken advantage of to limit the impact of attacks such as buffer overflows.</p>
</li>
<li>
<p>When displaying sensitive information (such as full account numbers), ensure that the sensitive information is cleared from memory (such as from the webView) when no longer needed/displayed.</p>
</li>
<li>
<p>Do not store sensitive data on external storage like SD cards if it can be avoided.</p>
</li>
<li>
<p>Make use of remote wipe and kill switch APIs to remove sensitive information from the device in the event of theft or loss.</p>
</li>
<li>
<p>Use a time based (expiry) type of control which will wipe sensitive data from the mobile device once the application has not communicated with its servers for a given period of time.</p>
</li>
<li>
<p>Automatic application shutdown and/or lockout after X minutes of inactivity (e.g. 5 mins of inactivity).</p>
</li>
<li>
<p>Avoid cached application snapshots in iOS: iOS can capture and store screen captures and store them as images when an application suspends. To avoid any sensitive data getting captured, use one or both of the following options: 1. Use the ‘willEnterBackground’ callback, to hide all the sensitive data. 2. Configure the application in the info.plist file to terminate the app when pushed to background (only use if multitasking is disabled).</p>
</li>
<li>
<p>Prevent applications from being moved and/or run from external storage such as via SD cards.</p>
</li>
<li>
<p>Verify that OS level storage encryption is enabled and the device is protected by a PIN or passphrase.</p>
</li>
<li>
<p>Consider the security of the whole data lifecycle in writing your application (collection over the wire, temporary storage, caching, backup, deletion, etc.).</p>
</li>
<li>
<p>Ensure that during application removal (uninstall operation), any confidential user data and the corresponding app-specific credentials are deleted from the execution environment, the device, and any other storage medium.</p>
</li>
<li>
<p>Apply the principle of minimal disclosure - only collect and disclose data which is required for business use of the application. Identify in the design phase what data is needed, its sensitivity and whether it is appropriate to collect, store and use each data type.</p>
</li>
<li>
<p>Use non-persistent identifiers which are not shared with other apps wherever possible (e.g., do not use the device unique hardware identifiers such as IMEI or UDID as an identifier).</p>
</li>
<li>
<p>Application developers may want to incorporate an application-specific "data kill switch" into their products, to allow the per-app deletion of their application&#8217;s sensitive data when needed (strong authentication is required to protect misuse of such a feature).</p>
</li>
<li>
<p>Do not leak permission-protected data to other applications. This occurs when specific permissions are required to access the data, however an app that has been granted these permissions makes the data available to all other apps without restrictions (e.g., over IPC)</p>
</li>
<li>
<p>Restrict the data that is shared with other applications (e.g., by implementing an Android Content Provider). This can be accomplished using fine-grained permissions (ensure permissions are protected using signature protection level on Android).</p>
</li>
<li>
<p>Restrict broadcast messages (e.g., Android Broadcast Intents) to authorized applications and audit the application’s broadcast messages for sensitive content.</p>
</li>
<li>
<p>Do not allow third party keyboards to be used for inputs that may contain sensitive data (e.g., credentials, credit card information). Prefer a custom keyboard for such inputs instead</p>
</li>
<li>
<p>Disable Auto Correction and Autosuggestion for inputs that contain sensitive data.</p>
</li>
<li>
<p>Disable cut, copy and paste functionalities for inputs that may contain sensitive data or restrict the pasteboard to be accessible only from this application.</p>
</li>
<li>
<p>Introduce input field masking for inputs that contain sensitive data (e.g., passwords).</p>
</li>
<li>
<p>Leverage the hardware-level encryption support for files at the highest supported security level.</p>
</li>
<li>
<p>If the application while the device is locked needs to write data to a file, use temporary caches instead of weakening the encryption mode. Swap the file content when the device is unlocked and the original file is accessible again.</p>
</li>
<li>
<p>Prefer using framework functionality (e.g., Android Content Provider) for data sharing instead of using file system permissions or a custom access scheme on platforms that support this (e.g., Android).</p>
</li>
<li>
<p>Inspect application-initiated custom notification messages for sensitive content</p>
</li>
<li>
<p>Exclude sensitive application files from device backups and cloud synchronization services.</p>
</li>
<li>
<p>If the application allows the arbitrary selection of files from the device storage, consider the use of a white-list to restrict access only to the intended (absolute) file paths</p>
</li>
<li>
<p>Delete application caches on app termination</p>
</li>
<li>
<p>Database files that contain sensitive data (e.g., iOS WebView caches) must be manually removed from the file system. Deleting records using the database API will not necessary lead to complete data removal from database structure.</p>
</li>
<li>
<p>Disable application logging and debug messages in production releases. All exceptions should be handled securely.</p>
</li>
<li>
<p>In the case that the application includes embedded web browsing capabilities (e.g., WebViews), clear stored cookies on app termination or use in-memory cookie storage</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="session_management">2.3.4. Session Management</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Do not rely on client side security controls.  Both authentication and authorization controls should be implemented on the server side.</p>
</li>
<li>
<p>Ensure that the session management is handled securely after the initial authentication, using appropriate secure protocols.</p>
</li>
<li>
<p>Perform a check at the start of each activity/screen to see if the user is in a logged in state and if not, switch to the login state.</p>
</li>
<li>
<p>When an application’s session is timed out, the application should discard and clear all memory associated with the user data, and any master keys used to decrypt the data.</p>
</li>
<li>
<p>Session tokens should be revocable (particularly on the server side).</p>
</li>
<li>
<p>Use lower timeout values to invalidate expired sessions (in contrast to the typical timeout values on traditional (non-mobile) applications).</p>
</li>
<li>
<p>Use unpredictable session identifiers with high entropy.</p>
</li>
<li>
<p>Clear any maintained sensitive data on session termination. Reset the application state and request for user re-authentication.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="secure_the_backend_services_and_the_platform_server_and_apis">2.3.5. Secure the backend services and the platform server and APIs</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Carry out a specific check of your code for sensitive data unintentionally transferred between the mobile device and web-server back-ends and other external interfaces</p>
</li>
<li>
<p>All back-end services (web services) for mobile apps should be tested for vulnerabilities periodically</p>
</li>
<li>
<p>Disable metadata publishing (e.g., metadata for WSDL documents and for WSDL derived objects), in order to prevent unintentional disclosure of potentially sensitive service metadata</p>
</li>
<li>
<p>Ensure that the back-end platform (server) is running with a hardened configuration with the latest security patches applied to the OS, web server and other application components.</p>
</li>
<li>
<p>Ensure adequate logs are retained on the back-end in order to detect and respond to incidents and perform forensics</p>
</li>
<li>
<p>Protect the back-end from client initiated log injections that may corrupt or forge the history of events2</p>
</li>
<li>
<p>Employ rate limiting and throttling on a per-user/IP basis</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="3rd_party_libraries">2.3.6. 3rd Party libraries</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vet the security/authenticity of any third party code/libraries used in your mobile application (e.g. making sure they come from a reliable source, will continue to be supported, contain no backdoors) and ensure that adequate internal approval is obtained to use the code/library.</p>
</li>
<li>
<p>Track all third party frameworks/API’s used in the mobile application for security patches and perform upgrades as they are released.</p>
</li>
<li>
<p>Pay particular attention to validating all data received from and sent to non-trusted third party apps (e.g. ad network software) before incorporating their use into an application.</p>
</li>
<li>
<p>Avoid using third-party libraries that contain main processor-only cryptographic implementations. Prefer using cryptographic framework provided by a platform supported secure hardware (e.g. TEE, SE).</p>
</li>
<li>
<p>Software components that are no longer supported by the vendor or developer must not be used</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="consent_and_privacy_protection">2.3.7. Consent and privacy protection</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check whether your application is collecting personal data</p>
</li>
<li>
<p>Create a privacy policy covering the usage of personal data and make it available to the user especially prior to making consent choices</p>
</li>
<li>
<p>Prior to using personal data consent should be obtained.</p>
</li>
<li>
<p>Consent may be collected in 3 main ways:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>At install time.</p>
</li>
<li>
<p>At run-time when data is sent.</p>
</li>
<li>
<p>Via “opt-in” mechanisms where a user has to explicitly turn on a setting</p>
</li>
</ol>
</div>
</li>
<li>
<p>It should be possible for the user to withdraw consent at any time in the application</p>
</li>
<li>
<p>Audit communication mechanisms to check for unintended leaks</p>
</li>
<li>
<p>Keep a record of user consent for the processing of different types of personal data</p>
</li>
<li>
<p>Check whether data collection (from the user’s device) is not excessive with regard to the consent that has been granted by the user</p>
</li>
<li>
<p>Consider taking advantage of built-in features to require access to device sensors and data</p>
</li>
<li>
<p>Minimize access to sensor data whenever possible</p>
</li>
<li>
<p>Reduce data granularity and anonymize data on the device instead of remotely</p>
</li>
<li>
<p>Require consent prior to providing user data to third parties</p>
</li>
<li>
<p>Reduce retention period on the mobile or remotely to the minimum amount of time needed to provide the service</p>
</li>
<li>
<p>Use privacy enhancing technologies, that support data minimization, anonymization and security of personal data</p>
</li>
<li>
<p>The default settings of the application should provide maximum privacy and security protection for the user</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="protect_paid_resources">2.3.8. Protect paid resources</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Maintain logs of access to paid-for resources in non-repudiable format</p>
</li>
<li>
<p>Check for anomalous usage patterns in paid-for resources usage and trigger re-authentication</p>
</li>
<li>
<p>Consider a white-list model by default for paid-for resources addressing</p>
</li>
<li>
<p>Warn user and obtain consent for any cost implications for app behaviour</p>
</li>
<li>
<p>Follow the OS/device vendor guidelines for implementing In-App payment:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Implement validation of payment receipts on the backend server not on the device</p>
</li>
<li>
<p>Pay specific attention when integrating payment acceptance from a third party wallet</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="secure_software_distribution">2.3.9. Secure software distribution</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Applications must be designed and provisioned to allow updates for security patches, taking into account the requirements for approval by app-stores and the extra delay this may imply</p>
</li>
<li>
<p>Distributing apps through official app-stores</p>
</li>
<li>
<p>Provide feedback channels for users to report security problems with apps such as a security email address</p>
</li>
<li>
<p>If an enterprise app store is used, protect the application signing key with the utmost care</p>
</li>
<li>
<p>Out-of-appstore security updates should be shipped using an encrypted connection and their content should be verified before applying the update</p>
</li>
<li>
<p>Resources used by apps that are updated outside of the app-store normal mechanism must be signed. Apps must verify the signature before accepting the updated resource</p>
</li>
<li>
<p>Do not deploy apps with ad-hoc signing certificates used for development and testing</p>
</li>
<li>
<p>Do not generate one application for multiple environments</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="handle_runtime_code_interpretation_correctly">2.3.10. Handle runtime code interpretation correctly</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Filter user data passed to interpreters.</p>
</li>
<li>
<p>Define comprehensive escape syntax as appropriate.</p>
</li>
<li>
<p>Do not reveal sensitive information such as usernames, personal data and others through error messages.</p>
</li>
<li>
<p>Deny interpreted code direct access to user data and encrypted storage.</p>
</li>
<li>
<p>Strip unused functionalities from interpreters.</p>
</li>
<li>
<p>Limit size of input data passed to interpreters.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="check_device_and_application_integrity">2.3.11. Check device and application integrity</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the device/platform integrity to ensure that the device is not modified.</p>
</li>
<li>
<p>Check the application integrity, check that the application and its resources are not modified</p>
</li>
<li>
<p>Disable developer features</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Disable debugging in the application settings.</p>
</li>
<li>
<p>Check if the device is in developer mode if supported by platform (e.g., Android).</p>
</li>
<li>
<p>Check if debugger is attached and/or if the process is being traced. On platforms with managed code check for managed and native code debuggers</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="code_obfuscation">2.3.12. Code Obfuscation</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obfuscate all sensitive application code where feasible by running an automated code obfuscation program.</p>
</li>
<li>
<p>For applications containing sensitive data, implement anti-debugging techniques (e.g. prevent a debugger from attaching to the process; android:debuggable=”false”).</p>
</li>
<li>
<p>Address Space Layout Randomization (ASLR) should be taken advantage of to hide executable code which could be used to remotely exploit the application and hinder the dumping of application’s memory.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="protect_the_application_from_client_side_injections">2.3.13. Protect the application from client side injections</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the case that the application includes embedded web browsing capabilities (e.g., WebViews), restrict access to third party domains that do not comply with the required security standards, disable any unused platform supported functionalities, such as the plugins, local file accessibility, local content provider (content URL) accessibility and the dynamic code (e.g., JavaScript)execution support. Furthermore, avoid using full screen web interfaces since these can be abused from attackers to create fake application screens</p>
</li>
<li>
<p>Avoid using API calls that provide bridging of dynamic code (e.g., JavaScript) with native code (e.g., Objective-C) since an injection in the dynamic code will lead to native code execution</p>
</li>
<li>
<p>In the case that the application uses JavaScript code running in the context of a file scheme URL, it is recommended to disable any unused platform supported attributes, such as accessing content from other file scheme URL and content from any origin</p>
</li>
<li>
<p>Prevent interaction events when the application is obscured by another interface in the presentation layer in order to mitigate tapjacking attacks</p>
</li>
<li>
<p>In the case that the application requests custom permissions, and older platforms are supported (e.g., earlier than Android 5.0), always verify on the first run of the app that no other application has previously requested the same permissions</p>
</li>
<li>
<p>Always follow the domain name registration infrastructure to declare a custom permission, in order to avoid any collisions with other apps</p>
</li>
<li>
<p>Restrict what apps can cause an application component (e.g., Android Activity) to start or are able to interact with it (e.g., Android Service and Content Provider)</p>
</li>
<li>
<p>Restrict the third party applications whose broadcast messages will be accepted by the application.</p>
</li>
<li>
<p>In the case that the application utilizes a platform provided download manager, always verify that the received manager’s notifications are related to application’s initiated downloads</p>
</li>
<li>
<p>Always verify dynamic code downloads and application updates at the client side.</p>
</li>
<li>
<p>Always validate server responses when using backend APIs.</p>
</li>
<li>
<p>Mitigate SQL injections, local file inclusion, JavaScript injections, XML injections. When dealing with dynamic queries (e.g., SQL queries with untrusted inputs) or Content-Providers ensure you are using parameterized queries. Always validate user provided inputs that will be used for file accessing purposes or as part of a dynamic code execution. Use a vetted framework for XML operations.</p>
</li>
<li>
<p>Protect from memory corruptions in applications that are developed using a programming language which supports explicit memory management (e.g., Objective-C, C, C++).</p>
</li>
<li>
<p>Do not use insecure cached data in HTTP connections and in embedded web browsing capabilities (e.g., WebViews).</p>
</li>
<li>
<p>In platforms that support custom applications with accessibility permissions (e.g., Android), exclude sensitive user interface elements from being accessed by accessibility applications</p>
</li>
<li>
<p>Avoid populating webviews loaded from the file URI scheme with user supplied DOM input</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ensure_correct_usage_of_biometric_sensors_and_secure_hardware">2.3.14. Ensure correct usage of biometric sensors and secure hardware</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Always verify that there is a biometric sensor (e.g., Fingerprint reader) present and available on the device before using the API for authentication purposes</p>
</li>
<li>
<p>Always verify that the biometric sensor/secure hardware authentication policy of the in-use platform complies with the application’s authentication policy (passcode required after cold boot, biometric sensor authentication expiration, adding a fingerprint requires pin/passcode/biometric authentication, requirement for biometric sensor being individually paired with secure hardware)</p>
</li>
<li>
<p>Ensure that there are enrolled data using the biometric sensor (e.g., user’s fingerprints and/or user’s iris are registered) before using the API for authentication purposes</p>
</li>
<li>
<p>Ensure that the enrolled biometric data has not been changed since the activation of the authentication control using the biometric sensor</p>
</li>
<li>
<p>The application should not use the biometric sensor for just verifying user presence (e.g., iOS LocalAuthentication).  Instead, the application should use the biometric sensor to access keys stored using a hardware backed keystore/keychain and protected with keychain access control lists (ACL).</p>
</li>
<li>
<p>Ensure that the key material is bound to the secure hardware (e.g., TEE, SE) in platforms that this is optional (e.g., Android)</p>
</li>
<li>
<p>For keys whose key material is inside a secure hardware (e.g., TEE, SE), ensure that cryptographic and user authentication authorizations are also enforced by secure hardware, in platforms that this is optional (e.g., Android).</p>
</li>
<li>
<p>The application should avoid using temporal validity interval authorizations, since they are unlikely to be enforced by the secure hardware because it normally does not have an independent secure real-time clock.</p>
</li>
<li>
<p>Verify that the application’s authentication policy complies with the possibility that different people may enroll for biometric authentication in the same device.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="owasp_cheat_sheet_series">2.4. OWASP Cheat Sheet Series</h3>
<div class="paragraph">
<p>This is a summary of notes taken from the <a href="https://www.owasp.org/index.php/OWASP_Cheat_">OWASP Cheat Sheet Series</a></p>
</div>
<div class="sect3">
<h4 id="cryptographic_requirements">2.4.1. Cryptographic Requirements</h4>
<div class="paragraph">
<p>The recommended minimal key lengths and algorithms by OWASP are outlined below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key exchange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diffie–Hellman with a minimum of 2048 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Integrity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HMAC-SHA2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHA2 256 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assymetric encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA 2048 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Symmetric-key algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AES 128 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password Hashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PBKDF2, Scrypt, Bcrypt</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="certificate_pinning_2">2.4.2. Certificate Pinning</h4>
<div class="paragraph">
<p>Pinning is the process of associating a host with their expected X509 certificate or public key.
Once a certificate or public key is known or seen for a host, the certificate or public key is associated or 'pinned' to the host. If more than one certificate or public key is acceptable, then the program holds a pinset. In this case, the advertised identity must match one of the elements in the pinset.</p>
</div>
<div class="sect4">
<h5 id="pinning_methods">Pinning Methods</h5>
<div class="paragraph">
<p>There are a number of ways you can pin the certificate to the client: the whole certificate, the public key of the certificate or a hash of the information.</p>
</div>
<div class="sect5">
<h6 id="certificate">Certificate</h6>
<div class="paragraph">
<p>The certificate is the easiest to pin to the client. However, one of the main downsides is having to update the app with a new certificate every time the cert expires, cert rotation or a CA is compromised.</p>
</div>
</div>
<div class="sect5">
<h6 id="public_key">Public Key</h6>
<div class="paragraph">
<p>Public key pinning is more flexible. As with a certificate, the program checks the extracted public key with its embedded copy of the public key. This will mean that if a cert is rotated or expires, and the public key doesn&#8217;t change in the process, you don&#8217;t need to update your applications with new certificates, as we are only concerned with a public key.
There are some extra steps necessary to extract the public key from a certificate and as the key is static and may violate key rotation policies.</p>
</div>
</div>
<div class="sect5">
<h6 id="hpkp_http_public_key_pinning">HPKP (HTTP Public Key Pinning)</h6>
<div class="paragraph">
<p>With HPKP, a number of public keys are pinned on the server. When a client visits the website for the first time, the client will store these pins.
On every future visit to the website, the client will make sure the public keys match the ones that they have stored locally. If the keys don&#8217;t match, it could mean that the CA was compromised or the keys have been rotated.
This is an example of dynamic pinning, where the entity to pin is retieved dynamically from the server, rather than being packaged or stored locally at development/build time.</p>
</div>
<div class="paragraph">
<p>A valid HPKP configuration must also include at least one backup key. Therefore, if something goes wrong, you can use the backup key instead.</p>
</div>
<div class="paragraph">
<p>The following is an example of the Public-Key-Pins HPKP Header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">Public</span><span class="tok-o">-</span><span class="tok-nx">Key</span><span class="tok-o">-</span><span class="tok-nx">Pins</span><span class="tok-o">:</span>
  <span class="tok-nx">pin</span><span class="tok-o">-</span><span class="tok-nx">sha256</span><span class="tok-o">=</span><span class="tok-s2">&quot;cUPcTAZWKaASuYWhhneDttWpY3oBAkE3h2+soZS7sWs=&quot;</span><span class="tok-p">;</span>
  <span class="tok-nx">pin</span><span class="tok-o">-</span><span class="tok-nx">sha256</span><span class="tok-o">=</span><span class="tok-s2">&quot;M8HztCzM3elUxkcjR2S5P4hhyBNf6lHkmjAHKhpGPWE=&quot;</span><span class="tok-p">;</span>
  <span class="tok-nx">max</span><span class="tok-o">-</span><span class="tok-nx">age</span><span class="tok-o">=</span><span class="tok-mi">5184000</span><span class="tok-p">;</span> <span class="tok-nx">includeSubDomains</span><span class="tok-p">;</span>
  <span class="tok-nx">report</span><span class="tok-o">-</span><span class="tok-nx">uri</span><span class="tok-o">=</span><span class="tok-s2">&quot;https://www.example.org/hpkp-report&quot;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The first <code>pin-sha256</code> is the production public key of the server.</p>
</li>
<li>
<p>The second <code>pin-sha256</code> is the backup key.</p>
</li>
<li>
<p>The <code>max-age</code> tells the client how long to store the keys for.</p>
</li>
<li>
<p>The <code>includeSubDomains</code> definition means that the key pinning is also valid for all subdomains.</p>
</li>
<li>
<p>The <code>report-uri</code> defines where you can report pin validation failures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some potentential issues with HPKP have been pointed out by <a href="https://blog.qualys.com/ssllabs/2016/09/06/is-http-public-key-pinning-dead">Qualys SSL Labs</a>.</p>
</div>
<div class="paragraph">
<p>An example of a helmet.js implementation guide for Node/Express is also available <a href="https://helmetjs.github.io/docs/hpkp/">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="trustkit">TrustKit</h5>
<div class="paragraph">
<p><a href="https://github.com/datatheorem/TrustKit">TrustKit</a> for iOS and <a href="https://github.com/datatheorem/TrustKit-Android">TrustKit-Android</a> for Android allow SSL pinning for native mobile apps.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jailbreaking">2.4.3. Jailbreaking</h4>
<div class="paragraph">
<p>Jailbreaking or rooting is the process of gaining unauthorized access or elevated privileges on a system.</p>
</div>
<div class="sect4">
<h5 id="detecting_jailbreak">Detecting Jailbreak</h5>
<div class="ulist">
<ul>
<li>
<p>Identify 3rd party app stores (e.g. Cydia for iOS) or popular superuser applications.</p>
</li>
<li>
<p>Attempt to identify modified kernels by comparing certain system files that the application would have access to on a non-jailbroken device to known good file hashes. This technique can serve as a good starting point for detection.</p>
</li>
<li>
<p>Attempt to write a file outside of the application’s root directory. The attempt should fail for non-jailbroken devices as they don&#8217;t have the necessary permissions.</p>
</li>
<li>
<p>Generalizing, attempt to identify anomalies in the underlying system or verify the ability to execute privileged functions or methods.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mobile_testing">2.4.4. Mobile Testing</h4>
<div class="paragraph">
<p>The OWASP cheat sheet series also provides in-depth guides on how to analyse a mobile app for security risks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.owasp.org/index.php/Android_Testing_Cheat_Sheet">Android Testing</a></p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/IOS_Developer_Cheat_Sheet">iOS Developer Guide</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="owasp_mobile_verification_standard">2.5. OWASP Mobile Verification Standard</h3>
<div class="paragraph">
<p>This is a fork of the <a href="https://www.owasp.org/images/f/fe/MASVS_v0.9.3.pdf">OWASP Mobile Verification Standard</a>.</p>
</div>
<div class="sect3">
<h4 id="verification_levels">2.5.1. Verification Levels</h4>
<div class="ulist">
<ul>
<li>
<p>MASVS-L1: Standard Security</p>
<div class="ulist">
<ul>
<li>
<p>lists security best practices</p>
</li>
<li>
<p>all mobile apps</p>
</li>
</ul>
</div>
</li>
<li>
<p>MASVS-L2: Defense-in-Depth</p>
<div class="ulist">
<ul>
<li>
<p>introduces advanced security controls</p>
</li>
<li>
<p>should be used by apps that store personally identifiable information, or highly sensitive information, like apps for health-care industry and financial industry</p>
</li>
</ul>
</div>
</li>
<li>
<p>MASVS-R: Resiliency Against Reverse Engineering and Tampering</p>
<div class="ulist">
<ul>
<li>
<p>the app has state-of-the-art security, and is also resillient against specific client side attacks, such as tampering, modding or reverse engineering</p>
</li>
<li>
<p>can be used in combination with the other 2 levels. E.g. MASVS-L1 + R or MASVS-L2 + R</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="table_keys">2.5.2. Table Keys</h4>
<div class="paragraph">
<p><em>Category</em> - The type of work required for each item. Some enhancements have been made.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manual Observation - A task that may only require manual observation. eg. confirming that no sensitive information is being stored in log files.</p>
</li>
<li>
<p>Tooling - A task that may require the use of tooling to carry out the task. eg. pentesting or creating threat models</p>
</li>
<li>
<p>Process - A task that may require some processes to be setup. eg. dependency checks.</p>
</li>
<li>
<p>Coding - A task that requires coding.</p>
</li>
<li>
<p>Keycloak - A task that can be carried out using Keycloak.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>OS/Framework Columns</em> - A column is allocated for each Mobile OS/Framework for any specific details for each item.</p>
</div>
</div>
<div class="sect3">
<h4 id="architecture_design_and_threat_modelling">2.5.3. Architecture, Design and Threat Modelling</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V1</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify all application components are identified and are known to be needed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual/Tooling Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check the <a href="https://cordova.apache.org/docs/en/latest/config_ref/#plugin">config.xml</a> for unrequired components. This also includes any JS files required from a CDN or elsewhere in the index.html or equivalent of an application.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify all third party components used by the mobile app, such as libraries and frameworks, are identified, and checked for known vulnerabilities.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual/Tooling Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check the <a href="https://cordova.apache.org/docs/en/latest/config_ref/#plugin">config.xml</a> for vulnerable components manually or using dependency checker.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that security controls are never enforced only on the client side, but on the respective remote endpoints.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak/Server Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that a high-level architecture for the mobile app and all connected remote services has been defined and security has been addressed in that architecture.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual Observation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See 1.7</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L11+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that data considered sensitive in the context of the mobile app is clearly identified.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify all app components are defined in terms of the business functions and/or security functions they provide.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that a threat model for the mobile app and the associated remote services, which identifies potential threats and countermeasures, has been produced.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tooling Observation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A threat model diagram could be created (perhaps using OWASP Threat Dragon) where we can map out all the potential threats.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify all third party components have been assessed (associated risks) before being used or implemented. Additionally verify that a process is in place to ensure that each time a security update for a third party component is published, the change is inspected and the risk evaluated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual/Tooling/Process Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We could also look at using <a href="https://www.w3.org/TR/SRI/">subresource integrity</a> checks for requiring JS libraries from the internet/CDN within an index.html.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that all security controls have a centralized implementation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual/Keycloak Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that all components that are not part of the application but that the application relies on to operate, are clearly identified and the security implications of using those components are known.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual/Keycloak Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that there is an explicit policy for how cryptographic keys (if any) are managed, and the lifecycle of cryptographic keys is enforced. Ideally, follow a key management standard such as NIST SP 800-57.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that remote endpoints ensure that connecting clients use the current version of the mobile app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that security testing is performed as part of the development lifecycle. If some or all of the testing is automated, the configuration of the testing tools must be tailored to the specific app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual/Tooling Task/Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="data_storage_and_privacy">2.5.4. Data Storage and Privacy</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V2</th>
<th class="tableblock halign-left valign-top">Data Storage and Privacy</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that system credential storage facilities are used appropriately to store sensitive data, such as user credentials or cryptographic keys.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ie. Securely storing content on the device, but also only storing data in the correct features on the OS, and not putting sensitive content where you shouldn’t or using an OS feature for the wrong purpose.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Android we should use the Android <a href="https://developer.android.com/training/articles/keystore.html">Keystore</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We could look at using the following <a href="https://www.npmjs.com/package/cordova-plugin-secure-key-store">cordova plugin</a> to provide secure storage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that no sensitive data is written to application logs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that no sensitive data is shared with third parties unless it is a necessary part of the architecture.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the keyboard cache is disabled on text inputs that process sensitive data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the clipboard is deactivated on text fields that may contain sensitive data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that no sensitive data is exposed via IPC mechanisms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that no sensitive data, such as passwords and credit card numbers, is exposed through the user interface or leaks to screenshots.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We should ensure that no sensitive information is shown as default in the mobile. This should be blurred/hidden behind asterisks instead. We should also ensure that screenshotting functionality is being blocked by the app.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that no sensitive data is included in backups.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We should ensure that the the allowBackup setting is disabled to prevent app data recovery via backups.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We should ensure that the the allowBackup setting is disabled to prevent app data recovery via backups.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app removes sensitive data from views when backgrounded.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabling snapshotting might be sufficient. This will blur/blank-out the screenshot of the application when displayed in the app switcher on the phone.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This could be disabled for iOS using the following <a href="https://www.npmjs.com/package/cordova-plugin-blurred-snapshot">cordova plugin</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app does not hold sensitive data in memory longer than necessary, and memory is cleared explicitly after use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app enforces a minimum device-access-security policy, such as requiring the user to set a device passcode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We could use the following <a href="https://github.com/ABarak64/Cordova-Screen-Lock-Enabled">cordova plugin</a> to check if a device passcode/lock screen has been set.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app educates the user about the types of personally identifiable information processed, as well as security best practices the user should follow in using the app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual Observation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="cryptography">2.5.5. Cryptography</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V3</th>
<th class="tableblock halign-left valign-top">Cryptography</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app does not rely on symmetric cryptography with hardcoded keys as a sole method of encryption.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual Observation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This should be covered by 2.1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app uses proven implementations of cryptographic primitives.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app uses cryptographic primitives that are appropriate for the particular use-case, configured with parameters that adhere to industry best practices.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app does not use cryptographic protocols or algorithms that are widely considered deprecated for security purposes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app doesn&#8217;t re-use the same cryptographic key for multiple purposes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that all random values are generated using a sufficiently secure random number generator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="authentication_and_session_management">2.5.6. Authentication and Session Management</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V4</th>
<th class="tableblock halign-left valign-top">Authentication and Session Management</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that if the app provides users with access to a remote service, an acceptable form of authentication such as username/password authentication is performed at the remote endpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the remote endpoint uses randomly generated access tokens to authenticate client requests without sending the user&#8217;s credentials.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the remote endpoint terminates the existing session when the user logs out.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak has its own logout flow on the server to terminate a user’s session.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that a password policy exists and is enforced at the remote endpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak has an in-depth password policy manager.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the remote endpoint implements an exponential back-off, or temporarily locks the user account, when incorrect authentication credentials are submitted an excessive number of times.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak will allow you to both temporarily and permanently lock out a user after a specified number of failed login attempts.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that biometric authentication, if any, is not event-bound (i.e. using an API that simply returns "true" or "false"). Instead, it is based on unlocking the keychain/keystore.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that sessions are terminated at the remote endpoint after a predefined period of inactivity.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that a second factor of authentication exists at the remote endpoint and the 2FA requirement is consistently enforced.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak can be setup to enforce 2FA. This can also be done on user creation so when the new user logs in for the first time, the second layer of protection will already be enforced.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that step-up authentication is required to enable actions that deal with sensitive data or transactions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We should ensure that Keycloak authentication should be performed again when carrying out a sensitive/important action in the mobile app.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app informs the user of all login activities with his or her account. Users are able view a list of devices used to access the account, and to block specific devices.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak/Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak supports viewing of sessions/IP addresses, but doesn’t currently allow to see user-agents/geo locations of the device.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="network_communication">2.5.7. Network Communication</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V5</th>
<th class="tableblock halign-left valign-top">Network Communication</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that data is encrypted on the network using TLS. The secure channel is used consistently throughout the app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the TLS settings are in line with current best practices, as far as they are supported by the mobile operating system.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app verifies the X.509 certificate of the remote endpoint when the secure channel is established. Only certificates signed by a valid CA are accepted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This could be carried out with client cert auth in keycloak.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app either uses its own certificate store, or pins the endpoint certificate or public key, and subsequently does not establish connections with endpoints that offer a different certificate or key, even if signed by a trusted CA.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak/Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public key pinning might be better than full certificate pinning as handling cert renewals, compromises may be easier to work with, but requires more investigation. We should also consider HPKP.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/datatheorem/TrustKit-Android">TrustKit</a> for Android can be used for certificate pinning.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/datatheorem/TrustKit">TrustKit</a> for iOS can be user for certificate pinning.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Secure HTTP <a href="http://plugins.telerik.com/cordova/plugin/secure-http">cordova plugin</a> will allow certificate pinning.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app doesn&#8217;t rely on a single insecure communication channel (email or SMS) for critical operations, such as enrollments and account recovery.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak has a credentials reset flow which allows you to configure how password/credential resets should be carried out.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app uses some form of whitelisting to control access to external domains.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We should follow the <a href="https://cordova.apache.org/docs/en/7.x/guide/appdev/whitelist/index.html">whitelist guide</a> for controlling external domain access in Cordova.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="environmental_interaction">2.5.8. Environmental Interaction</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V6</th>
<th class="tableblock halign-left valign-top">Environmental Interaction</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app only requires the minimum set of permissions necessary.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Process Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check the <a href="https://developer.android.com/guide/topics/manifest/manifest-intro.html">AndroidManifest.xml</a> for unrequired permissions..</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check the <a href="https://cordova.apache.org/docs/en/latest/config_ref/#plugin">config.xml</a> for unrequired permissions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that all inputs from external sources and the user are validated and if necessary sanitized. This includes data received via the UI, IPC mechanisms such as intents, custom URLs, and network sources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We should ensure that we are HTML encoding data that is coming from the server if it’s being rendered as html.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app does not export sensitive functionality via custom URL schemes, unless these mechanisms are properly protected.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app does not export sensitive functionality through IPC facilities, unless these mechanisms are properly protected.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that JavaScript is disabled in WebViews unless explicitly required.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that WebViews are configured to allow only the minimum set of protocol handlers required (ideally, only https). Potentially dangerous handlers, such as file, tel and app-id, are disabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app does not load user-supplied local resources into WebViews.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that if Java objects are exposed in a WebView, verify that the WebView only renders JavaScript contained within the app package.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some content security policies might be of use here to limit what javascript can be executed from sources.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that object serialization, if any, is implemented using safe serialization APIs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app detects whether it is being executed on a rooted or jailbroken device. Depending on the business requirement, users are warned, or the app is terminated if the device is rooted or jailbroken.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For both iOS and Android we could use the cordova-plugin-iroot.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="code_quality_and_build_settings">2.5.9. Code Quality and Build Settings</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V7</th>
<th class="tableblock halign-left valign-top">Code Quality and Build Settings</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app is signed and provisioned with valid certificate.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Process/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app has been built in release mode, with settings appropriate for a release build (e.g. non-debuggable).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that debugging symbols have been removed from native binaries.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that debugging code has been removed, and the app does not log verbose errors or debugging messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app catches and handles possible exceptions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that error handling logic in security controls denies access by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that in unmanaged code, memory is allocated, freed and used securely.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free security features offered by the toolchain, such as byte-code minification, stack protection, PIE support and automatic reference counting, are activated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1+L2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="resiliency_against_reverse_engineering_requirements">2.5.10. Resiliency Against Reverse Engineering Requirements</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V8</th>
<th class="tableblock halign-left valign-top">Resiliency Against Reverse Engineering Requirements</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
<th class="tableblock halign-left valign-top">Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app implements two or more functionally independent methods of root detection and responds to the presence of a rooted device either by alerting the user or terminating the app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation will be covered by 6.10</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app implements multiple functionally independent debugging defenses that, in context of the overall protection scheme, force adversaries to invest significant manual effort to enable debugging. All available debugging protocols must be covered (e.g. JDWP and native).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It would be a good idea here to crash the debugger/browser where possible.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app detects, and responds to, tampering with executable files and critical data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app detects the presence of widely used reverse engineering tools, such as code injection tools, hooking frameworks and debugging servers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app detects, and response to, being run in an emulator using any method.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app detects, and responds to, modifications of process memory, including relocation table patches and injected code.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app implements multiple different responses to tampering, debugging and emulation (requirements 9.2 - 9.6), including stealthy responses that don&#8217;t simply terminate the app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify all executable files and libraries belonging to the app are either encrypted on the file level and/or important code and data segments inside the executables are encrypted or packed. Trivial static analysis should not reveal important code or data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that obfuscating transformations and functional defenses are interdependent and well-integrated throughout the app.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app implements a 'device binding' functionality when a mobile device is treated as being trusted. Verify that the device fingerprint is derived from multiple device properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that the app uses multiple functionally independent means of emulator detection that, in context of the overall protection scheme, force adversaries to invest significant manual effort to run the app in an emulator (supersedes requirement 8.5).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that if the architecture requires sensitive information be stored on the device, the app only runs on operating system versions and devices that offer hardware-backed key storage. Alternatively, the information is protected using obfuscation. Considering current published research, the obfuscation type and parameters are sufficient to cause significant manual effort to reverse engineers seeking to comprehend or extract the sensitive data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that if the architecture requires sensitive computations be performed on the client-side, these computations are isolated from the operating system by using a hardware-based SE or TEE. Alternatively, the information is protected using obfuscation. Considering current published research, the obfuscation type and parameters are sufficient to cause significant manual effort to reverse engineers seeking to comprehend the sensitive portions of the code and/or data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding Task</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="other_mobile_vulnerabilities">2.5.11. Other Mobile Vulnerabilities</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">V9</th>
<th class="tableblock halign-left valign-top">Other Mobile Vulnerabilities</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Comments</th>
<th class="tableblock halign-left valign-top">Android</th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Cordova</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that Function Level Access Control is being enforced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limited to webviews.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify that there are no insecure direct object references.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coding/Observation Task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limited to webviews.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="owasp_threat_model_project">2.6. OWASP Threat Model Project</h3>
<div class="paragraph">
<p>This is a summary of notes taken from the <a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=M-Threat_Model_Project">OWASP Threat Model Project</a>.</p>
</div>
<div class="sect3">
<h4 id="mobile_threat_model_overview">2.6.1. Mobile Threat Model Overview</h4>
<div class="paragraph">
<p>To carry out threat modelling, you will need to have a clear understanding of the underlying system. Its important to define the following areas to understand possible threat to the mobile application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Mobile App Architecture</strong> - This area describes how the application is designed from device specific features used by the application, such as:</p>
<div class="ulist">
<ul>
<li>
<p>Wireless transmission protocols</p>
</li>
<li>
<p>Data transmission mediums</p>
</li>
<li>
<p>Interaction with hardware components</p>
</li>
<li>
<p>Other applications</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Mobile Data</strong> - This area cover what data does the application store and process, the business purpose of this data and what are the data workflows.</p>
</li>
<li>
<p><strong>Threat Agent Identification</strong> - This area covers the threats to the mobile application and who are the threat agents.</p>
</li>
<li>
<p><strong>Methods of Attack</strong> - This area covers the most common attacks utilized by threat agents.</p>
</li>
<li>
<p><strong>Controls</strong> - This area covers the controls that can be used to prevent attacks.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="mobile_architecture">2.6.2. Mobile Architecture</h4>
<div class="paragraph">
<p>The mobile application architecture should, at the very least, describe device specific features used by the application such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Wireless transmission protocols</p>
</li>
<li>
<p>Data transmission medium</p>
</li>
<li>
<p>Interaction with hardware components and other applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you know what features/resources are used within the mobile app architecture, you can then begin to look at the attack surface.</p>
</div>
<div class="paragraph">
<p>Although mobile applications vary in function, they can be described using a generalized model as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Wireless interfaces</p>
</li>
<li>
<p>Transmission Type</p>
</li>
<li>
<p>Hardware Interaction</p>
</li>
<li>
<p>Interaction with on device applications/services</p>
</li>
<li>
<p>Interaction with off device applications/services</p>
</li>
<li>
<p>Encryption Protocols</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="mobile_data">2.6.3. Mobile Data</h4>
<div class="paragraph">
<p>Its important to know what purpose does the app serve from a business perspective and what data the app stores, transmits and receives.
It’s also important to review data flow diagrams to determine exactly how data in the mobile app is handled.</p>
</div>
<div class="paragraph">
<p>You should aim to answer the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What is the business functions of the app?</p>
</li>
<li>
<p>Does personal data intermingle with corporate data?</p>
</li>
<li>
<p>Is there specific business logic built into the app to process data?</p>
</li>
<li>
<p>What does the data give you (or an attacker) access to?</p>
</li>
<li>
<p>Do stored keys allow you to break crypto functions (data integrity)?</p>
</li>
<li>
<p>Third party data, is it being stored/transmitted?</p>
</li>
<li>
<p>Are there regulatory requirements to meet specific to user privacy?</p>
</li>
<li>
<p>How does other data on the device affect the app (sandboxing restrictions enforced?)</p>
</li>
<li>
<p>What is the impact of Jailbroken/Rooted vs Non Jailbroken/Rooted device and how this affects app data?</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="threat_agent_identification">2.6.4. Threat Agent Identification</h4>
<div class="paragraph">
<p>This area covers what the threats to the mobile application are and who are the threat agents.</p>
</div>
<div class="sect4">
<h5 id="identifying_threat_agents">Identifying Threat Agents</h5>
<div class="paragraph">
<p>The process of identifying a threat agent is very simple and have been mentioned in the below steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>S1: Take the list of all sensitive data</p>
</li>
<li>
<p>S2: Make a list of all the ways to access this data</p>
</li>
<li>
<p>S3: The medium used to access the same listed in S2 above is the Threat Agent to be identified</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="listing_of_threat_agents_by_category">Listing of Threat Agents - By Category</h5>
<div class="sect5">
<h6 id="human_interaction_examples">Human Interaction Examples</h6>
<div class="ulist">
<ul>
<li>
<p>Stolen Device User</p>
</li>
<li>
<p>Owner of the Device</p>
</li>
<li>
<p>WiFi Network User</p>
</li>
<li>
<p>Malicious Developer</p>
</li>
<li>
<p>Organizations Internal Employee</p>
</li>
<li>
<p>App Store Approvers/Reviewers</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="automated_programs_examples">Automated Programs Examples</h6>
<div class="ulist">
<ul>
<li>
<p>Malware on the device</p>
</li>
<li>
<p>Scripts executign in the browser</p>
</li>
<li>
<p>Malicous SMS</p>
</li>
<li>
<p>Malicious App</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="methods_of_attack">Methods of Attack</h5>
<div class="paragraph">
<p>We should observe and list the different methods an attacker can use to reach the data.</p>
</div>
</div>
<div class="sect4">
<h5 id="controls">Controls</h5>
<div class="paragraph">
<p>Given the above methods of attacks, we should outline some contols to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prevent the attacks</p>
</li>
<li>
<p>Detect the attacks</p>
</li>
<li>
<p>Minimize the impack of the attacks</p>
</li>
<li>
<p>Protect users private information</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="owasp_m_tools">2.7. OWASP M-Tools</h3>
<div class="paragraph">
<p>This is a summary of the tools that are described in <a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project#tab=M-Tools">OWASP Mobile Security M Tools</a> page.</p>
</div>
<div class="sect3">
<h4 id="imas">2.7.1. iMAS</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>iOS secure application framework research to reduce iOS application vulnerabilities and information loss</p>
</li>
</ul>
</div>
</li>
<li>
<p>Source code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/project-imas/about">Project iMAS</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Modules</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/project-imas/securefoundation">Secure Foundation Control</a></p>
<div class="ulist">
<ul>
<li>
<p>Cipherlib, crypto manager, keychain crypto</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/project-imas/app-password">AppPassword Control</a></p>
<div class="ulist">
<ul>
<li>
<p>Custom iOS user authentication mechanism (password with security questions for self reset)</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/project-imas/passcode-check">PasscodeCheck Control</a></p>
<div class="ulist">
<ul>
<li>
<p>Allows an application to verify if an iOS passcode has been set and what complexity. Based on this, an application can programtically decide to execute fully or in a degraded state given this system evidence</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/project-imas/encrypted-core-data">Encrypted Core Data</a></p>
<div class="ulist">
<ul>
<li>
<p>Provides a Core Data encrypted SQLite store using SQLCipher.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/project-imas/security-check">Security-check</a></p>
<div class="ulist">
<ul>
<li>
<p>Application level, attached debug detect and jailbreak checking</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/project-imas/memory-security">Memory Security</a></p>
<div class="ulist">
<ul>
<li>
<p>Library for securely clearing and validating iOS application memory</p>
</li>
<li>
<p>Elliminate clear-text sensitive data from memory after app use</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment">Comment</h5>
<div class="paragraph">
<p>Although most of the modules are about 3-4 years old, I think the modules are still highly recommended and we should take a look when we implement some of the features.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="goatdroid">2.7.2. GoatDroid</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>A fully functional and self-contained training environment for educating developers and testers on Android security</p>
</li>
</ul>
</div>
</li>
<li>
<p>Source Code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jackMannino/OWASP-GoatDroid-Project">OWASP-GoatDroid</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment_2">Comment</h5>
<div class="paragraph">
<p>Looks promising, however, looks like the apps are not being maintained for the last 4 years and there are many issues being opened to complain the apps are not working anymore.</p>
</div>
<div class="paragraph">
<p>We should take a look at it and see if there are some values to get it up and running.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="igoat">2.7.3. iGoat</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>A safe environment where iOS developers can learn about the major security pitfalls they face as well as how to avoid them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Source Code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://code.google.com/archive/p/owasp-igoat/source">iGoat</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment_3">Comment</h5>
<div class="paragraph">
<p>Doesn&#8217;t look like the app is being maintained, and doesn&#8217;t appear to work with the latest version of iOS.</p>
</div>
<div class="paragraph">
<p>We can take a quick look but it doesn&#8217;t look like provide a lot of value to us.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="damn_vulnerable_ios_application">2.7.4. Damn Vulnerable iOS Application</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>A project gives mobile testers and developers an iOS application to practice attacking/defending skill sets</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://damnvulnerableiosapp.com/#about">Website</a></p>
</li>
<li>
<p>Source code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/prateek147/DVIA">DIVA</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment_4">Comment</h5>
<div class="paragraph">
<p>Looks much better than iGoat.
Especially the websit has a "Learn" section provides a series of very good blog posts about iOS security.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mobisec">2.7.5. MobiSec</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>The MobiSec Live Environment Mobile Testing Framework project is a live environment for testing mobile environments, including devices, applications, and supporting infrastructure.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://sourceforge.net/projects/mobisec/">Websit</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment_5">Comment</h5>
<div class="paragraph">
<p>The last release was about 5 years ago. Doesn&#8217;t looks like it&#8217;s being maintained properly.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="androick">2.7.6. Androick</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>Androick is a tool that allows any user to analyze an Android application</p>
</li>
</ul>
</div>
</li>
<li>
<p>Soure Code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Flo354/Androick">Androick</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment_6">Comment</h5>
<div class="paragraph">
<p>A nice small tool that could be useful to get all the app files from an Android device.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nowsecure_app_testing_community_edition">2.7.7. NowSecure App Testing Community Edition</h4>
<div class="ulist">
<ul>
<li>
<p>What is it?</p>
<div class="ulist">
<ul>
<li>
<p>It is the freely downloadable version of the powerful App Testing suite. Users are offered a number of features such as network capture, automation, import / export, and reporting to test and secure mobile apps</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.nowsecure.com/open-source/">Website</a></p>
</li>
<li>
<p>Tools</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://santoku-linux.com/">Santoku Linux</a></p>
<div class="ulist">
<ul>
<li>
<p>Santoku is dedicated to mobile forensics, analysis, and security, and packaged in an easy to use, Open Source platform</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/AndroidVTS/android-vts">VTS for Android</a></p>
<div class="ulist">
<ul>
<li>
<p>An app to scan vulnerabilities on Android</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.frida.re/">Frida</a></p>
<div class="ulist">
<ul>
<li>
<p>Inject JavaScript to explore native apps on Windows, macOS, Linux, iOS, Android, and QNX.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://radare.org/r/">Radare</a></p>
<div class="ulist">
<ul>
<li>
<p>Portable reversing framework</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="comment_7">Comment</h5>
<div class="paragraph">
<p>The tools are very useful. We should try them.</p>
</div>
<div class="paragraph">
<p>The NowSecure website also provides some resources/handbooks that could be very helpful. E.g.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mobile Banking Applications: Security Challenges for Banks</p>
</li>
<li>
<p>Mobile App Security Program Management Handbook</p>
</li>
<li>
<p><a href="https://books.nowsecure.com/secure-mobile-development/en/index.html">Secure Mobile Development Guide</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="conclusion">2.7.8. Conclusion</h4>
<div class="paragraph">
<p>I think the tools we should try are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Must</p>
<div class="ulist">
<ul>
<li>
<p>NowSecure App Testing Community Edition</p>
</li>
<li>
<p>Damn Vulnerable iOS Application</p>
</li>
<li>
<p>iMAS</p>
</li>
</ul>
</div>
</li>
<li>
<p>Maybe</p>
<div class="ulist">
<ul>
<li>
<p>Androick</p>
</li>
</ul>
</div>
</li>
<li>
<p>No</p>
<div class="ulist">
<ul>
<li>
<p>GoatDroid</p>
</li>
<li>
<p>iGoat</p>
</li>
<li>
<p>MobiSec</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ios_security_whitepaper">2.8. iOS Security Whitepaper</h3>
<div class="paragraph">
<p>This is a summary of the <a href="https://www.apple.com/business/docs/iOS_Security_Guide.pdf">iOS security whitepaper</a>.</p>
</div>
<div class="sect3">
<h4 id="system_security">2.8.1. System Security</h4>
<div class="sect4">
<h5 id="secure_boot_chain">Secure boot chain</h5>
<div class="paragraph">
<p>Each step of the startup process contains components that are cryptographically signed by Apple to ensure integrity and that proceed only after verifying the chain of trust.</p>
</div>
</div>
<div class="sect4">
<h5 id="system_software_authorization">System Software Authorization</h5>
<div class="ulist">
<ul>
<li>
<p>To prevent devices from being downgraded to older versions that lack the latest security updates, iOS uses a process called System Software Authorization.</p>
</li>
<li>
<p>During an iOS upgrade, iTunes (or the device itself, in the case of OTA software updates) connects to the Apple installation authorization server and sends it a list of cryptographic measurements for each part of the installation bundle to be installed (for example, iBoot, the kernel, and OS image), a random anti-replay value (nonce), and the device’s unique ID (ECID).</p>
</li>
<li>
<p>The authorization server checks the presented list of measurements against versions for which installation is permitted and, if it finds a match, adds the ECID to the measurement and signs the result.
The server passes a complete set of signed data to the device as part of the upgrade process.
Adding the ECID “personalizes” the authorization for the requesting device.
By authorizing and signing only for known measurements, the server ensures that the update takes place exactly as provided by Apple</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="secure_enclave">Secure Enclave</h5>
<div class="ulist">
<ul>
<li>
<p>The Secure Enclave is a coprocessor fabricated in the Apple S2, Apple A7, and later A-series processors</p>
</li>
<li>
<p>Provides all cryptographic operations for Data Protection key management and maintains the integrity of Data Protection even if the kernel has been compromised</p>
</li>
<li>
<p>Additionally, data that is saved to the file system by the Secure Enclave is encrypted with a key entangled with the UID and an anti-replay counter</p>
</li>
<li>
<p>The Secure Enclave is responsible for processing fingerprint data from the Touch ID sensor, determining if there is a match against registered fingerprints, and then enabling access or purchases on behalf of the user</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="touchid">TouchId</h5>
<div class="ulist">
<ul>
<li>
<p>The fingerprint sensor is active only when the capacitive steel ring that surrounds the Home button detects the touch of a finger, which triggers the advanced imaging array to scan the finger and send the scan to the Secure Enclave.</p>
</li>
<li>
<p>The resulting map of nodes is stored without any identity information in an encrypted format that can only be read by the Secure Enclave, and is never sent to Apple or backed up to iCloud or iTunes</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="file_data_protection">2.8.2. File Data Protection</h4>
<div class="sect4">
<h5 id="overview_5">Overview</h5>
<div class="ulist">
<ul>
<li>
<p>Every time a file on the data partition is created, Data Protection creates a new 256-bit key (the “per-file” key) and gives it to the hardware AES engine, which uses the key to encrypt the file as it is written to flash memory using AES CBC mode.</p>
</li>
<li>
<p>The content of a file is encrypted with a per-file key, which is wrapped with a class key and stored in a file’s metadata, which is in turn encrypted with the file system key.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="passcode">Passcode</h5>
<div class="ulist">
<ul>
<li>
<p>By setting up a device passcode, the user automatically enables Data Protection.</p>
</li>
<li>
<p>The passcode is entangled with the device’s UID, so brute-force attempts must be performed on the device under attack.</p>
</li>
<li>
<p>A large iteration count is used to make each attempt slower.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="data_protection_classes">Data Protection classes</h5>
<div class="ulist">
<ul>
<li>
<p>Complete Protection - NSFileProtectionComplete</p>
<div class="ulist">
<ul>
<li>
<p>Shortly after the user locks a device (10 seconds, if the Require Password setting is Immediately), the decrypted class key is discarded, rendering all data in this class inaccessible until the user enters the passcode again or unlocks the device using Touch ID</p>
</li>
</ul>
</div>
</li>
<li>
<p>Protected Unless Open - NSFileProtectionCompleteUnlessOpen</p>
<div class="ulist">
<ul>
<li>
<p>To protect files that need to be written while the device is locked</p>
</li>
</ul>
</div>
</li>
<li>
<p>Protected Until First User Authentication - NSFileProtectionCompleteUntilFirstUserAuthentication</p>
<div class="ulist">
<ul>
<li>
<p>This class behaves in the same way as Complete Protection, except that the decrypted class key isn’t removed from memory when the device is locked</p>
</li>
<li>
<p>This is the default class for all third-party app data not otherwise assigned to a Data Protection class</p>
</li>
</ul>
</div>
</li>
<li>
<p>No Protection - NSFileProtectionNone</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="keychain_data_protection">Keychain Data Protection</h5>
<div class="ulist">
<ul>
<li>
<p>The Keychain is implemented as a SQLite database stored on the file system.</p>
</li>
<li>
<p>Keychain items can only be shared between apps from the same developer.</p>
</li>
<li>
<p>Keychain data is protected using a class structure similar to the one used in file Data Protection.</p>
<div class="ulist">
<ul>
<li>
<p>When unlocked - kSecAttrAccessibleWhenUnlocked</p>
</li>
<li>
<p>While locked - N/A</p>
</li>
<li>
<p>After first unlock - kSecAttrAccessibleAfterFirstUnlock</p>
</li>
<li>
<p>Always - kSecAttrAccessibleAlways</p>
</li>
<li>
<p>Passcode Enabled - kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly</p>
</li>
</ul>
</div>
</li>
<li>
<p>Keychain classes have a “This device only” counterpart, which is always protected with the UID when being copied from the device during a backup, rendering it useless if restored to a different device</p>
</li>
<li>
<p>Keychains can use access control lists (ACLs) to set policies for accessibility and authentication requirements</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="access_to_safari_saved_passwords">Access to Safari saved passwords</h5>
<div class="ulist">
<ul>
<li>
<p>iOS apps can interact with Keychain items saved by Safari for password autofill using the following two APIs:</p>
<div class="ulist">
<ul>
<li>
<p>SecRequestSharedWebCredential</p>
</li>
<li>
<p>SecAddSharedWebCredential</p>
</li>
</ul>
</div>
</li>
<li>
<p>Access will be granted only if both the app developer and website administrator have given their approval, and the user has given consent.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="keybags">Keybags</h5>
<div class="ulist">
<ul>
<li>
<p>The keys for both file and Keychain Data Protection classes are collected and managed in keybags.</p>
</li>
<li>
<p>iOS uses the following keybags:</p>
<div class="ulist">
<ul>
<li>
<p>user</p>
<div class="ulist">
<ul>
<li>
<p>Is where the wrapped class keys used in normal operation of the device are stored.</p>
</li>
</ul>
</div>
</li>
<li>
<p>device</p>
<div class="ulist">
<ul>
<li>
<p>Is used to store the wrapped class keys used for operations involving device-specific data</p>
</li>
<li>
<p>On iOS devices configured for use by a single user (the default configuration), the device keybag and the user keybag are one and the same, and are protected by the user’s passcode</p>
</li>
</ul>
</div>
</li>
<li>
<p>backup</p>
<div class="ulist">
<ul>
<li>
<p>Is created when an encrypted backup is made by iTunes and stored on the computer to which the device is backed up</p>
</li>
<li>
<p>If a user chooses not to encrypt an iTunes backup, the backup files aren’t encrypted regardless of their Data Protection class, but the Keychain remains protected with a UID-derived key.</p>
</li>
</ul>
</div>
</li>
<li>
<p>escrow</p>
<div class="ulist">
<ul>
<li>
<p>Is used for iTunes syncing and MDM, allows iTunes to back up and sync without requiring the user to enter a passcode, and it allows an MDM server to remotely clear a user’s passcode.</p>
</li>
</ul>
</div>
</li>
<li>
<p>iCloud Backup</p>
<div class="ulist">
<ul>
<li>
<p>Is similar to the backup keybag</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="app_security">2.8.3. App Security</h4>
<div class="sect4">
<h5 id="app_code_signing">App code signing</h5>
<div class="ulist">
<ul>
<li>
<p>To ensure that all apps come from a known and approved source and haven’t been tampered with, iOS requires that all executable code be signed using an Apple-issued certificate</p>
</li>
<li>
<p>To protect the system and other apps from loading third-party code inside of their address space, the system will perform a code signature validation of all the dynamic libraries that a process links against at launch time.</p>
</li>
<li>
<p>At runtime, code signature checks of all executable memory pages are made as they are loaded to ensure that an app has not been modified since it was installed or last updated</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="runtime_process_security">Runtime process security</h5>
<div class="ulist">
<ul>
<li>
<p>All third-party apps are “sandboxed,” so they are restricted from accessing files stored by other apps or from making changes to the device.</p>
</li>
<li>
<p>System files and resources are also shielded from the user’s apps. The majority of iOS runs as the non-privileged user “mobile,” as do all third-party apps.</p>
</li>
<li>
<p>Access by third-party apps to user information and features such as iCloud and extensibility is controlled using declared entitlements.</p>
</li>
<li>
<p>Address space layout randomization (ASLR) protects against the exploitation of memory corruption bugs.</p>
</li>
<li>
<p>Further protection is provided by iOS using ARM’s Execute Never (XN) feature, which marks memory pages as non-executable.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="extensions">Extensions</h5>
<div class="ulist">
<ul>
<li>
<p>Extensions are special-purpose signed executable binaries, packaged within an app.</p>
</li>
<li>
<p>The system automatically launches extension processes as needed and manages their lifetime.</p>
</li>
<li>
<p>Extensions run in their own address space. Communication between the extension and the app from which it was activated uses interprocess communications mediated by the system framework. They don’t have access to each other’s files or memory spaces.</p>
</li>
<li>
<p>Extensions are designed to be isolated from each other, from their containing apps, and from the apps that use them.</p>
</li>
<li>
<p>Custom keyboards are a special type of extension</p>
<div class="ulist">
<ul>
<li>
<p>A keyboard extension will be used for any text field except the passcode input and any secure text view</p>
</li>
<li>
<p>To restrict the transfer of user data, custom keyboards run by default in a very restrictive sandbox that blocks access to the network, to services that perform network operations on behalf of a process, and to APIs that would allow the extension to exfiltrate typing data.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="app_groups">App Groups</h5>
<div class="ulist">
<ul>
<li>
<p>Apps and extensions owned by a given developer account can share content when configured to be part of an App Group.</p>
</li>
<li>
<p>Once configured to be part of an App Group, apps have access to the following:</p>
<div class="ulist">
<ul>
<li>
<p>A shared on-disk container for storage, which will stay on the device as long as at least one app from the group is installed</p>
</li>
<li>
<p>Shared preferences</p>
</li>
<li>
<p>Shared Keychain items</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="data_protection_in_apps">Data Protection in apps</h5>
<div class="ulist">
<ul>
<li>
<p>Data Protection is available for file and database APIs, including NSFileManager, CoreData, NSData, and SQLite</p>
</li>
<li>
<p>User-installed apps that don’t opt-in to a specific Data Protection class receive Protected Until First User Authentication by default.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="accessories">Accessories</h5>
<div class="ulist">
<ul>
<li>
<p>When an MFi accessory communicates with an iOS device using a Lightning connector or via Bluetooth, the device asks the accessory to prove it has been authorized by Apple by responding with an Apple-provided certificate, which is verified by the device.</p>
</li>
<li>
<p>The device then sends a challenge, which the accessory must answer with a signed response.</p>
</li>
<li>
<p>This process is entirely handled by a custom integrated circuit that Apple provides to approved accessory manufacturers and is transparent to the accessory itself</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="homekit">Homekit</h5>
<div class="ulist">
<ul>
<li>
<p>This stored data is encrypted using keys derived from the user’s HomeKit identity keys, plus a random nonce.</p>
</li>
<li>
<p>Additionally, HomeKit data is stored using Data Protection class Protected Until First User Authentication.</p>
</li>
<li>
<p>Is only backed up in encrypted backups, so, for example, unencrypted iTunes backups don’t contain HomeKit data</p>
</li>
<li>
<p>Data synchronization</p>
<div class="ulist">
<ul>
<li>
<p>The HomeKit data is encrypted during the synchronization using keys derived from the user’s HomeKit identity and random nonce.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="healthkit">HealthKit</h5>
<div class="ulist">
<ul>
<li>
<p>User’s health data is stored in Data Protection class Complete Protection, which means it is accessible only after a user enters their passcode or uses Touch ID to unlock the device</p>
</li>
<li>
<p>Management data is stored in Data Protection class Protected Until First User Authentication</p>
</li>
<li>
<p>Temporary journal files store health records are stored in Data Protection class Protected Unless Open.</p>
</li>
<li>
<p>Isn’t synced between devices,  is included in device backups to iCloud and encrypted iTunes backups</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="network_security_2">2.8.4. Network Security</h4>
<div class="sect4">
<h5 id="tls">TLS</h5>
<div class="ulist">
<ul>
<li>
<p>iOS supports Transport Layer Security (TLS v1.0, TLS v1.1, and TLS v1.2, which supports both AES 128 and SHA-2) and DTLS</p>
</li>
<li>
<p>CFNetwork disallows SSLv3, and apps that use WebKit (such as Safari) are prohibited from making an SSLv3 connection</p>
</li>
<li>
<p>The RC4 symmetric cipher suite is deprecated in iOS 10 and macOS Sierra</p>
</li>
<li>
<p>App Transport Security</p>
<div class="ulist">
<ul>
<li>
<p>provides default connection requirements so that apps adhere to best practices for secure connections when using NSURLConnection, CFURL, or NSURLSession APIs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="vpn">VPN</h5>
<div class="ulist">
<ul>
<li>
<p>iOS supports VPN On Demand for networks that use certificate-based authentication.</p>
</li>
<li>
<p>iOS also supports Per App VPN support, facilitating VPN connections on a much more granular basis.</p>
</li>
<li>
<p>iOS supports Always-on VPN, which can be configured for devices managed via MDM and supervised using Apple Configurator or the Device Enrollment Program.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="single_sign_on">Single Sign-on</h5>
<div class="ulist">
<ul>
<li>
<p>iOS supports authentication to enterprise networks through Single Sign-on (SSO).</p>
</li>
<li>
<p>SSO works with Kerberos-based networks to authenticate users to services they are authorized to access.</p>
</li>
<li>
<p>To configure SSO, iOS supports a configuration profile payload that allows MDM servers to push down the necessary settings.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="android_security_guide">2.9. Android Security Guide</h3>
<div class="paragraph">
<p>This is a summary of the <a href="https://source.android.com/security/">Android Security Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="kernel_security">2.9.1. Kernel Security</h4>
<div class="sect4">
<h5 id="application_sandbox">Application Sandbox</h5>
<div class="paragraph">
<p>Android uses the UNIX user-based protection to identify and isolate running applications.
The Android system assigns a unique UID (User ID) to each Android application and runs the application as a certain user in a separate process.
By default, applications cannot interact with each other. This is due to the user privileges being different for each application.
Memory corruption errors in one application will not lead to corruption in other applications, due to this isolation.</p>
</div>
<div class="paragraph">
<p>However, if the <code>android:sharedUserId</code> attribute is set (in the App Manifest) to the same value for two or more applications, they will all share the same User ID — provided that their certificate sets are identical.
Applications with the same user ID can access each other&#8217;s data and also run in the same process.</p>
</div>
</div>
<div class="sect4">
<h5 id="filesystem_permissions">Filesystem Permissions</h5>
<div class="paragraph">
<p>The filesystem permissions ensure that one user cannot alter or read another user&#8217;s files. In the context of Android, this means that one application, cannot access or alter the data for another application, unless they explicitly allow it.</p>
</div>
</div>
<div class="sect4">
<h5 id="device_rooting">Device Rooting</h5>
<div class="paragraph">
<p>By default, only the kernel and small number of core applications run using root permissions. Root permissions will allow you full access to all applications on the device, as well as their applications data.</p>
</div>
<div class="paragraph">
<p>Encrypting data with a key stored on the device will not protect the application from a root user.
Applications could use a key stored off-device, but this approach will only provide temporary protection while the key is not present on the device.
At some point the key must be provided to the application and it then becomes accessible to root users.</p>
</div>
</div>
<div class="sect4">
<h5 id="filesystem_encryption">Filesystem Encryption</h5>
<div class="paragraph">
<p>A number of different filesytem encryption approaches have been used by different versions of Android.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Android 3.0</em></p>
<div class="ulist">
<ul>
<li>
<p>Full filesystem encryption in the kernel.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Android 5.0</em></p>
<div class="ulist">
<ul>
<li>
<p>Full-disk encryption which uses a single key—protected with the user’s device password—to protect the whole of a device’s userdata partition.</p>
</li>
<li>
<p>Upon boot, users must provide their credentials before any part of the disk is accessible.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Android 7.0</em></p>
<div class="ulist">
<ul>
<li>
<p>File-based encryption allows different files to be encrypted with different keys that can be unlocked independently.</p>
</li>
<li>
<p>The Direct Boot feature allows encrypted devices to boot straight to the lock screen.</p>
</li>
<li>
<p>This makes profiles more secure because it allows more than one user to be protected at a time as the encryption is no longer based solely on a boot time password.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="application_security">2.9.2. Application Security</h4>
<div class="sect4">
<h5 id="certificate_authorities">Certificate Authorities</h5>
<div class="paragraph">
<p>Android includes a set of installed system Certificate Authorities, which are trusted system-wide.
Devices running Android 7.0 and above will have an Android stock set of system CAs as device manufacturers supplied CA&#8217;s are no longer permitted.</p>
</div>
</div>
<div class="sect4">
<h5 id="application_signing">Application Signing</h5>
<div class="paragraph">
<p>APK Signing will allow a developer to identify the author of the application.
The signed application certificate defines which user id is associated with which application.
The application signing ensures that applications cannot access each other except through a well-defined IPC (Inter-process communication).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="authentication">2.9.3. Authentication</h4>
<div class="paragraph">
<p>Two key pieces make up Authentication &amp; Key Storage from Android 6.0.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Android Keystore</em> - Cryptographic key storage which also provides standard crypto actions.</p>
</li>
<li>
<p><em>Authentication Components</em> - Assert the user&#8217;s presence and/or provide user authentication.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two authentication components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Gatekeeper</em> - Pin, Pattern &amp; Password Authentication</p>
</li>
<li>
<p><em>Fingerprint</em>  - Fingerprint Authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The two authentication components work with the Keystore and (other components) to support the use of hardware-backed authentication tokens or AuthTokens.</p>
</div>
<div class="sect4">
<h5 id="enrollment">Enrollment</h5>
<div class="paragraph">
<p>On first boot of the device, the user must initially enroll a PIN/pattern/password with Gatekeeper.
This is known as enrollment.
This is necessary to to create the User&#8217;s SID (User Secure Identifier) which is a 64-bit randomly generated ID.</p>
</div>
<div class="paragraph">
<p>This SID is cryptographically bound to the user&#8217;s password, so when a successful authentication takes place, the AuthTokens will contain the User SID for that password.</p>
</div>
</div>
<div class="sect4">
<h5 id="authentication_process">Authentication Process</h5>
<div class="paragraph">
<p>Once a user has set up a credential (eg. a Pattern lock) and they have received their User SID (Secure User Id), they are now ready to authenticate.</p>
</div>
<div class="paragraph">
<p>As part of Android authentication, an operating system (known as Trusty OS) runs on a processor intended to provide a TEE (Trusted Execution Environment).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/android-authentication-flow.png" alt="600" width="600">
</div>
<div class="title">Figure 1: Android Authentication Process</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Authentication begins when a user enters a Gatekeeper credential (eg. a Pin, Pattern, Password) or a Fingerprint.</p>
</li>
<li>
<p>The next step involves either the Gatekeeper daemon (gatekeeperd) or the Fingerprint daemon (fingerprintd) depending on what authentication credential is used.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The <code>gatekeeperd</code> daemon will send a hash of the password/pin/pattern it received in step 1, to its counterpart <code>gatekeeper</code> in the TEE (TEE OS).</p>
</li>
<li>
<p>Alternatively, the <code>fingerprintd</code> daemon sends the data to its <code>fingerprint</code> counterpart in the TEE.</p>
</li>
<li>
<p>If authentication in the TEE (TEE OS) is successful, <code>gatekeeper</code> or <code>fingerprint</code> in the TEE sends an AuthToken containing the corresponding User SID, signed with the AuthToken HMAC key, to its counterpart in the Android OS.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Remember that the SID is cryptographically bound to the user&#8217;s password.</p>
</li>
<li>
<p>The HMAC is used for message integrity.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The <code>gatekeeperd</code> or <code>fingerprintd</code> daemon receives a signed AuthToken from the TEE and passes the AuthToken to the <code>keystore service</code>.</p>
</li>
<li>
<p>Lastly, the <code>keystore service</code> passes the AuthTokens received from <code>gatekeeperd</code> and <code>fingerprintd</code> to the <code>keymaster</code>.
The AuthToken is verified with the <code>AuthToken HMAC key</code> which was previously shared with the <code>gatekeeper</code> and <code>fingerprint</code> "trustlets" in step 2.
The <code>keymaster</code> trusts the timestamp in the token as the last authentication time and bases a key release decision (to allow an app to use the key) on the timestamp.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="keystore">2.9.4. Keystore</h4>
<div class="paragraph">
<p>The Android Keystore system allows storage of cryptographic keys inside a container to make it more difficult to extract them from a device.
Once keys are in the keystore, they can be used for cryptographic operations with the key material remaining non-exportable.</p>
</div>
</div>
<div class="sect3">
<h4 id="trusted_execution_environment">2.9.5. Trusted Execution Environment</h4>
<div class="paragraph">
<p>A TEE processor is generally a separate microprocessor or a virtualized instance of the main processor.
The TEE processor is isolated from the rest of the system using memory and I/O protection mechanisms supported by the hardware.</p>
</div>
<div class="paragraph">
<p>TEE is necessary as the main processor on mobile devices is considered "untrusted".
It is not allowed access to certain areas of RAM or where other device-specific cryptographic keys are stored.
Applications running on the main processor will therefore delegate any operations that require use of secret/sensitive data to the TEE processor.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="android_developer_security_guide">2.10. Android Developer Security Guide</h3>
<div class="paragraph">
<p>This is a summary of the <a href="https://developer.android.com/training/best-security.html">Android Developer Security Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="overview_6">2.10.1. Overview</h4>
<div class="paragraph">
<p>The following core security features help you build secure apps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Android Application Sandbox, which isolates your app data and code execution from other apps.</p>
</li>
<li>
<p>An application framework with robust implementations of common security functionality such as cryptography, permissions, and secure IPC.</p>
</li>
<li>
<p>Technologies like ASLR, NX, ProPolice, safe_iop, OpenBSD dlmalloc, OpenBSD calloc, and Linux mmap_min_addr to mitigate risks associated with common memory management errors.</p>
</li>
<li>
<p>An encrypted file system that can be enabled to protect data on lost or stolen devices.</p>
</li>
<li>
<p>User-granted permissions to restrict access to system features and user data.</p>
</li>
<li>
<p>Application-defined permissions to control application data on a per-app basis.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="data_storage">Data Storage</h5>
<div class="paragraph">
<p>The most common security concern for an application on Android is whether the data that you save on the device is accessible to other apps.</p>
</div>
<div class="paragraph">
<p>There are three fundamental ways to save data on the device:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Internal Storage</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>By default, files that you create on internal storage are accessible only to your app. Android implements this protection, and it&#8217;s sufficient for most applications.</p>
</li>
<li>
<p>Avoid the <code>MODE_WORLD_WRITEABLE</code> or <code>MODE_WORLD_READABLE</code> modes for IPC files because they do not provide the ability to limit data access to particular applications, nor do they provide any control of data format. If you want to share your data with other app processes, instead consider using a content provider, which offers read and write permissions to other apps and can make dynamic permission grants on a case-by-case basis.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>External Storage</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Files created on external storage, such as SD cards, are globally readable and writable. Because external storage can be removed by the user and also modified by any application, don&#8217;t store sensitive information using external storage.</p>
</li>
<li>
<p>You should Perform input validation when handling data from external storage as you would with data from any untrusted source. You should not store executables or class files on external storage prior to dynamic loading. If your app does retrieve executable files from external storage, the files should be signed and cryptographically verified prior to dynamic loading.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Content Providers</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Content providers offer a structured storage mechanism that can be limited to your own application or exported to allow access by other applications.
If you do not intend to provide other applications with access to your ContentProvider, mark them as <code>android:exported=false</code> in the application manifest.
Otherwise, set the <code>android:exported</code> attribute to true to allow other apps to access the stored data.</p>
</li>
<li>
<p>If you are using a content provider for sharing data between only your own apps, it is preferable to use the <code>android:protectionLevel</code> attribute set to signature protection.
Signature permissions do not require user confirmation, so they provide a better user experience and more controlled access to the content provider data when the apps accessing the data are signed with the same key.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="permissions">Permissions</h5>
<div class="paragraph">
<p>Android permissions are ranked in four different categories based on the protection level they offer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Normal: the lower level of protection. It gives the apps access to isolated application-level feature, with minimal risk to other apps, the user or the system. It is granted during the installation of the App. It is also the default value for the cases when no protection level is specified. Example: <code>android.permission.INTERNET</code></p>
</li>
<li>
<p>Dangerous: This permission usually gives the app control over the user data or over the device that impacts the user. This type of permission may not be granted at installation time, leaving it to the user to decide whether the app should have the permission or not. Example: <code>android.permission.RECORD_AUDIO</code></p>
</li>
<li>
<p>Signature: This permission is granted only if the requesting app was signed with the same certificate as the app that declared the permission. If the signature matches, the permission is automatically granted. Example: <code>android.permission.ACCESS_MOCK_LOCATION</code></p>
</li>
<li>
<p>SystemOrSignature: Permission only granted to the apps embedded in the system image or that were signed using the same certificated as the app that declared the permission. Example: <code>android.permission.ACCESS_DOWNLOAD_MANAGER</code></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="ip_networking">IP Networking</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should use HTTPS over HTTP anywhere that HTTPS is supported on the server, because mobile devices frequently connect on networks that are not secured, such as public Wi-Fi hotspots.
Authenticated, encrypted socket-level communication can be easily implemented using the <a href="https://developer.android.com/reference/javax/net/ssl/SSLSocket.html">SSLSocket class</a>.</p>
</li>
<li>
<p>Some applications use localhost network ports for handling sensitive IPC.
You should not use this approach because these interfaces are accessible by other applications on the device.
Instead, use an Android IPC mechanism where authentication is possible, such as with a Service.
Binding to <code>INADDR_ANY</code> is worse than using loopback because then your application may receive requests from anywhere.</p>
</li>
<li>
<p>Make sure that you don&#8217;t trust data downloaded from HTTP or other insecure protocols. This includes validation of input in WebView and any responses to intents issued against HTTP.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="telephony_networking">Telephony Networking</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Beware that SMS is neither encrypted nor strongly authenticated on either the network or the device. In particular, any SMS receiver should expect that a malicious user may have sent the SMS to your application.
Don&#8217;t rely on unauthenticated SMS data to perform sensitive commands.</p>
</li>
<li>
<p>Also, you should be aware that SMS may be subject to spoofing and/or interception on the network. On the Android-powered device itself, SMS messages are transmitted as broadcast intents, so they may be read or captured by other applications that have the <code>READ_SMS</code> permission.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="input_validation">Input Validation</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Insufficient input validation is one of the most common security problems affecting applications, regardless of what platform they run on.
Android has platform-level countermeasures that reduce the exposure of applications to input validation issues, and you should use those features where possible.</p>
</li>
<li>
<p>If you are using native code, any data read from files, received over the network, or received from an IPC has the potential to introduce a security issue. The most common problems are <a href="http://en.wikipedia.org/wiki/Buffer_overflow">buffer overflows</a>, <a href="http://en.wikipedia.org/wiki/Double_free#Use_after_free">use after free</a>, and <a href="http://en.wikipedia.org/wiki/Off-by-one_error">off-by-one errors</a>.
Android provides a number of technologies like ASLR and DEP that reduce the exploitability of these errors, but they don&#8217;t solve the underlying problem. You can prevent these vulnerabilities by carefully handling pointers and managing buffers.</p>
</li>
<li>
<p>If you are using data within queries that are submitted to an SQL database or a content provider, SQL injection may be an issue. The best defense is to use parameterized queries, as is discussed in the above section about content providers. Limiting permissions to read-only or write-only can also reduce the potential for harm related to SQL injection.</p>
</li>
<li>
<p>You should make sure to use well-structured data formats and verify that the data conforms to the expected format. While blacklisting of characters or character-replacement can be an effective strategy, these techniques are error prone in practice and should be avoided when possible.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="handling_user_data">Handling User Data</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In general, the best approach for user data security is to minimize the use of APIs that access sensitive or personal user data. If you have access to user data and can avoid storing or transmitting it, don&#8217;t store or transmit the data.</p>
</li>
<li>
<p>Consider if there is a way that your application logic can be implemented using a hash or non-reversible form of the data.</p>
</li>
<li>
<p>For example, your application might use the hash of an email address as a primary key to avoid transmitting or storing the email address. This reduces the chances of inadvertently exposing data, and it also reduces the chance of attackers attempting to exploit your application.</p>
</li>
<li>
<p>If your app requires access to sensitive data, evaluate whether you need to transmit it to a server or you can run the operation on the client. Consider running any code using sensitive data on the client to avoid transmitting user data.</p>
</li>
<li>
<p>Also, make sure that you do not inadvertently expose user data to other applications on the device through overly permissive IPC, world-writable files, or network sockets. Overly permissive IPC is a special case of leaking permission-protected data.</p>
</li>
<li>
<p>If a GUID is required, create a large, unique number and store it. Don&#8217;t use phone identifiers such as the phone number or IMEI, which may be associated with personal information.</p>
</li>
<li>
<p>Be careful when writing to on-device logs. In Android, logs are a shared resource and are available to an application with the <code>READ_LOGS</code> permission.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="using_webviews">Using Webviews</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Because WebView consumes web content that can include HTML and JavaScript, improper use can introduce common web security issues such as XSS.
Android includes a number of mechanisms to reduce the scope of these potential issues by limiting the capability of WebView to the minimum functionality required by your application</p>
</li>
<li>
<p>If your application doesn&#8217;t directly use JavaScript within a WebView, do not call <code>setJavaScriptEnabled()</code>. By default, WebView does not execute JavaScript, so XSS is not possible.</p>
</li>
<li>
<p>If your application accesses sensitive data with a WebView, you may want to use the <code>clearCache()</code> method to delete any files stored locally. You can also use server-side headers such as <code>no-cache</code> to indicate that an application should not cache particular content.</p>
</li>
<li>
<p>Use <code>addJavaScriptInterface()</code> with particular care because it allows JavaScript to invoke operations that are normally reserved for Android applications. If you use it, expose <code>addJavaScriptInterface()</code> only to web pages from which all input is trustworthy.
In general, the Android documentation recommends exposing <code>addJavaScriptInterface()</code> only to JavaScript that is contained within your application APK.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="handling_credentials">Handling Credentials</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To make phishing attacks more conspicuous and less likely to be successful, minimize the frequency of asking for user credentials. Instead use an authorization token and refresh it.</p>
</li>
<li>
<p>Where possible, don&#8217;t store user names and passwords on the device. Instead, perform initial authentication using the user name and password supplied by the user, and then use a short-lived, service-specific authorization token.</p>
</li>
<li>
<p>Services that are accessible to multiple applications should be accessed using AccountManager. If possible, use the AccountManager class to invoke a cloud-based service and don&#8217;t store passwords on the device.</p>
</li>
<li>
<p>After using AccountManager to retrieve an Account, use <a href="https://developer.android.com/reference/android/accounts/Account.html#CREATOR">CREATOR</a> before passing in any credentials so that you do not inadvertently pass credentials to the wrong application.</p>
</li>
<li>
<p>If credentials are used only by applications that you create, you can verify the application that accesses the AccountManager using <code>checkSignature()</code>. Alternatively, if only one application uses the credential, you might use a KeyStore for storage.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="cryptography_2">Cryptography</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a secure random number generator, SecureRandom, to initialize any cryptographic keys generated by KeyGenerator. Use of a key that is not generated with a secure random number generator significantly weakens the strength of the algorithm and may allow offline attacks.</p>
</li>
<li>
<p>If you need to store a key for repeated use, use a mechanism, such as KeyStore, that provides a mechanism for long term storage and retrieval of cryptographic keys.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="ipc">IPC</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Some apps attempt to implement IPC using traditional Linux techniques such as network sockets and shared files.
However, you should instead use Android system functionality for IPC such as <a href="https://developer.android.com/reference/android/content/Intent.html">Intent</a>, <a href="https://developer.android.com/reference/android/os/Binder.html">Binder</a> or <a href="https://developer.android.com/reference/android/os/Messenger.html">Messenger</a> with a <a href="https://developer.android.com/reference/android/app/Service.html">Service</a>, and <a href="https://developer.android.com/reference/android/content/BroadcastReceiver.html">BroadcastReceiver</a>.
The Android IPC mechanisms allow you to verify the identity of the application connecting to your IPC and set a security policy for each IPC mechanism.</p>
</li>
<li>
<p>Many of the security elements are shared across IPC mechanisms. If your IPC mechanism is not intended for use by other applications, set the <code>android:exported</code> attribute to <code>false</code> in the component&#8217;s manifest element.</p>
</li>
<li>
<p>If your IPC is accessible to other applications, you can apply a security policy by using the <code>&lt;permission&gt;</code> element.
If IPC is between your own separate apps that are signed with the same key, it is preferable to use signature level permission in the <code>android:protectionLevel</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="intents">Intents</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For activities and broadcast receivers, intents are the preferred mechanism for asynchronous IPC in Android. Depending on your application requirements, you might use <a href="https://developer.android.com/reference/android/content/Context.html#sendBroadcast(android.content.Intent)">sendBroadcast()</a>, <a href="https://developer.android.com/reference/android/content/Context.html#sendOrderedBroadcast">sendOrderedBroadcast()</a>, or an explicit intent to a specific application component. For security purposes, explicit intents are preferred.</p>
</li>
<li>
<p>If you use an intent to bind to a Service, ensure that your app is secure by using an explicit intent. Using an implicit intent to start a service is a security hazard because you can&#8217;t be certain what service will respond to the intent, and the user can&#8217;t see which service starts.</p>
</li>
<li>
<p>Senders of an intent can verify that the recipient has permission by specifying a non-null permission with the method call. Only applications with that permission receive the intent. If data within a broadcast intent may be sensitive, you should consider applying a permission to make sure that malicious applications can&#8217;t register to receive those messages without appropriate permissions. In those circumstances, you may also consider invoking the receiver directly, rather than raising a broadcast.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="services">Services</h5>
<div class="paragraph">
<p>A Service is often used to supply functionality for other applications to use. Each service class must have a corresponding <code>&lt;service&gt;</code> declaration in its manifest file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By default, services are not exported and cannot be invoked by any other application. However, if you add any intent filters to the service declaration, it is exported by default.
It&#8217;s best if you explicitly declare the <code>android:exported</code> attribute to be sure it behaves as you&#8217;d like. Services can also be protected using the <code>android:permission attribute</code>.
By doing so, other applications need to declare a corresponding <code>&lt;uses-permission&gt;</code> element in their own manifest to be able to start, stop, or bind to the service.</p>
</li>
<li>
<p>If your app targets Android 5.0 (API level 21) or later, you should use the <a href="https://developer.android.com/reference/android/app/job/JobScheduler.html">JobScheduler</a> to execute background services.</p>
</li>
<li>
<p>A service can protect individual IPC calls into it with permissions, by calling <code>checkCallingPermission()</code> before executing the implementation of that call.
You should use the declarative permissions in the manifest, since those are less prone to oversight.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="binder_and_messenger_interfaces">Binder and Messenger Interfaces</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <a href="https://developer.android.com/reference/android/os/Binder.html">Binder</a> or <a href="https://developer.android.com/reference/android/os/Messenger.html">Messenger</a> is the preferred mechanism for RPC-style IPC in Android.
They provide a well-defined interface that enables mutual authentication of the endpoints, if required.</p>
</li>
<li>
<p>If you are providing an interface that does require access controls, use <a href="https://developer.android.com/reference/android/content/Context.html#checkCallingPermission(java.lang.String)">checkCallingPermission()</a> to verify whether the caller has a required permission.
This is especially important before accessing a service on behalf of the caller, as the identify of your application is passed to other interfaces.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="broadcast_receivers">Broadcast Receivers</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A BroadcastReceiver handles asynchronous requests initiated by an Intent.</p>
</li>
<li>
<p>By default, receivers are exported and can be invoked by any other application. If your BroadcastReceiver is intended for use by other applications, you may want to apply security permissions to receivers using the <code>&lt;receiver&gt;</code> element within the application manifest.
This prevents applications without appropriate permissions from sending an intent to the BroadcastReceiver.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="dynamically_loading_code">Dynamically Loading Code</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Loading code from outside of your application APK significantly increases the likelihood of application compromise due to code injection or code tampering.</p>
</li>
<li>
<p>If your application does dynamically load code, the most important thing to keep in mind about dynamically-loaded code is that it runs with the same security permissions as the application APK.</p>
</li>
<li>
<p>The major security risk associated with dynamically loading code is that the code needs to come from a verifiable source.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="virtual_machine_security">Virtual Machine Security</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dalvik is Android&#8217;s runtime virtual machine (VM). Your application runs in a secure sandbox environment, so other processes on the system can&#8217;t access your code or private data.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="security_with_https_and_ssl">2.10.2. Security with HTTPS and SSL</h4>
<div class="paragraph">
<p>This is a summary of the <a href="https://developer.android.com/training/articles/security-ssl.html">Android Developer Security with HTTPS and SSL Guide</a>.</p>
</div>
<div class="paragraph">
<p>The Secure Sockets Layer (SSL)—now technically known as Transport Layer Security (TLS)—is a common building block for encrypted communications between clients and servers.
It&#8217;s possible that an application might use SSL incorrectly such that malicious entities may be able to intercept an app&#8217;s data over the network.</p>
</div>
<div class="paragraph">
<p>As of Android 4.2 (Jelly Bean), Android currently contains over 100 CAs that are updated in each release. Similar to a server, a CA has a certificate and a private key. When issuing a certificate for a server, the CA signs the server certificate using its private key. The client can then verify that the server has a certificate issued by a CA known to the platform.</p>
</div>
<div class="sect4">
<h5 id="https_example">HTTPS Example</h5>
<div class="paragraph">
<p>Assuming you have a web server with a certificate issued by a well known CA, you can make a secure request with code as simple this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>URL url = new URL("https://wikipedia.org");
URLConnection urlConnection = url.openConnection();
InputStream in = urlConnection.getInputStream();
copyInputStreamToOutputStream(in, System.out);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose instead of receiving the content from <code>getInputStream()</code>, it throws an exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>javax.net.ssl.SSLHandshakeException: java.security.cert.CertPathValidatorException: Trust anchor for certification path not found.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can happen for several reasons, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unknown CA</strong> - The CA that issued the server certificate was unknown.</p>
<div class="ulist">
<ul>
<li>
<p>In this case, the <code>SSLHandshakeException</code> occurs because you have a CA that isn&#8217;t trusted by the system. It could be because you have a certificate from a new CA that isn&#8217;t yet trusted by Android or your app is running on an older version without the CA. More often a CA is unknown because it isn&#8217;t a public CA, but a private one issued by an organization such as a government, corporation, or education institution for their own use. With a custom TrustManager that knows about your CAs, the system is able to validate that your server certificate come from a trusted issuer.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Self-Signed Server Certificate</strong> - The server certificate wasn&#8217;t signed by a CA, but was self signed.</p>
<div class="ulist">
<ul>
<li>
<p>The second case of <code>SSLHandshakeException</code> is due to a self-signed certificate, which means the server is behaving as its own CA. As before, you can create your own TrustManager, this time trusting the server certificate directly.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Missing Intermediate CA</strong> - The server configuration is missing an intermediate CA.</p>
<div class="ulist">
<ul>
<li>
<p>The third case of <code>SSLHandshakeException</code> occurs due to a missing intermediate CA. Most public CAs don&#8217;t sign server certificates directly. Instead, they use their main CA certificate, referred to as the root CA, to sign intermediate CAs. They do this so the root CA can be stored offline to reduce risk of compromise.</p>
</li>
<li>
<p>However, operating systems like Android typically trust only root CAs directly, which leaves a short gap of trust between the server certificate—signed by the intermediate CA—and the certificate verifier, which knows the root CA.</p>
</li>
<li>
<p>To solve this, the server doesn&#8217;t send the client only it&#8217;s certificate during the SSL handshake, but a chain of certificates from the server CA through any intermediates necessary to reach a trusted root CA.</p>
</li>
<li>
<p>There are two approaches to solve this issue:</p>
<div class="ulist">
<ul>
<li>
<p>Configure the server to include the intermediate CA in the server chain. Most CAs provide documentation on how to do this for all common web servers. This is the only approach if you need the site to work with default Android browsers at least through Android 4.2.</p>
</li>
<li>
<p>Or, treat the intermediate CA like any other unknown CA, and create a TrustManager to trust it directly, as done in the previous two sections.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hostname_verification">Hostname verification</h5>
<div class="paragraph">
<p>There are two key parts to verifying an SSL connection:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first is to verify the certificate is from a trusted source, which was the focus of the previous section.</p>
</li>
<li>
<p>The second part is making sure the server you are talking to presents the right certificate. When it doesn&#8217;t, you&#8217;ll typically see an error like this:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>java.io.IOException: Hostname 'example.com' was not verified
at libcore.net.http.HttpConnection.verifySecureSocketHostname(HttpConnection.java:223)
at libcore.net.http.HttpsURLConnectionImpl$HttpsEngine.connect(HttpsURLConnectionImpl.java:446)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>One reason this can happen is due to a server configuration error.
The server is configured with a certificate that does not have a subject or subject alternative name fields that match the server you are trying to reach. It is possible to have one certificate be used with many different servers.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="warnings_about_using_sslsocket_directly">Warnings About Using SSLSocket Directly</h5>
<div class="paragraph">
<p><a href="https://developer.android.com/reference/javax/net/ssl/SSLSocket.html">SSLSocket</a> does not perform hostname verification. It is up the your app to do its own hostname verification, preferably by calling <code>getDefaultHostnameVerifier()</code> with the expected hostname. Further beware that <code>HostnameVerifier.verify()</code> doesn&#8217;t throw an exception on error but instead returns a boolean result that you must explicitly check.</p>
</div>
</div>
<div class="sect4">
<h5 id="blacklisting">Blacklisting</h5>
<div class="paragraph">
<p>SSL relies heavily on CAs to issue certificates to only the properly verified owners of servers and domains. In rare cases, CAs are either tricked or breached, resulting in the certificates for a hostname to be issued to someone other than the owner of the server or domain.</p>
</div>
<div class="paragraph">
<p>In order to mitigate this risk, Android has the ability to blacklist certain certificates or even whole CAs. While this list was historically built into the operating system, starting in Android 4.2 this list can be remotely updated to deal with future compromises.</p>
</div>
</div>
<div class="sect4">
<h5 id="pinning">Pinning</h5>
<div class="paragraph">
<p>An app can further protect itself from fraudulently issued certificates by a technique known as pinning. This prevents the compromise of one of the other 100+ CAs in the system from resulting in a breach of the apps secure channel.</p>
</div>
</div>
<div class="sect4">
<h5 id="client_certificates">Client Certificates</h5>
<div class="paragraph">
<p>SSL also supports the notion of client certificates that allow the server to validate the identity of a client.</p>
</div>
</div>
<div class="sect4">
<h5 id="nogotofail_a_network_traffic_security_testing_tool">Nogotofail: A Network Traffic Security Testing Tool</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://github.com/google/nogotofail">Nogotofail</a> is a tool gives you an easy way to confirm that your apps are safe against known TLS/SSL vulnerabilities and misconfigurations.
It&#8217;s an automated, powerful, and scalable tool for testing network security issues on any device whose network traffic could be made to go through it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nogotofail is useful for three main use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Finding bugs and vulnerabilities.</p>
</li>
<li>
<p>Verifying fixes and watching for regressions.</p>
</li>
<li>
<p>Understanding what applications and devices are generating what traffic.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="network_security_configuration">2.10.3. Network Security Configuration</h4>
<div class="paragraph">
<p>This is a summary of the <a href="https://developer.android.com/training/articles/security-ssl.html">Android Developer Network Security Configuration Guide</a>.</p>
</div>
<div class="sect4">
<h5 id="configuration">Configuration</h5>
<div class="paragraph">
<p>The Network Security Configuration feature lets apps customize their network security settings in a safe, declarative configuration file without modifying app code. These settings can be configured for specific domains and for a specific app. The key capabilities of this feature are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Custom trust anchors</strong>: Customize which Certificate Authorities (CA) are trusted for an app&#8217;s secure connections. For example, trusting particular self-signed certificates or restricting the set of public CAs that the app trusts.</p>
</li>
<li>
<p><strong>Debug-only overrides</strong>: Safely debug secure connections in an app without added risk to the installed base.</p>
</li>
<li>
<p><strong>Cleartext traffic opt-out</strong>: Protect apps from accidental usage of cleartext traffic.</p>
</li>
<li>
<p><strong>Certificate pinning</strong>: Restrict an app&#8217;s secure connection to particular certificates.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Network Security Configuration feature uses an XML file where you specify the settings for your app. You must include an entry in the manifest of your app to point to this file.</p>
</div>
<div class="paragraph">
<p>Example reference of the network security settings from the applications manifest xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest ... &gt;
    &lt;application android:networkSecurityConfig="@xml/network_security_config"
                    ... &gt;
        ...
    &lt;/application&gt;
&lt;/manifest&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="customizing_trusted_cas">Customizing Trusted CAs</h5>
<div class="paragraph">
<p>An app may want to trust a custom set of CAs instead of the platform default. The most common reasons of this are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connecting to a host with a custom certificate authority, such as a CA that is self-signed or is issued internally within a company.</p>
</li>
<li>
<p>Limiting the set of CAs to only the CAs you trust instead of every pre-installed CA.</p>
</li>
<li>
<p>Trusting additional CAs not included in the system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An app can customize its own connections using <code>base-config</code> (for app-wide customization) or <code>domain-config</code> (for per-domain customization).</p>
</div>
<div class="paragraph">
<p>For Configuring CA&#8217;s, configuration examples are available in the Andoird Documentation.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://developer.android.com/training/articles/security-config.html#ConfigCustom">Configuring a Custom CA</a></p>
</li>
<li>
<p><a href="https://developer.android.com/training/articles/security-config.html#LimitingCas">Limiting the Set of Trusted CAs</a></p>
</li>
<li>
<p><a href="https://developer.android.com/training/articles/security-config.html#TrustingAdditionalCas">Trusting Additional CAs</a></p>
</li>
<li>
<p><a href="http://developer.android.com/training/articles/security-config.html#TrustingDebugCa">Configuring CAs for Debugging</a></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="opting_out_of_cleartext_traffic">Opting Out of Cleartext Traffic</h5>
<div class="paragraph">
<p>Applications intending to connect to destinations using only secure connections can opt-out of supporting cleartext (using the unencrypted HTTP protocol instead of HTTPS) to those destinations. This option helps prevent accidental regressions in apps due to changes in URLs provided by external sources such as backend servers.</p>
</div>
<div class="paragraph">
<p>For example, an app may want to ensure that all connections to secure.example.com are always done over HTTPS to protect sensitive traffic from hostile networks.</p>
</div>
<div class="paragraph">
<p><strong>res/xml/network_security_config.xml</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;network-security-config&gt;
    &lt;domain-config cleartextTrafficPermitted="false"&gt;
        &lt;domain includeSubdomains="true"&gt;secure.example.com&lt;/domain&gt;
    &lt;/domain-config&gt;
&lt;/network-security-config&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pinning_certificates">Pinning Certificates</h5>
<div class="paragraph">
<p>Normally, an app trusts all pre-installed CAs. If any of these CAs were to issue a fradulent certificate, the app would be at risk from a man-in-the-middle attack. Some apps choose to limit the set of certificates they accept by either limiting the set of CAs they trust or by certificate pinning.</p>
</div>
<div class="paragraph">
<p>Certificate pinning is done by providing a set of certificates by hash of the public key (SubjectPublicKeyInfo of the X.509 certificate). A certificate chain is then valid only if the certificate chain contains at least one of the pinned public keys.</p>
</div>
<div class="paragraph">
<p>Note that, when using certificate pinning, you should always include a backup key so that if you are forced to switch to new keys or change CAs (when pinning to a CA certificate or an intermediate of that CA), your app&#8217;s connectivity is unaffected. Otherwise, you must push out an update to the app to restore connectivity.</p>
</div>
<div class="paragraph">
<p><strong>res/xml/network_security_config.xml:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;network-security-config&gt;
    &lt;domain-config&gt;
        &lt;domain includeSubdomains="true"&gt;example.com&lt;/domain&gt;
        &lt;pin-set expiration="2018-01-01"&gt;
            &lt;pin digest="SHA-256"&gt;7HIpactkIAq2Y49orFOOQKurWxmmSFZhBCoQYcRhJ3Y=&lt;/pin&gt;
            &lt;!-- backup pin --&gt;
            &lt;pin digest="SHA-256"&gt;fwza0LRMXouZHRC8Ei+4PyuldPDcf3UKgO/04cDM1oE=&lt;/pin&gt;
        &lt;/pin-set&gt;
    &lt;/domain-config&gt;
&lt;/network-security-config&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuration_inheritance_behavior">Configuration Inheritance Behavior</h5>
<div class="paragraph">
<p>Values not set in a specific configuration are inherited. This behavior allows more complex configurations while keeping the configuration file readable.</p>
</div>
<div class="paragraph">
<p>If a value is not set in a specific entry, then the value from the more general entry is used. For example, values not set in a domain-config are taken from the parent domain-config, if nested, or from the base-config if not. Values not set in the base-config use the platform default values.</p>
</div>
<div class="paragraph">
<p>For example, consider where all connections to subdomains of example.com must use a custom set of CAs. Additonally, cleartext traffic to these domains is permitted except when connecting to secure.example.com. By nesting the configuration for secure.example.com inside the configuration for example.com, the trust-anchors does not need to be duplicated.</p>
</div>
<div class="sect5">
<h6 id="configuration_file_format">Configuration File Format</h6>
<div class="paragraph">
<p>The Network Security Configuration feature uses an XML file format. The overall structure of the file is shown in the following code sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;network-security-config&gt;
    &lt;base-config&gt;
        &lt;trust-anchors&gt;
            &lt;certificates src="..."/&gt;
            ...
        &lt;/trust-anchors&gt;
    &lt;/base-config&gt;

    &lt;domain-config&gt;
        &lt;domain&gt;android.com&lt;/domain&gt;
        ...
        &lt;trust-anchors&gt;
            &lt;certificates src="..."/&gt;
            ...
        &lt;/trust-anchors&gt;
        &lt;pin-set&gt;
            &lt;pin digest="..."&gt;...&lt;/pin&gt;
            ...
        &lt;/pin-set&gt;
    &lt;/domain-config&gt;
    ...
    &lt;debug-overrides&gt;
        &lt;trust-anchors&gt;
            &lt;certificates src="..."/&gt;
            ...
        &lt;/trust-anchors&gt;
    &lt;/debug-overrides&gt;
&lt;/network-security-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full network security configuration options can be seen <a href="https://developer.android.com/training/articles/security-config.html#network-security-config">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="safetynet">2.10.4. SafetyNet</h4>
<div class="paragraph">
<p>SafetyNet provides a set of services and APIs that help protect your app against security threats, including device tampering, bad URLs, potentially harmful apps, and fake users.</p>
</div>
<div class="sect4">
<h5 id="safetynet_attestation_api">SafetyNet Attestation API</h5>
<div class="paragraph">
<p>The <a href="https://developer.android.com/training/safetynet/attestation.html">SafetyNet Attestation API</a> provides services for determining whether a device running your app satisfies Android compatibility tests.</p>
</div>
<div class="paragraph">
<p>SafetyNet examines software and hardware information on the device where your app is installed to create a profile of that device. The service then attempts to find this same profile within a list of device models that have passed Android compatibility testing. The API also uses this software and hardware information to help you assess the basic integrity of the device, as well as the APK information of the calling app. This attestation helps you to determine whether or not the particular device has been tampered with or otherwise modified.</p>
</div>
</div>
<div class="sect4">
<h5 id="safetynet_safe_browsing_api">SafetyNet Safe Browsing API</h5>
<div class="paragraph">
<p>The <a href="https://developer.android.com/training/safetynet/safebrowsing.html">SafetyNet Safe Browsing API</a> provides services for determining whether a URL has been marked as a known threat by Google. Your app can use a URL check to determine whether a URL poses a known threat.</p>
</div>
</div>
<div class="sect4">
<h5 id="safetynet_recaptcha_api">SafetyNet reCAPTCHA API</h5>
<div class="paragraph">
<p>The <a href="https://developer.android.com/training/safetynet/recaptcha.html">SafetyNet reCAPTCHA API</a> service includes a reCAPTCHA API that you can use to protect your app from malicious traffic. reCAPTCHA is a free service that uses an advanced risk analysis engine to protect your app from spam and other abusive actions. If the service suspects that the user interacting with your app might be a bot instead of a human, it serves a CAPTCHA that a human must solve before your app can continue executing.</p>
</div>
</div>
<div class="sect4">
<h5 id="safetynet_verify_apps_api">SafetyNet Verify Apps API</h5>
<div class="paragraph">
<p>The <a href="https://developer.android.com/training/safetynet/verify-apps.html">SafetyNet Verify Apps API</a> allows your app to interact programmatically with the Verify Apps feature on a device, protecting the device against potentially harmful apps. The SafetyNet Verify Apps API allows you to leverage this feature to protect your app&#8217;s data. By using this API, you can determine whether a user&#8217;s device is protected by the Verify Apps feature, encourage users not already using the feature to opt in to its protection, and identify any known potentially harmful apps that are installed on the device.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="key_attestation">2.10.5. Key Attestation</h4>
<div class="paragraph">
<p>This is a summary of the <a href="https://developer.android.com/training/articles/security-key-attestation.html">Android Developer Key Attestation Security Guide</a> and the <a href="https://www.androidcentral.com/how-android-n-addresses-security">Android 7.0: "Security Benefits that Truly Matter"</a> post.</p>
</div>
<div class="sect4">
<h5 id="verifying_hardware_backed_keypairs">Verifying Hardware Backed Keypairs</h5>
<div class="paragraph">
<p>Key Attestation will allow developers to make sure the keys they may be using in their apps are valid and stored in the phone&#8217;s hardware-backed keystore and not in software. When the attestation tool is given a generated alias for a key (the actual key should never be shared) it then generates a certificate chain that can be used to verify the key. Developers can verify both the key as well as the verified boot state to make sure everything is valid.</p>
</div>
<div class="paragraph">
<p>Phones that ship with Android N and use Google services will have a certificate that&#8217;s issued by Google as the root (or primary) authority while other phones that have been upgraded will need a certificate issued by the company who made them.</p>
</div>
<div class="paragraph">
<p>Not all phones that can run Android N have a trusted hardware environment to store encryption keys, and in those cases, software-level key attestation is used instead. The verified boot state can still be checked to make sure the system software hasn&#8217;t been tampered with.</p>
</div>
</div>
<div class="sect4">
<h5 id="retrieving_and_verifying_a_hardware_backed_key_pair">Retrieving and Verifying a Hardware-backed Key Pair</h5>
<div class="paragraph">
<p>During key attestation, you specify the alias of a key pair. The attestation tool, in return, provides a certificate chain, which you can use to verify the properties of that key pair.</p>
</div>
<div class="paragraph">
<p>If the device supports hardware-level key attestation, the root certificate within this chain is signed using an attestation root key, which the device manufacturer injects into the device&#8217;s hardware-backed keystore at the factory.</p>
</div>
<div class="paragraph">
<p>On devices that ship with hardware-level key attestation, Android 7.0 (API level 24), and Google Play services, the root certificate is signed with the Google attestation root key. You should verify that this root certificate appears within Google&#8217;s list of root certificates.</p>
</div>
</div>
<div class="sect4">
<h5 id="implementing_key_attestation">Implementing Key Attestation</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a KeyStore object&#8217;s <code>getCertificateChain()</code> method to get a reference to the chain of X.509 certificates associated with the hardware-backed keystore.</p>
</li>
<li>
<p>Check each certificate&#8217;s validity using a X509Certificate object&#8217;s <code>checkValidity()</code> method. <strong>Caution</strong>: Although you can complete this process within your app directly, it&#8217;s safer to check the certificates' revocation lists on a separate server that you trust.</p>
</li>
<li>
<p>On a separate server that you trust, obtain a reference to the ASN.1 parser library that is most appropriate for your toolset. Use this parser to extract the attestation certificate extension data, which appears within the first element of the certificate chain.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The <a href="https://github.com/googlesamples/android-key-attestation">Key Attestation sample</a> uses the ASN.1 parser from Bouncy Castle to extract an attestation certificate&#8217;s extension data. You can use this sample as a reference for creating your own parser.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Compare the extension data that you&#8217;ve retrieved from your ASN.1 parser with the set of values that you expect the hardware-backed key to contain.
<strong>Caution</strong>: Although you can complete this process within your app directly, it&#8217;s safer to check the certificate&#8217;s extension data on a separate server that you trust.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="device_management_policies">2.10.6. Device Management Policies</h4>
<div class="paragraph">
<p>It allows developers to create an application that manages access to its content by enforcing device management policies.
Specifically, the application can be configured such that it ensures a screen-lock password of sufficient strength is set up before displaying restricted content to the user.</p>
</div>
<div class="sect4">
<h5 id="define_and_declare_policy">Define and Declare policy</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declare the policy in the <code>res/xml/device_admin.xml</code> file, example:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;device-admin xmlns:android="http://schemas.android.com/apk/res/android"&gt;
  &lt;uses-policies&gt;
    &lt;limit-password /&gt;
  &lt;/uses-policies&gt;
&lt;/device-admin&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Then reference it in the Android manifest file:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;receiver android:name=".Policy$PolicyAdmin"
    android:permission="android.permission.BIND_DEVICE_ADMIN"&gt;
    &lt;meta-data android:name="android.app.device_admin"
        android:resource="@xml/device_admin" /&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.app.action.DEVICE_ADMIN_ENABLED" /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="create_the_device_administration_receiver">Create the Device Administration Receiver</h5>
<div class="paragraph">
<p>The receiver will get notified of events related to the policies you’ve declared to support.
An application can selectively override callback methods. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>public static class PolicyAdmin extends DeviceAdminReceiver {

    @Override
    public void onDisabled(Context context, Intent intent) {
        // Called when the app is about to be deactivated as a device administrator.
        // Deletes previously stored password policy.
        super.onDisabled(context, intent);
        SharedPreferences prefs = context.getSharedPreferences(APP_PREF, Activity.MODE_PRIVATE);
        prefs.edit().clear().commit();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="activate_the_device_administrator">Activate the Device Administrator</h5>
<div class="paragraph">
<p>Before enforcing any policies, the user needs to manually activate the application as a device administrator.
It can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>if (!mPolicy.isAdminActive()) {

    Intent activateDeviceAdminIntent =
        new Intent(DevicePolicyManager.ACTION_ADD_DEVICE_ADMIN);

    activateDeviceAdminIntent.putExtra(
        DevicePolicyManager.EXTRA_DEVICE_ADMIN,
        mPolicy.getPolicyAdmin());

    // It is good practice to include the optional explanation text to
    // explain to user why the application is requesting to be a device
    // administrator. The system will display this message on the activation
    // screen.
    activateDeviceAdminIntent.putExtra(
        DevicePolicyManager.EXTRA_ADD_EXPLANATION,
        getResources().getString(R.string.device_admin_activation_message));

    startActivityForResult(activateDeviceAdminIntent,
        REQ_ACTIVATE_DEVICE_ADMIN);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implement_the_device_policy_controller">Implement the Device Policy Controller</h5>
<div class="paragraph">
<p>After the device administrator is activated successfully, the application then configures Device Policy Manager with the requested policy.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Require password has minimum uppercase letters</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>DevicePolicyManager mDPM = (DevicePolicyManager)
        context.getSystemService(Context.DEVICE_POLICY_SERVICE);
ComponentName mPolicyAdmin = new ComponentName(context, PolicyAdmin.class);
...
mDPM.setPasswordQuality(mPolicyAdmin, PASSWORD_QUALITY_VALUES[mPasswordQuality]);
mDPM.setPasswordMinimumLength(mPolicyAdmin, mPasswordLength);
if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) {
    mDPM.setPasswordMinimumUpperCase(mPolicyAdmin, mPasswordMinUpperCase);
}</code></pre>
</div>
</div>
</li>
<li>
<p>If the requirement is not met, invoke the activity to ask user to reset password:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>if (!mDPM.isActivePasswordSufficient()) {
    ...
    // Triggers password change screen in Settings.
    Intent intent =
        new Intent(DevicePolicyManager.ACTION_SET_NEW_PASSWORD);
    startActivity(intent);
}</code></pre>
</div>
</div>
</li>
<li>
<p>Finally, if requirement is met, the app can continue:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>if (!mDPM.isAdminActive(..)) {
    // Activates device administrator.
    ...
} else if (!mDPM.isActivePasswordSufficient()) {
    // Launches password set-up screen in Settings.
    ...
} else {
    // Grants access to secure content.
    ...
    startActivity(new Intent(context, SecureActivity.class));
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="supporting_direct_boot">2.10.7. Supporting Direct Boot</h4>
<div class="paragraph">
<p>Android 7.0 runs in a secure, Direct Boot mode when the device has been powered on but the user has not unlocked the device.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Most apps should not use Direct Boot mode, as the apps will be running before user has unlocked the device.
It should only be used if it&#8217;s important for the app to run right after the system is started.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="requesting_access_to_run_during_direct_boot">Requesting Access to Run During Direct Boot</h5>
<div class="paragraph">
<p>Apps must register their components with the system before they can run during Direct Boot mode or access device encrypted storage. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;receiver
  android:directBootAware="true" &gt;
  ...
  &lt;intent-filter&gt;
    &lt;action android:name="android.intent.action.LOCKED_BOOT_COMPLETED" /&gt;
  &lt;/intent-filter&gt;
&lt;/receiver&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing_device_encrypted_storage">Accessing Device Encrypted Storage</h5>
<div class="paragraph">
<p>The app will not be able to access the normal file system as the device is still locked.
Android system provides two new storage locations for data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Credential encrypted storage, which is the default storage location and only available after the user has unlocked the device.</p>
</li>
<li>
<p>Device encrypted storage, which is a storage location available both during Direct Boot mode and after the user has unlocked the device.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can access device encrypted storage like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Context directBootContext = appContext.createDeviceProtectedStorageContext();
// Access appDataFilename that lives in device encrypted storage
FileInputStream inStream = directBootContext.openFileInput(appDataFilename);
// Use inStream to read content...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="getting_notified_of_user_unlock">Getting Notified of User Unlock</h5>
<div class="paragraph">
<p>When the user unlocks the device after restart, your app can switch to accessing credential encrypted storage and use regular system services that depend on user credentials.</p>
</div>
<div class="paragraph">
<p>To get notified when the user unlocks the device after a reboot, register a BroadcastReceiver from a running component to listen for unlock notification messages.</p>
</div>
</div>
<div class="sect4">
<h5 id="migrating_existing_data">Migrating Existing Data</h5>
<div class="paragraph">
<p>If a user updates their device to use Direct Boot mode, you might have existing data that needs to get migrated to device encrypted storage.</p>
</div>
<div class="paragraph">
<p>You can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Context.moveSharedPreferencesFrom()</p>
</li>
<li>
<p>Context.moveDatabaseFrom()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>to migrate preference and database data between credential encrypted storage and device encrypted storage</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using_scoped_directory_access">2.10.8. Using Scoped Directory Access</h4>
<div class="paragraph">
<p>This function make it easier for apps that just need access to specific directories. For example, photo apps only need to access the <code>Pictures</code> directory.</p>
</div>
<div class="paragraph">
<p>This is a new function provided from Android 7.0</p>
</div>
<div class="sect4">
<h5 id="accessing_an_external_storage_directory">Accessing an External Storage Directory</h5>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>StorageManager sm = (StorageManager)getSystemService(Context.STORAGE_SERVICE);
StorageVolume volume = sm.getPrimaryStorageVolume();
Intent intent = volume.createAccessIntent(Environment.DIRECTORY_PICTURES);
startActivityForResult(intent, request_code);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The system may confirm the access with the user.</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing_a_directory_on_removable_media">Accessing a Directory on Removable Media</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a BroadcastReceiver that listens for the MEDIA_MOUNTED notification, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>&lt;receiver
    android:name=".MediaMountedReceiver"
    android:enabled="true"
    android:exported="true" &gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.MEDIA_MOUNTED" /&gt;
        &lt;data android:scheme="file" /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>When the user mounts removable media, like an SD card, the system sends a MEDIA_MOUNTED notification. Request access like this:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>// BroadcastReceiver has already cached the MEDIA_MOUNTED
// notification Intent in mediaMountedIntent
StorageVolume volume = (StorageVolume)
    mediaMountedIntent.getParcelableExtra(StorageVolume.EXTRA_STORAGE_VOLUME);
volume.createAccessIntent(Environment.DIRECTORY_PICTURES);
startActivityForResult(intent, request_code);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cordova_security_guide">2.11. Cordova Security Guide</h3>
<div class="paragraph">
<p>This is a summary of the <a href="https://cordova.apache.org/docs/en/latest/guide/appdev/security/">Cordova Security Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="whitelist">2.11.1. Whitelist</h4>
<div class="paragraph">
<p>Domain whitelisting is a security model that controls access to external domains over which your application has no control. Cordova provides a configurable security policy to define which external sites may be accessed. By default, new apps are configured to allow access to any site. Before moving your application to production, you should formulate a whitelist and allow access to specific network domains and subdomains.</p>
</div>
<div class="paragraph">
<p>Be aware that some websites may automatically redirect from their home page to a different url, such as using https protocol or to a country-specific domain. For example <code><a href="http://www.google.com" class="bare">http://www.google.com</a></code> will redirect to use SSL/TLS at <code><a href="https://www.google.com" class="bare">https://www.google.com</a></code>, and then may further redirect to a geography such as <code><a href="https://www.google.co.uk" class="bare">https://www.google.co.uk</a></code>. Such scenarios may require modified or additional whitelist entries beyond your initial requirement</p>
</div>
<div class="paragraph">
<p>Note that the whitelist applies only to the main Cordova webview, and does not apply to an <a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-inappbrowser/">InAppBrowser</a> webview or opening links in the system web browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="iframes_calback_id_mechanism">2.11.2. Iframes &amp; Calback ID Mechanism</h4>
<div class="paragraph">
<p>If content is served in an iframe from a whitelisted domain, that domain will have access to the native Cordova bridge. This means that if you whitelist a third-party advertising network and serve those ads through an iframe, it is possible that a malicious ad will be able to break out of the iframe and perform malicious actions. Because of this, you should generally not use iframes unless you control the server that hosts the iframe content.</p>
</div>
</div>
<div class="sect3">
<h4 id="certificate_pinning_3">2.11.3. Certificate Pinning</h4>
<div class="paragraph">
<p>Cordova does not support true certificate pinning. The main barrier to this is a lack of native APIs in Android for intercepting SSL connections to perform the check of the server&#8217;s certificate.
Since Apache Cordova is meant to offer consistent APIs across multiple platforms, not having a capability in a major platform breaks that consistency.</p>
</div>
<div class="paragraph">
<p>There are ways to approximate certificate pinning, such as checking the server&#8217;s public key (fingerprint) is the expected value when your application starts or at other various times during your application&#8217;s lifetime. There are third-party plugins available for Cordova that can do that. However, this is not the same as true certificate pinning which automatically verifies the expected value on every connection to the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="self_signed_certificates">2.11.4. Self-signed Certificates</h4>
<div class="paragraph">
<p>Using self-signed certificates on your server is not recommended.
If you desire SSL, then it is highly recommended that your server have a certificate that has been properly signed by a well-known CA (certificate authority).
The inability to do true certificate pinning makes this important.
The reason is that accepting self-signed certificates bypasses the certificate chain validation, which allows any server certificate to be considered valid by the device.</p>
</div>
</div>
<div class="sect3">
<h4 id="encrypted_storage">2.11.5. Encrypted storage</h4>
<div class="paragraph">
<p>For encrypted storage, you could consider using one of a number of secure storage plugins for Cordova.
The <a href="https://www.npmjs.com/package/cordova-plugin-secure-key-store">cordova-plugin-secure-key-store</a> plugin uses the Android Keystore and the iOS Keychain for stores sensitive data.</p>
</div>
</div>
<div class="sect3">
<h4 id="general_tips">2.11.6. General Tips</h4>
<div class="sect4">
<h5 id="use_inappbrowser_for_outside_links">Use InAppBrowser for outside links</h5>
<div class="paragraph">
<p>Use the InAppBrowser when opening links to any outside website. This is much safer than whitelisting a domain name and including the content directly in your application because the InAppBrowser will use the native browser&#8217;s security features and will not give the website access to your Cordova environment. Even if you trust the third party website and include it directly in your application, that third party website could link to malicious web content.</p>
</div>
<div class="paragraph">
<p>If you want all page loads in your app to go through the InAppBrowser, you can simply hook <code>window.open</code> during initialization. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() {
    window.open = cordova.InAppBrowser.open;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validate_all_user_input">Validate all User Input</h5>
<div class="paragraph">
<p>Always validate any and all input that your application accepts.
This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>usernames</p>
</li>
<li>
<p>passwords</p>
</li>
<li>
<p>dates</p>
</li>
<li>
<p>uploaded media etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because an attacker could manipulate your HTML and JS assets (either by decompiling your application or using debugging tools like chrome://inspect), this validation should also be performed on your server, especially before handing the data off to any backend service.</p>
</div>
<div class="paragraph">
<p>Other sources where data should be validated include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User Documents</p>
</li>
<li>
<p>Contacts</p>
</li>
<li>
<p>Push Notifications</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="do_not_cache_sensitive_data">Do not cache sensitive data</h5>
<div class="paragraph">
<p>If usernames, password, geolocation information, and other sensitive data is cached, then it could potentially be retrieved later by an unauthorized user or application.</p>
</div>
</div>
<div class="sect4">
<h5 id="do_not_assume_that_your_source_code_is_secure">Do not assume that your source code is secure</h5>
<div class="paragraph">
<p>Since a Cordova application is built from HTML and JavaScript assets that get packaged in a native container, you should not consider your code to be secure.
It is possible to reverse engineer a Cordova application to recover sensitive app data or hardcoded keys etc.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vetting_the_security_of_mobile_applications">2.12. Vetting the Security of Mobile Applications</h3>
<div class="paragraph">
<p>This is a summary of notes taken from the <a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-163.pdf">NIST Vetting the Security of Mobile Applications</a>.</p>
</div>
<div class="sect3">
<h4 id="app_vetting_process">2.12.1. App Vetting Process</h4>
<div class="sect4">
<h5 id="general_process">General Process</h5>
<div class="paragraph">
<p>In an enterprise environment, before the mobile apps are deployed to the devices, they needs to be vetted. The process works like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The apps are submitted to the administrator.</p>
</li>
<li>
<p>The administrator submit the app for testing.
The app testing process will use both static analysis and dynamic analysis services or tools to identity poteintial vulnerabilities of the apps.
It should also generate reports about those vulnerabilities and produce risk assessments.</p>
</li>
<li>
<p>The generated reports will be submitted to an auditor.
Based on the reports the auditor will then submit the recommendation to the approver.</p>
</li>
<li>
<p>Approver will either approve or reject the app.</p>
</li>
<li>
<p>If the app is approved, the administrator will deploy the app. Otherwise the administrator will reject the app.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following diagram can be used to describe the process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/mobile-app-vetting.png" alt="600" width="600">
</div>
</div>
<div class="paragraph">
<p>Further note that although app vetting processes may vary among organizations, organizations should strive to implement a process that is repeatable, efficient, consistent, and that limits errors.</p>
</div>
</div>
<div class="sect4">
<h5 id="planning_the_vetting_process">Planning the Vetting Process</h5>
<div class="paragraph">
<p>Before an organization can implement an app vetting process, it is necessary for the organization to first</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>develop app security requirements</p>
</li>
<li>
<p>understand the limitations of app vetting, and</p>
</li>
<li>
<p>procure a budget and staff for supporting the app vetting process.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="recommendation">Recommendation</h5>
<div class="ulist">
<ul>
<li>
<p>Perform a risk analysis to understand and document the potential security impact of mobile apps on the organization’s computing, networking, and data resources.</p>
</li>
<li>
<p>Review and document the mobile device hardware and operating system security controls, for example an encrypted file system, and identify which security and privacy requirements can be addressed by the mobile device itself.</p>
</li>
<li>
<p>Review and document mobile enterprise security technologies, such as Mobile Device Management (MDM) solutions, and identify which security and privacy requirements can be addressed by these technologies.</p>
</li>
<li>
<p>Review the organization’s mobile security architecture and understand what threats are mitigated through the technical and operational controls. Identify potential security and privacy risks that are not mitigated through these technical and operational controls.</p>
</li>
<li>
<p>Develop organizational app security requirements by identifying general and context-sensitive requirements.</p>
</li>
<li>
<p>Educate organizational staff on the limitations of app vetting and the value of human involvement in an app vetting process.</p>
</li>
<li>
<p>Procure an adequate budget for performing an app vetting process.</p>
</li>
<li>
<p>Hire personnel, particularly auditors, with appropriate expertise.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="app_testing">2.12.2. App Testing</h4>
<div class="paragraph">
<p>General app security requirements include:</p>
</div>
<div class="sect4">
<h5 id="testing_requirements">Testing Requirements</h5>
<div class="sect5">
<h6 id="enabling_authorized_functionality">Enabling authorized functionality</h6>
<div class="sect6">
<h7 id="requirement">Requirement</h7>
<div class="paragraph">
<p>The app must work as described; all buttons, menu items, and other interfaces must work. Error conditions must be handled gracefully, such as when a service or function is unavailable (e.g., disabled, unreachable, etc.)</p>
</div>
</div>
<div class="sect6">
<h7 id="examples">Examples</h7>
<div class="ulist">
<ul>
<li>
<p>Testing the UI</p>
</li>
<li>
<p>Usage of the physical sensors on the device</p>
</li>
<li>
<p>Usage of Telephony and SMS messages of the device</p>
</li>
<li>
<p>Usage of the device identifier or PII (personally identifiable information)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="preventing_unauthorized_functionality">Preventing unauthorized functionality</h6>
<div class="sect6">
<h7 id="requirement_2">Requirement</h7>
<div class="paragraph">
<p>Unauthorized functionality, such as data exfiltration performed by malware, must not be supported.</p>
</div>
</div>
<div class="sect6">
<h7 id="examples_2">Examples</h7>
<div class="ulist">
<ul>
<li>
<p>Malicious malwares that can</p>
<div class="ulist">
<ul>
<li>
<p>exfiltrating confidential information or PII to a third party</p>
</li>
<li>
<p>defrauding the user by sending premium SMS messages</p>
</li>
<li>
<p>injection of fake websites into the victim’s browser</p>
</li>
<li>
<p>the use of banner ads that may be presented in a manner which causes the user to unintentionally select ads that may attempt to deceive the user</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use open source or commercially available malware detection and analysis tools to identify known or new form of malwares</p>
</li>
<li>
<p>Are there communications with disreputable websites, domains, servers, etc</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="limiting_permissions">Limiting permissions</h6>
<div class="sect6">
<h7 id="requirement_3">Requirement</h7>
<div class="paragraph">
<p>Apps should have only the minimum permissions necessary and should only grant other applications the necessary permissions.</p>
</div>
</div>
<div class="sect6">
<h7 id="examples_3">Examples</h7>
<div class="ulist">
<ul>
<li>
<p>File input/output (I/O) and removable storage</p>
<div class="ulist">
<ul>
<li>
<p>file scanning or access to files that are not part of an app’s own directory could be an indicator of malicious activity or bad coding practice</p>
</li>
</ul>
</div>
</li>
<li>
<p>Privileged commands</p>
<div class="ulist">
<ul>
<li>
<p>Apps may possess the ability to invoke lower-level command line programs, which may allow access to low-level structures, such as the root directory, or may allow access to sensitive commands.</p>
</li>
</ul>
</div>
</li>
<li>
<p>APIs</p>
<div class="ulist">
<ul>
<li>
<p>The app only uses designated APIs from the vendor-provided software development kit (SDK) and uses them properly; no other API calls are permitted</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="protecting_sensitive_data">Protecting sensitive data</h6>
<div class="sect6">
<h7 id="requirement_4">Requirement</h7>
<div class="paragraph">
<p>Apps that collect, store, and transmit sensitive data should protect the confidentiality and integrity of this data.
This category includes preserving privacy, such as asking permission to use personal information and using it only for authorized purposes</p>
</div>
</div>
<div class="sect6">
<h7 id="examples_4">Examples</h7>
<div class="ulist">
<ul>
<li>
<p>Usage of invalid cryptography modules. See <a href="http://csrc.nist.gov/groups/STM/cmvp/documents/140-1/140val-all.htm">list of FIPS (Federal Information Processing Standards) validated modules</a></p>
</li>
<li>
<p>Cryptography implementations must also be maintained in accordance with approved practices.</p>
<div class="ulist">
<ul>
<li>
<p>Cryptographic key management is often performed improperly, leading to exploitable weaknesses. See <a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt3r1.pdf">NIST Recommendation for Key Management</a></p>
</li>
<li>
<p>The failure to properly validate digital certificates, leaving communications protected by these certificates subject to man-in-themiddle attacks.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Privacy considerations need to be taken into account for apps that handle PII, including mobile-specific personal information like location data and pictures taken by onboard cameras, as well as the broadcast ID of the device.</p>
</li>
<li>
<p>Data leakage</p>
<div class="ulist">
<ul>
<li>
<p>Through unauthorized network connections.</p>
</li>
<li>
<p>Shared system-level logs, where multiple apps log their security events to a single log file</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="securing_app_code_dependencies">Securing app code dependencies</h6>
<div class="sect6">
<h7 id="requirement_5">Requirement</h7>
<div class="paragraph">
<p>The app must use any dependencies, such as on libraries, in a reasonable manner and not for malicious reasons.
Specifically, an app should properly use other bodies of code, such as libraries, only when needed, and not to attempt to obfuscate malicious activity</p>
</div>
</div>
<div class="sect6">
<h7 id="examples_5">Examples</h7>
<div class="ulist">
<ul>
<li>
<p>Native Methods</p>
<div class="ulist">
<ul>
<li>
<p>Native method calls are typically calls to a library function that has already been loaded into memory.</p>
</li>
<li>
<p>However, can provide a level of obfuscation that impacts the ability to perform analysis of the app.</p>
</li>
</ul>
</div>
</li>
<li>
<p>External Libraries and Classes</p>
<div class="ulist">
<ul>
<li>
<p>Third-party libraries and classes can be closed source, can have selfmodifying code, or can execute unknown server-side code.</p>
</li>
<li>
<p>Legitimate uses for loaded libraries and classes might be for the use of a cryptographic library or a graphics API.</p>
</li>
<li>
<p>Tools are available that can list libraries, and these libraries can then be searched for in vulnerability databases to determine if they have known weaknesses.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dynamic Behavior</p>
<div class="ulist">
<ul>
<li>
<p>The key point here is the need to know where data used by an app originates from and knowing whether and how it gets sanitized.</p>
</li>
<li>
<p>It is critical to recognize that data downloaded from an external source is particularly dangerous as a potential exploit vector unless it is clear how the app prevents insecure behaviors resulting from data from a source not trusted by the organization using the app.</p>
</li>
<li>
<p>Requiring some level of risk-tolerance mitigation.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Inter-Application Communications</p>
<div class="ulist">
<ul>
<li>
<p>Be aware of situations where an app is using nonhuman entities to make API calls to other devices, to communicate with third-party services, or to otherwise interact with other systems.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="testing_app_updates">Testing app updates</h6>
<div class="sect6">
<h7 id="requirement_6">Requirement</h7>
<div class="paragraph">
<p>New versions of the app must be tested to identify any new weaknesses.</p>
</div>
</div>
<div class="sect6">
<h7 id="examples_6">Examples</h7>
<div class="ulist">
<ul>
<li>
<p>All apps, as well as their updates, should go through a software assurance vetting process, because each new version of an app can introduce new unintentional weaknesses or unreliable code.</p>
</li>
<li>
<p>But devices can install updates automatically, or users can install updates from somewhere else</p>
<div class="ulist">
<ul>
<li>
<p>Disabling all automatic updates</p>
</li>
<li>
<p>Only permitting use of an organization-provided app store</p>
</li>
<li>
<p>Enabling MDM mobile application management features</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="testing_approaches">Testing Approaches</h5>
<div class="sect5">
<h6 id="correctness_testing">Correctness Testing</h6>
<div class="ulist">
<ul>
<li>
<p>Software correctness testing is the process of executing a program with the intent of finding errors.</p>
</li>
<li>
<p>Although software correctness testing is aimed primarily at improving quality assurance, verifying and validating described functionality, or estimating reliability, it can also help to reveal potential security vulnerabilities since such vulnerabilities often have a negative effect on the quality, functionality, and reliability of the software.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="source_code_versus_binary_code">Source Code Versus Binary Code</h6>
<div class="ulist">
<ul>
<li>
<p>When source code is available, such as in the case of an open source app, a variety of tools can be used to analyze it.</p>
<div class="ulist">
<ul>
<li>
<p>Reviewers should generally use automated static analysis tools whether they are conducting an automated or a manual review, and they should express their findings in terms of Common Weakness Enumeration (CWE) identifiers or some other widely accepted nomenclature.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="static_versus_dynamic_analysis">Static Versus Dynamic Analysis</h6>
<div class="ulist">
<ul>
<li>
<p>Organizations should consider the technical trade-off differences between what static and dynamic tools offer and balance their usage given the organization’s software assurance goals.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="automated_tools">Automated Tools</h6>
<div class="paragraph">
<p>Classes of automated tools include</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simulators</p>
</li>
<li>
<p>Remote Device Access</p>
</li>
<li>
<p>Automated Testing</p>
<div class="ulist">
<ul>
<li>
<p>User Interface-Driven Testing</p>
</li>
<li>
<p>Data-Driven Testing</p>
</li>
<li>
<p>Fuzzing</p>
</li>
<li>
<p>Network-Level Testing</p>
</li>
</ul>
</div>
</li>
<li>
<p>Test Automation</p>
</li>
<li>
<p>Static Tools</p>
<div class="ulist">
<ul>
<li>
<p>Static Analysis Tools</p>
</li>
<li>
<p>Metrics Tools</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Organizations will need to use multiple automated tools to meet their testing requirements.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sharing_results">Sharing Results</h5>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://nvd.nist.gov/">National Vulnerability Database (NVD)</a> is the U.S. government repository of standards-based
vulnerability management data represented using the <a href="https://scap.nist.gov/">Security Content Automation Protocol (SCAP)</a></p>
<div class="ulist">
<ul>
<li>
<p>The NVD includes databases of security checklists, security-related software flaws, misconfigurations,
product names, and impact metrics.</p>
</li>
<li>
<p>SCAP is a suite of specifications that standardize the format and nomenclature by which security software products communicate software flaw and security configuration information</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <a href="http://cwe.mitre.org/">CWE</a> and <a href="https://capec.mitre.org/">Common Attack Pattern Enumeration and Classification (CAPEC)</a> collections can provide a useful list of weaknesses and attack approaches to drive a binary or live system penetration test.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="recommendation_2">Recommendation</h5>
<div class="ulist">
<ul>
<li>
<p>Review licensing agreements associated with analyzers and understand the security implications surrounding the integrity, intellectual property, and licensing issues when submitting an app to an analyzer.</p>
</li>
<li>
<p>Ensure that apps transmitted over the network use an encrypted channel (e.g., SSL) and that apps are stored on a secure machine at the analyzer&#8217;s location. In addition, ensure that only authorized users have access to that machine.</p>
</li>
<li>
<p>Identify general app security requirements needed by the organization.</p>
</li>
<li>
<p>Select appropriate testing tools and methodologies for determining the satisfaction or violation of general app security requirements.</p>
</li>
<li>
<p>Ensure that app updates are tested.</p>
</li>
<li>
<p>Leverage existing testing results where possible.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="app_approval_rejection">2.12.3. App Approval/Rejection</h4>
<div class="sect4">
<h5 id="report_and_risk_auditing">Report and Risk Auditing</h5>
<div class="ulist">
<ul>
<li>
<p>One of the main issues related to report and risk auditing stems from the difficulty in collating and interpreting different reports and risk assessments from multiple analyzers due to the wide variety of security-related definitions, semantics, nomenclature, and metrics</p>
<div class="ulist">
<ul>
<li>
<p>It is recommended that an organization identify analyzers that leverage vulnerability reporting and risk assessment standards.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="organization_specific_vetting_criteria">Organization-Specific Vetting Criteria</h5>
<div class="paragraph">
<p>Sample criterias:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Requirements</p>
</li>
<li>
<p>Provenance</p>
</li>
<li>
<p>Data Sensitivity</p>
</li>
<li>
<p>App Criticality</p>
</li>
<li>
<p>Target Users</p>
</li>
<li>
<p>Target Hardware</p>
</li>
<li>
<p>Target Environment</p>
</li>
<li>
<p>Digital Signature</p>
</li>
<li>
<p>App Documentation</p>
<div class="ulist">
<ul>
<li>
<p>User Guide</p>
</li>
<li>
<p>Test Plans</p>
</li>
<li>
<p>Testing Results</p>
</li>
<li>
<p>Service-Level Agreement</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="recommendation_3">Recommendation</h5>
<div class="ulist">
<ul>
<li>
<p>Use analyzers that leverage a standardized reporting format or risk assessment methodology, or that provides intuitive and easy-to-interpret reports and risk assessments.</p>
</li>
<li>
<p>Ensure sufficient training of auditors on both the organization&#8217;s security requirements and interpretation of analyzer reports and risk assessments. Use multiple auditors to increase likelihood of appropriate recommendations.</p>
</li>
<li>
<p>Identify organization-specific vetting criteria necessary for vetting context-sensitive app security requirements.</p>
</li>
<li>
<p>Monitor public databases, mailing lists, and other publicly available security vulnerability reporting repositories to keep abreast of new developments that may impact the security of mobile devices and mobile apps.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="niap_mobile_app_vetting">2.13. NIAP Mobile App Vetting</h3>
<div class="paragraph">
<p>This is a summary of the <a href="https://www.niap-ccevs.org/pp/pp_app_v1.2_table-reqs.htm">NIAP Mobile App Vetting</a> Guidelines.</p>
</div>
<div class="sect3">
<h4 id="security_functional_requirements">2.13.1. Security Functional Requirements</h4>
<div class="sect4">
<h5 id="random_bit_generation_services">Random Bit Generation Services</h5>
<div class="paragraph">
<p>The Application should select from the following approaches for its cryptographic operations:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; use no DRBG functionality</p>
</li>
<li>
<p>&#10063; invoke platform-provided DRBG functionality</p>
</li>
<li>
<p>&#10063; implement DRBG functionality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>DRBG</em>: Deterministic Random Bit Generator (aka RNG, PRNG) based HMACs, Hashes, and Ciphers. In this requirement, cryptographic operations include all cryptographic key generation/derivation/agreement, IVs (for certain modes), as well as protocol-specific random values.</p>
</div>
</div>
<div class="sect4">
<h5 id="storage_of_credentials">Storage of Credentials</h5>
<div class="paragraph">
<p>The Application should select from the following approaches for storage of credentials in non-volatile memory:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; not store any credentials</p>
</li>
<li>
<p>&#10063; invoke the functionality provided by the platform to securely store credentials</p>
</li>
<li>
<p>&#10063; implement functionality to securely store credentials</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requirement ensures that persistent credentials like secret keys, PKI private keys, or passwords are stored in a secure manner.</p>
</div>
</div>
<div class="sect4">
<h5 id="access_to_platform_resources">Access to Platform Resources</h5>
<div class="paragraph">
<p>The application shall restrict its access to the following and additonal hardware resources:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; No Hardware Resources</p>
</li>
<li>
<p>&#10063; Network Connectivity</p>
</li>
<li>
<p>&#10063; Camera</p>
</li>
<li>
<p>&#10063; Microphone</p>
</li>
<li>
<p>&#10063; Location Services</p>
</li>
<li>
<p>&#10063; NFC</p>
</li>
<li>
<p>&#10063; USB</p>
</li>
<li>
<p>&#10063; Bluetooth</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The intent is to ensure that the selection captures all hardware resources which the application accesses, and that these are restricted to those which are required or used by the application.</p>
</div>
<div class="paragraph">
<p>The application shall also restrict its access to the following and additonal sensitive information repositories:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; No Sensitive Information Repositories</p>
</li>
<li>
<p>&#10063; Address Book</p>
</li>
<li>
<p>&#10063; Calendar</p>
</li>
<li>
<p>&#10063; Call Lists</p>
</li>
<li>
<p>&#10063; System Logs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sensitive information repositories are defined as those collections of sensitive data that could be expected to be shared among some applications, users, or user roles, but to which not all of these would ordinarily require access.</p>
</div>
</div>
<div class="sect4">
<h5 id="network_communications">Network Communications</h5>
<div class="paragraph">
<p>The application shall restrict network communication to the following and additional application-initiated communications:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; No Network Communication</p>
</li>
<li>
<p>&#10063; User-initiated Communication for the list of Functions for which the User can Initiate Network Communication</p>
</li>
<li>
<p>&#10063; Respond to Remotely Initiated Communications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requirement is intended to restrict both inbound/outbound network communications to only those required, or to those initiated by the user.</p>
</div>
</div>
<div class="sect4">
<h5 id="encryption_of_sensitive_application_data">Encryption Of Sensitive Application Data</h5>
<div class="paragraph">
<p>The Application should select from the following approaches for storage of sensitive data in non-volatile memory:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Leverage Platform-provided Functionality to Encrypt Sensitive Data</p>
</li>
<li>
<p>&#10063; Implement Functionality to Encrypt Sensitive Data</p>
</li>
<li>
<p>&#10063; Not Store any Sensitive Data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any file that may potentially contain sensitive data shall be protected.
The only exception is if the user intentionally exports the sensitive data to non-protected files.</p>
</div>
</div>
<div class="sect4">
<h5 id="supported_configuration_mechanism">Supported Configuration Mechanism</h5>
<div class="paragraph">
<p>The application shall invoke the mechanisms recommended by the platform or framework vendor for storing and setting configuration options.</p>
</div>
</div>
<div class="sect4">
<h5 id="secure_by_default_configuration">Secure by Default Configuration</h5>
<div class="paragraph">
<p>The application shall be configured by default with file permissions which protect it and its data from unauthorized access.
There should be some form of trust boundary which protects the application and its data.</p>
</div>
</div>
<div class="sect4">
<h5 id="specification_of_management_functions">Specification of Management Functions</h5>
<div class="paragraph">
<p>The TSF (Target of Evaluation Security Functionality) shall be capable of performing the following management functions:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; No Management functions.</p>
</li>
<li>
<p>&#10063; Enable/Disable the Transmission of any information describing the system&#8217;s hardware, software, or configuration</p>
</li>
<li>
<p>&#10063; Enable/Disable the Transmission of any PII (Personally Identifiable Information)</p>
</li>
<li>
<p>&#10063; Enable/Disable the Transmission of any application state (e.g. crashdump) information</p>
</li>
<li>
<p>&#10063; Enable/Disable network backup functionality to enterprise or commercial cloud backup systems</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TOE (Target of Evaluation) security functionality is the “combined functionality of all hardware, software, and firmware of a TOE that must be relied upon for the correct enforcement of the security functional requirements.</p>
</div>
</div>
<div class="sect4">
<h5 id="user_consent_for_transmission_of_personally_identifiable_information">User Consent for Transmission of Personally Identifiable Information</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Not Transmit PII over a Network</p>
</li>
<li>
<p>&#10063; Require User Approval before Executing a Function that Transmits PII over a Network</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requirement applies only to PII that is specifically requested by the application;
it does not apply if the user volunteers PII without prompting from the application into a general (or inappropriate) data field.
A dialog box that declares intent to send PII presented to the user when the application is started is sufficient to meet this requirement.</p>
</div>
</div>
<div class="sect4">
<h5 id="use_of_supported_services_and_apis">Use of Supported Services and APIs</h5>
<div class="paragraph">
<p>The application shall use only documented platform APIs.</p>
</div>
</div>
<div class="sect4">
<h5 id="anti_exploitation_capabilities">Anti-Exploitation Capabilities</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Not allocate any memory region with both write and execute permissions</p>
</li>
<li>
<p>&#10063; Allocate memory regions with write and execute permissions for only a specified list of functions performing just-in-time compilation</p>
<div class="ulist">
<ul>
<li>
<p>Requesting a memory mapping with both write and execute permissions subverts the platform protection provided by DEP.</p>
<div class="ulist">
<ul>
<li>
<p>The application shall be compatible with security features provided by the platform vendor.</p>
</li>
</ul>
</div>
</li>
<li>
<p>This requirement is designed to ensure that platform security features do not need to be disabled in order for the application to run.</p>
<div class="ulist">
<ul>
<li>
<p>The application shall not write user-modifiable files to directories that contain executable files unless explicitly directed by the user to do so.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Executables and user-modifiable files may not share the same parent directory, but may share directories above the parent.</p>
<div class="ulist">
<ul>
<li>
<p>The application shall be compiled with stack-based buffer overflow protection enabled.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="integrity_for_installation_and_update">Integrity for Installation and Update</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Provide the ability or leverage the platform to check for updates and patches to the application software.</p>
</li>
<li>
<p>&#10063; Be distributed using the format of the platform-supported package manager.</p>
</li>
<li>
<p>&#10063; Be packaged such that its removal results in the deletion of all traces of the application, with the exception of configuration settings, output files, and audit/log events.</p>
</li>
<li>
<p>&#10063; Not download, modify, replace or update its own binary code.</p>
</li>
<li>
<p>&#10063; Provide the ability or leverage the platform to query the current version of the application software.</p>
</li>
<li>
<p>&#10063; Ensure that the installation package and its updates shall be digitally signed such that its platform can cryptographically verify them prior to installation.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="use_of_third_party_libraries">Use of Third Party Libraries</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Be packaged with only third-party libraries that are required and vulnerability free.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protection_of_data_in_transit">Protection of Data in Transit</h5>
<div class="paragraph">
<p>The application shall use one or more of the approaches for transmitting between itself and another trusted IT product:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Not Transmit any Data</p>
</li>
<li>
<p>&#10063; Not Transmit any Sensitive Data</p>
</li>
<li>
<p>&#10063; Encrypt all transmitted sensitive data with at least one of the following: HTTPS, TLS, DTLS, SSH</p>
</li>
<li>
<p>&#10063; Encrypt all transmitted data with at least one of the following: HTTPS, TLS, DTLS, SSH</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="security_assurance_requirements">2.13.2. Security Assurance Requirements</h4>
<div class="paragraph">
<p>The application shall be labeled with a unique references:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Application Name</p>
</li>
<li>
<p>&#10063; Application Version</p>
</li>
<li>
<p>&#10063; Application Description</p>
</li>
<li>
<p>&#10063; Platform on which Application Runs</p>
</li>
<li>
<p>&#10063; Software Identification (SWID) tags, if available</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="selection_based_security_functional_requirements">2.13.3. Selection-Based Security Functional Requirements</h4>
<div class="sect4">
<h5 id="random_bit_generation_from_application">Random Bit Generation from Application</h5>
<div class="paragraph">
<p>The application shall perform all deterministic random bit generation (DRBG) services in accordance with <a href="http://csrc.nist.gov/publications/nistpubs/800-90A/SP800-90A.pdf">NIST Special Publication 800-90A</a> using any of the following:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Hash_DRBG (any)</p>
</li>
<li>
<p>&#10063; HMAC_DRBG (any)</p>
</li>
<li>
<p>&#10063; CTR_DRBG (AES)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The deterministic RBG shall be seeded by an entropy source that accumulates entropy from a platform-based DRBG and a:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; A software-based noise source</p>
</li>
<li>
<p>&#10063; No other noise source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>with a minimum of:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; 128 bits</p>
</li>
<li>
<p>&#10063; 256 bits</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>of entropy at least equal to the greatest security strength (according to <a href="http://csrc.nist.gov/publications/nistpubs/800-57/sp800-57-Part1-revised2_Mar08-2007.pdf">NIST SP 800-57</a>) of the keys and hashes that it will generate.</p>
</div>
</div>
<div class="sect4">
<h5 id="cryptographic_key_generation_services">Cryptographic Key Generation Services</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Generate no asymmetric cryptographic keys</p>
</li>
<li>
<p>&#10063; Invoke platform-provided functionality for asymmetric key generation</p>
</li>
<li>
<p>&#10063; Implement asymmetric key generation</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cryptographic_asymmetric_key_generation">Cryptographic Asymmetric Key Generation</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Generate asymmetric cryptographic keys in accordance with a specified cryptographic key generation algorithm</p>
<div class="ulist">
<ul>
<li>
<p>An RSA scheme using cryptographic key sizes of 2048-bit or greater that meet the following:</p>
<div class="ulist">
<ul>
<li>
<p>FIPS PUB 186-4, “Digital Signature Standard (DSS)”</p>
</li>
<li>
<p>ANSI X9.31-1998</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cryptographic_operation_encryption_decryption">Cryptographic Operation - Encryption/Decryption</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Perform encryption/decryption in accordance with a specified cryptographic algorithm:</p>
<div class="ulist">
<ul>
<li>
<p>AES-CBC</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AES-GCM</p>
</li>
<li>
<p>No other modes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>with cryptographic key sizes of 256-bit.</p>
</div>
</div>
<div class="sect4">
<h5 id="cryptographic_operation_hashing">Cryptographic Operation - Hashing</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Perform cryptographic hashing services in accordance with a specified cryptographic algorithm:</p>
<div class="ulist">
<ul>
<li>
<p>SHA-1</p>
</li>
<li>
<p>SHA-256</p>
</li>
<li>
<p>SHA-384</p>
</li>
<li>
<p>SHA-512</p>
</li>
<li>
<p>No other algorithms</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>and message digest sizes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>160</p>
</li>
<li>
<p>256</p>
</li>
<li>
<p>384</p>
</li>
<li>
<p>512</p>
</li>
<li>
<p>No other message digest sizes</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cryptographic_operation_signing">Cryptographic Operation - Signing</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Perform cryptographic signature services (generation and verification) in accordance with a specified cryptographic algorithm:</p>
<div class="ulist">
<ul>
<li>
<p>RSA schemes using cryptographic key sizes of 2048-bit or greater that meet the following: <a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf">FIPS PUB 186-4, “Digital Signature Standard (DSS)”, Section 4</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cryptographic_operation_keyed_hash_message_authentication">Cryptographic Operation - Keyed-Hash Message Authentication</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Perform keyed-hash message authentication in accordance with a specified cryptographic algorithm:</p>
<div class="ulist">
<ul>
<li>
<p>HMAC-SHA-256</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SHA-1</p>
</li>
<li>
<p>SHA-384</p>
</li>
<li>
<p>SHA-512</p>
</li>
<li>
<p>No other algorithms</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>with key sizes the same length as thouser used in HMAC (in bits) and message digest sizes 256 and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>160</p>
</li>
<li>
<p>384</p>
</li>
<li>
<p>512</p>
</li>
<li>
<p>No other sizes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>bits that meet the following: <a href="http://csrc.nist.gov/publications/fips/fips198-1/FIPS-198-1_final.pdf">FIPS Pub 198-1</a> The Keyed-Hash Message Authentication Code and <a href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf">FIPS Pub 180-4</a> Secure Hash Standard.</p>
</div>
</div>
<div class="sect4">
<h5 id="tls_client_protocol">TLS Client Protocol</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Invoke platform-provided TLS 1.2</p>
</li>
<li>
<p>&#10063; Implement TLS 1.2 (RFC 5246)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>supporting the following cipher suites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandatory Cipher Suites: TLS_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5246</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional Cipher Suites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_RSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>TLS_RSA_WITH_AES_256_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>No other cipher suite</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Verify that the presented identifier matches the reference identifier according to <a href="https://tools.ietf.org/html/rfc6125">RFC 6125</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Establish a trusted channel only if the peer certificate is valid.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="tls_server_protocol">TLS Server Protocol</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Invoke platform-provided TLS 1.2</p>
</li>
<li>
<p>&#10063; Implement TLS 1.2 (RFC 5246)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>supporting the following cipher suites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandatory Cipher Suites: TLS_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5246</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional Cipher Suites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 as defined in <a href="https://tools.ietf.org/html/rfc5289">RFC 5289</a></p>
</li>
<li>
<p>TLS_RSA_WITH_AES_128_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>TLS_RSA_WITH_AES_256_CBC_SHA256 as defined in <a href="https://tools.ietf.org/html/rfc5246">RFC 5246</a></p>
</li>
<li>
<p>No other cipher suite</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Deny connections from clients requesting:</p>
<div class="ulist">
<ul>
<li>
<p>SSL 2.0</p>
</li>
<li>
<p>SSL 3.0</p>
</li>
<li>
<p>TLS 1.0</p>
</li>
<li>
<p>TLS 1.1</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Support mutual authentication of TLS clients using X.509 v3 certificates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Not establish a trusted channel if the peer certificate is invalid.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Not establish a trusted channel if the distinguished name (DN) or Subject Alternative Name (SAN) contained in a certificate does not match the expected identifier for the peer.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dtls_implementation">DTLS Implementation</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Implement the DTLS protocol in accordance with DTLS 1.2 (<a href="https://tools.ietf.org/html/rfc6347">RFC 6347</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Implement the requirements in TLS (FCS_TLSC_EXT.1) for the DTLS implementation, except where variations are allowed according to DTLS 1.2 (<a href="https://tools.ietf.org/html/rfc6347">RFC 6347</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Not establish a trusted communication channel if the peer certificate is deemed invalid.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="https_protocol">HTTPS Protocol</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Implement the HTTPS protocol that complies with <a href="https://tools.ietf.org/html/rfc2818">RFC 2818</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Implement HTTPS using TLS (<a href="https://www.niap-ccevs.org/pp/pp_app_v1.2_table-reqs.htm#FCS_TLSC_EXT.1">FCS_TLSC_EXT.1</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Notify the user and</p>
<div class="ulist">
<ul>
<li>
<p>Not establish the connection</p>
</li>
<li>
<p>Request application authorization to establish the connection</p>
</li>
<li>
<p>No other action</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>if the peer certificate is deemed invalid.</p>
</div>
</div>
<div class="sect4">
<h5 id="x_509_certificate_validation">X.509 Certificate Validation</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Invoked platform-provided functionality</p>
</li>
<li>
<p>&#10063; Implement functionality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>to validate certificates in accordance with the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc5280">RFC 5280</a> certificate validation and certificate path validation.</p>
</li>
<li>
<p>The certificate path must terminate with a trusted CA certificate.</p>
</li>
<li>
<p>The application shall validate a certificate path by ensuring the presence of the basicConstraints extension and that the CA flag is set to TRUE for all CA certificates.</p>
</li>
<li>
<p>The application shall:</p>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Validate the revocation status of the certificate using:</p>
<div class="ulist">
<ul>
<li>
<p>The Online Certificate Status Protocol (OCSP) as specified in <a href="https://tools.ietf.org/html/rfc2560">RFC 2560</a></p>
</li>
<li>
<p>A Certificate Revocation List (CRL) as specified in <a href="https://tools.ietf.org/html/rfc5759">RFC 5759</a> , an OCSP TLS Status Request Extension (i.e., OCSP stapling) as specified in <a href="https://tools.ietf.org/html/rfc6066">RFC 6066</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The application shall validate the extendedKeyUsage field according to the following rules:</p>
<div class="ulist">
<ul>
<li>
<p>Certificates used for trusted updates and executable code integrity verification shall have the Code Signing purpose (id-kp 3 with OID 1.3.6.1.5.5.7.3.3) in the extendedKeyUsage field.</p>
</li>
<li>
<p>Server certificates presented for TLS shall have the Server Authentication purpose (id-kp 1 with OID 1.3.6.1.5.5.7.3.1) in the extendedKeyUsage field.</p>
</li>
<li>
<p>Client certificates presented for TLS shall have the Client Authentication purpose (id-kp 2 with OID 1.3.6.1.5.5.7.3.2) in the extendedKeyUsage field.</p>
</li>
<li>
<p>S/MIME certificates presented for email encryption and signature shall have the Email Protection purpose (id-kp 4 with OID 1.3.6.1.5.5.7.3.4) in the extendedKeyUsage field.</p>
</li>
<li>
<p>OCSP certificates presented for OCSP responses shall have the OCSP Signing purpose (id-kp 9 with OID 1.3.6.1.5.5.7.3.9) in the extendedKeyUsage field.</p>
</li>
<li>
<p>Server certificates presented for EST shall have the CMC Registration Authority (RA) purpose (id-kp-cmcRA with OID 1.3.6.1.5.5.7.3.28) in the extendedKeyUsage field.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Treat a certificate as a CA certificate only if the basicConstraints extension is present and the CA flag is set to TRUE.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="x_509_certificate_authentication">X.509 Certificate Authentication</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Use X.509v3 certificates as defined by RFC 5280 to support authentication for:</p>
<div class="ulist">
<ul>
<li>
<p>HTTPS</p>
</li>
<li>
<p>TLS</p>
</li>
<li>
<p>DTLS</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the application cannot establish a connection to determine the validity of a certificate, the application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Allow the administrator to choose whether to accept the certificate in these cases</p>
</li>
<li>
<p>&#10063; Accept the certificate</p>
</li>
<li>
<p>&#10063; Not accept the certificate</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="objective_security_functional_requirements">2.13.4. Objective Security Functional Requirements</h4>
<div class="sect4">
<h5 id="tls_client_protocol_2">TLS Client Protocol</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Present the signature_algorithms extension in the Client Hello with the supported_signature_algorithms value containing the following hash algorithms:</p>
<div class="ulist">
<ul>
<li>
<p>SHA256</p>
</li>
<li>
<p>SHA384</p>
</li>
<li>
<p>SHA512</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>and no other hash algorithms.</p>
</div>
</div>
<div class="sect4">
<h5 id="use_of_supported_services_and_apis_2">Use of Supported Services and APIs</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Use platform-provided libraries, does not implement functionality for parsing the list of formats parsed that are included in the <a href="http://www.iana.org/assignments/media-types">IANA MIME media types</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="software_identification_and_versions">Software Identification and Versions</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Include SWID tags that comply with the minimum requirements for SWID tag from <a href="https://www.iso.org/standard/53670.html">ISO/IEC 19770-2:2009 standard</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Valid SWID tags must contain a SoftwareIdentity element and an Entity element as defined in the <a href="https://www.iso.org/standard/53670.html">ISO/IEC 19770-2:2009 standard</a>. SWID tags must be stored with a .swidtag file extensions as defined in the ISO/IEC 19770-2:2009.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="optional_security_functional_requirements">2.13.5. Optional Security Functional Requirements</h4>
<div class="sect4">
<h5 id="cryptographic_symmetric_key_generation">Cryptographic Symmetric Key Generation</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Generate symmetric cryptographic keys using a Random Bit Generator as specified in FCS_RBG_EXT.1 and specified cryptographic key sizes:</p>
<div class="ulist">
<ul>
<li>
<p>128 bit</p>
</li>
<li>
<p>256 bit</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="tls_client_protocol_3">TLS Client Protocol</h5>
<div class="paragraph">
<p>The application shall:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10063; Support mutual authentication using X.509v3 certificates.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dhs_study_on_mobile_device_security">2.14. DHS Study on Mobile Device Security</h3>
<div class="paragraph">
<p>This is a review of the <a href="https://www.dhs.gov/sites/default/files/publications/DHS%20Study%20on%20Mobile%20Device%20Security%20-%20April%202017-FINAL.pdf">DHS Study on Mobile Device Security</a></p>
</div>
<div class="sect3">
<h4 id="mobile_security_threats_and_defenses">2.14.1. Mobile Security Threats and Defenses</h4>
<div class="sect4">
<h5 id="mobile_security_threats_categories">Mobile Security Threats Categories</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Threat</th>
<th class="tableblock halign-left valign-top">Definition</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denial of Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deny or degrade service to users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jamming of wireless communications, overloading networks with bogus traffic, ransomware, theft of mobile device or mobile services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Geolocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical tracking of user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passively or actively obtaining accurate three-dimensional coordinates of target, possibly including speed and direction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Information Disclosure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized access to information or services.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interception of data in transit, leakage or exfiltration of user, app, or enterprise data, tracking of user location, eavesdropping on voice or data communications, surreptitiously activating the phone’s microphone or camera to spy on the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spoofing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Impersonating something or someone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email or SMS message pretending to be from boss or colleague (social engineering); fraudulent Wi-Fi access point or cellular base station mimicking a legitimate one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tampering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifying data, software, firmware, or hardware without authorization.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifying data in transit, inserting tampered hardware or software into supply chain, repackaging legitimate app with malware, modifying network or device configuration (e.g., jailbreaking or rooting a phone).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="threats_in_the_mobile_device_technology_stack">Threats in the Mobile Device Technology Stack</h5>
<div class="sect5">
<h6 id="mobile_operating_system">Mobile Operating System</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Mobile OS vulnerabilities</p>
</li>
<li>
<p>Vendors &amp; Carriers slow to rollout system updates (especially for Android)</p>
</li>
<li>
<p>Jailbroke or rooted devices</p>
</li>
<li>
<p>Vulnerabilities in vendor or carrier-specific additions</p>
</li>
<li>
<p>Vulnerabilities in cloud services provided by the vendors</p>
</li>
<li>
<p>Install application using PC</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>Ensure devices are patched against publicly known security vulnerabilities and are running the most recent OS</p>
</li>
<li>
<p>Consider blocking access if devices are out of date</p>
</li>
<li>
<p>Enterprises should seek commitment from device vendors that security updates will be provided</p>
</li>
<li>
<p>Advice user not to root or jailbreak devices.</p>
</li>
<li>
<p>Enable strong authentication for cloud services</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="low_level_device_components">Low-Level Device Components</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Bootloader vulnerabilities</p>
</li>
<li>
<p>Vulnerabilities in the isolated execution environments. e.g  Trusted Execution Environment on Android and Apple&#8217;s Secure Enclave</p>
</li>
<li>
<p>Vulnerabilities in baseband processors</p>
</li>
<li>
<p>Softwares that below the OS added by Mobile Network Operators</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>Ensure devices are patched against publicly known security vulnerabilities</p>
</li>
<li>
<p>Enable device integrity checking capabilities</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="defense_gaps">Defense Gaps</h6>
<div class="ulist">
<ul>
<li>
<p>The inability of enterprises to gain visibility into indicators of adversary activity such as indications of exploitation of previously unknown (zero-day) vulnerabilities.</p>
</li>
<li>
<p>Variations in security update speed and availability depending on the device vendor or network carrier.</p>
</li>
<li>
<p>The inattention to software assurance best practices during the development of some mobile device components.</p>
</li>
<li>
<p>The failure to use strong authentication mechanisms—even when available—for cloud services on which the device depends for secure functionality.</p>
</li>
<li>
<p>Much effort has gone into increasing the resilience of mobile device components against exploitation, but continued effort is required in this area and should focus not only on the mobile operating system but also on lower-level components such as TEEs and baseband processors and the software/firmware used to operate them.</p>
</li>
<li>
<p>Software or firmware installed by the MNO or OEM is typically outside the purview of the mobile operating system provider, making it difficult to detect.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="threats_in_mobile_applications">Threats in Mobile Applications</h5>
<div class="sect5">
<h6 id="threats_against_vulnerable_applications">Threats against Vulnerable Applications</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Insecure Network Communication</p>
</li>
<li>
<p>Files Stored with Insecure File Permissions or in an Unprotected Location</p>
</li>
<li>
<p>Sensitive Information Written to System Log</p>
</li>
<li>
<p>Web Browser Vulnerabilities</p>
</li>
<li>
<p>Vulnerabilities in Third-Party Libraries</p>
</li>
<li>
<p>Cryptographic Vulnerabilities</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>Best practices in development</p>
<div class="ulist">
<ul>
<li>
<p>Follow security best practices such as those published by Google for Android and Apple for iOS.</p>
</li>
<li>
<p>Use of free capabilities bundled into the application development environment to assess the security of their applications,</p>
</li>
<li>
<p>Make use of the Network Security Configuration feature recently introduced into Android and the Application Transport Security feature recently introduced into iOS</p>
</li>
<li>
<p>Consider using commercial mobile application vetting tools that can assess applications for many common vulnerabilities</p>
</li>
<li>
<p>Ensure appropriate data encryption, strong access control, separation between applications (e.g., restricting copy-paste ability), and provide the ability to perform local or remote data wipes of individual application data</p>
</li>
<li>
<p>Deploy and maintain EMM/MDM tools</p>
</li>
<li>
<p>Threat intelligence should be used to understand the potential risks associated with apps installed on devices</p>
</li>
<li>
<p>Ensure devices are running the latest version of iOS or Android because each OS version has brought security architecture improvements and ensure applications receive security patches</p>
</li>
</ul>
</div>
</li>
<li>
<p>Test cases prior to distribution</p>
<div class="ulist">
<ul>
<li>
<p>Static Analysis</p>
</li>
<li>
<p>Static Source Code Analysis</p>
</li>
<li>
<p>Static Byte Code Analysis</p>
</li>
<li>
<p>Static Binary Code Analysis</p>
</li>
<li>
<p>Dynamic Binary Analysis.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Maintenance following implementation</p>
<div class="ulist">
<ul>
<li>
<p>Using threat intelligence as well as monitoring and mitigation when vulnerabilities are discovered</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="threats_from_potentially_harmful_applications">Threats from Potentially Harmful Applications</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Gather Privacy-Sensitive Information</p>
</li>
<li>
<p>Surreptitious Eavesdropping</p>
</li>
<li>
<p>Exploiting Vulnerabilities</p>
</li>
<li>
<p>Exploiting Access to Sensitive Enterprise Networks or Data</p>
</li>
<li>
<p>Ransomware</p>
</li>
<li>
<p>Enabling Other Types of Fraud or Malicious Practices</p>
</li>
<li>
<p>Exploiting Public Mobile Application Stores</p>
</li>
<li>
<p>Attempting to Root/Jailbreak a Mobile Device</p>
</li>
<li>
<p>Manipulation of Trusted Apps.</p>
</li>
<li>
<p>Sharing of Data Between Trusted Apps.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>Best Practices</p>
</li>
<li>
<p>App Vetting</p>
</li>
<li>
<p>Isolation Technologies</p>
</li>
<li>
<p>Out-of-Band Authentication</p>
</li>
<li>
<p>Continuous Authentication</p>
</li>
<li>
<p>Mobile Device Management/Enterprise Mobility Management</p>
</li>
<li>
<p>On-Device, Third-Party Security Applications.</p>
</li>
<li>
<p>Network Monitoring.</p>
</li>
<li>
<p>App Store Mitigations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="defense_gaps_2">Defense Gaps</h6>
<div class="ulist">
<ul>
<li>
<p>Fragmented toolsets</p>
</li>
<li>
<p>Poorly defined set of best practices and security Systems Development Life Cycle for developers—especially for Government use.</p>
</li>
<li>
<p>Lack of focus on mobile application vulnerabilities within the CVE process</p>
</li>
<li>
<p>Lack of robust information sharing of threat intelligence and integration with security tools and techniques</p>
</li>
<li>
<p>Timely notification to organizations and developers of apps affected by a vulnerability</p>
</li>
<li>
<p>Limited visibility and adoption of application-vetting criteria</p>
</li>
<li>
<p>Lack of formalized standards relating security controls to data security categorization</p>
</li>
<li>
<p>Limited knowledge of the comparison between various app vetting tools</p>
</li>
<li>
<p>Lack of enterprise view into the user community and mobile landscape baseline</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="threats_in_mobile_networks">Threats in Mobile Networks</h5>
<div class="sect5">
<h6 id="key_components_in_mobile_networks">Key Components in Mobile Networks</h6>
<div class="ulist">
<ul>
<li>
<p>the Radio Access Network (RAN)</p>
<div class="ulist">
<ul>
<li>
<p>Part of the mobile network that connects mobile subscribers to their service provider network using Radio Frequency (RF) signaling over an “air interface,” i.e., wirelessly.</p>
</li>
<li>
<p>Includes tower antennas, RF transceivers and RF controllers.</p>
</li>
<li>
<p>Part of the service is typically encrypted, although the level of encryption varies from network type to network type and by decisions the carrier makes in implementing this capability.</p>
</li>
</ul>
</div>
</li>
<li>
<p>the Core Network (CN)</p>
<div class="ulist">
<ul>
<li>
<p>Is always out of band; the cellular mobile device has no access to it and it runs on different channels.</p>
</li>
<li>
<p>The data between the RAN and the operator’s core network is handled by the backhaul network</p>
</li>
<li>
<p>Holds network logic and is responsible for creating and maintaining the connection between cellular mobile devices and external service networks (e.g., Internet, wireline phones, other carriers and private enterprises) as well as physically tracking all user equipment at all times to enable routing of calls and data streams as users and their devices move throughout the landscape.</p>
</li>
</ul>
</div>
</li>
<li>
<p>External Services</p>
<div class="ulist">
<ul>
<li>
<p>Contain additional end-user services</p>
</li>
<li>
<p>May or may not be provided by the mobile network operator</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="sim_card">SIM Card</h6>
<div class="paragraph">
<p>Communicates directly with the carrier’s core network to authenticate itself, the user, and the user’s services and service level.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Obtaining Cryptographic Keys</p>
</li>
<li>
<p>SIM Theft</p>
</li>
<li>
<p>SIM Cloning</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>anti-fraud systems deployed by the carrier</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="radio_access_networks">Radio Access Networks</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Denial of Service/Jamming</p>
</li>
<li>
<p>Physical Attacks on Base Station Infrastructure.</p>
</li>
<li>
<p>Long Term Evolution (LTE)</p>
<div class="ulist">
<ul>
<li>
<p>Downgrade Attacks</p>
</li>
<li>
<p>Eavesdropping.</p>
</li>
<li>
<p>Device and Identity Tracking</p>
</li>
<li>
<p>Preventing Emergency Phone Calls</p>
</li>
<li>
<p>Network Level Denial of Service (DoS) Attacks</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="backhaul_networks">Backhaul Networks</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Backhaul Eavesdropping</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="core_networks">Core Networks</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Signaling System 7 (SS7)</p>
<div class="ulist">
<ul>
<li>
<p>Is the historic control plane for mobile networks</p>
</li>
<li>
<p>Significant weaknesses in SS7 have been known for more than a decade: The problem with the current SS7 system is that messages can be altered, injected or deleted into the global SS7 networks in an uncontrolled manner</p>
</li>
<li>
<p>It has been supplanted by the Diameter Protocol. Most networks use both protocols and it is common for SS7 messages to be “translated” into their Diameter equivalent</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="defenses">Defenses</h6>
<div class="ulist">
<ul>
<li>
<p>Are complex and must be implemented at many layers</p>
</li>
<li>
<p>Threats of illegal eavesdropping, data manipulation, and data theft can be mitigated to a degree with secure storage on endpoints and use of encryption for communications in transit</p>
</li>
<li>
<p>Mobile application developers should be encouraged to use the network security features provided by the Android and iOS operating systems to protect the network traffic of their applications against interception or manipulation</p>
</li>
<li>
<p>VPNs can be used to route all network traffic through an encrypted tunnel between the cellular mobile device and an enterprise-controlled network</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="gaps">Gaps</h6>
<div class="ulist">
<ul>
<li>
<p>Each network component of carrier infrastructure needs specific protection mechanisms</p>
</li>
<li>
<p>Limited or no ability to protect against geolocation of mobile devices and their users</p>
</li>
<li>
<p>The only reliable mitigation against DoS attacks on cellular towers, regions or service providers is alternate communication methods for emergencies</p>
</li>
<li>
<p>Inability to determine whether U.S. carriers have implemented GSMA Interconnect Security Monitoring Guidelines for protection against SS7 attacks.</p>
</li>
<li>
<p>SS7 attack types can be used to target key U.S. Federal Government personnel both in the United States and traveling or working overseas.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="device_physical_access">Device Physical Access</h5>
<div class="sect5">
<h6 id="threats">Threats</h6>
<div class="ulist">
<ul>
<li>
<p>Stolen or lost devices</p>
</li>
<li>
<p>PC or charging station could potentially abuse USB to attempt to exploit vulnerabilities on the mobile device or to steal sensitive data</p>
</li>
<li>
<p>The USB communication channel could potentially be abused in the reverse direction, enabling a compromised mobile device to launch attacks against the host device to which it is connected</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="defenses_2">Defenses</h6>
<div class="ulist">
<ul>
<li>
<p>Ensure that mobile devices always have a screen lock PIN or password.</p>
</li>
<li>
<p>Enterprise capabilities should be put in place to remotely track and—when necessary—remotely wipe mobile devices.</p>
</li>
<li>
<p>Users should be advised not to plug mobile devices directly into public USB charging ports unless a charge-only adapter or cable is used.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="gaps_2">Gaps</h6>
<div class="ulist">
<ul>
<li>
<p>There is still more work to be done to encourage users to use screen lock on their devices</p>
</li>
<li>
<p>More work is needed to defend against attacks in the opposite direction: from a mobile device to a PC</p>
</li>
<li>
<p>Existing strong authentication solutions are not designed to complement the mobile form factor</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mobile_enterprise">Mobile Enterprise</h5>
<div class="paragraph">
<p>The mobile enterprise consists of systems, applications, processes, and people that work together to control, manage, and integrate the use of mobile devices and related technologies into business and mission operations.</p>
</div>
<div class="sect5">
<h6 id="enterprise_mobility_management">Enterprise Mobility Management</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Unauthorized access to EMM administrative console</p>
</li>
<li>
<p>Impersonation of EMM server</p>
</li>
<li>
<p>Bypass or subvert EMM agent on mobile device</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>Enterprise security audit</p>
</li>
<li>
<p>Mobile device security audit</p>
</li>
<li>
<p>Threat intelligence</p>
</li>
<li>
<p>Granular authorization</p>
</li>
<li>
<p>Identification and Authentication</p>
</li>
<li>
<p>Secure network connections</p>
</li>
<li>
<p>Trusted Execution Environment</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="enterprise_mobile_application_stores">Enterprise Mobile Application Stores</h6>
<div class="ulist">
<ul>
<li>
<p>Threats</p>
<div class="ulist">
<ul>
<li>
<p>Impersonation or unauthorized use of administrator credentials, app developer credentials, or distribution certificates.</p>
</li>
<li>
<p>Bypass or subvert application security analysis or vetting techniques.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defenses</p>
<div class="ulist">
<ul>
<li>
<p>Enterprise security audit</p>
</li>
<li>
<p>Mobile device security audit</p>
</li>
<li>
<p>Threat intelligence</p>
</li>
<li>
<p>Granular authorization</p>
</li>
<li>
<p>Identification and Authentication</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="gaps_3">Gaps</h6>
<div class="ulist">
<ul>
<li>
<p>Limited ability of enterprise mobility products to detect sophisticated attacks against mobile devices</p>
</li>
<li>
<p>Limited ability of EMM solutions to identify vulnerable mobile devices.</p>
</li>
<li>
<p>Most EMMs lack the ability to directly update the mobile OS</p>
</li>
<li>
<p>More work is needed to encourage enterprise adoption of capabilities to ensure enterprise-owned mobile devices are kept under enterprise management control</p>
</li>
<li>
<p>Lack of guidance on how to integrate EMM solutions with other enterprise security systems to enable effective response and recovery capabilities to compromised or out-ofcompliance mobile devices</p>
</li>
<li>
<p>Improvements in integration of EMM solutions with mobile threat intelligence services</p>
</li>
<li>
<p>Immature vulnerability management processes for mobile OS and mobile apps</p>
</li>
<li>
<p>Stronger mechanisms for data security and data authorization decisions need to be developed</p>
</li>
<li>
<p>The lack of standards for interfacing with TEE has limited use of the technology</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="emerging_threats">Emerging Threats</h5>
<div class="ulist">
<ul>
<li>
<p>Open Source Signals Intelligence</p>
<div class="ulist">
<ul>
<li>
<p>Unfortunately, much of the software and protocols used in RF devices are insecure</p>
</li>
<li>
<p>Now an increasing number of people who have the skills, time, tools and techniques to attack mobile devices and the underlying networks on which they depend</p>
</li>
</ul>
</div>
</li>
<li>
<p>Decryption of 3G/UMTS Cellular Network Traffic</p>
<div class="ulist">
<ul>
<li>
<p>Although 3GPP and GSMA have deprecated some security authentication and encryption standards in the past,advances in deploying replacement systems may not be keeping pace with attacks on the systems currently in use and currently no deprecation schedule is in place if the UMTS (3G) UEA1/UIA1 security algorithms fall.</p>
</li>
<li>
<p>The rise of crypto currencies has fueled a market in high-speed encryption systems. These are now widely available and pose a considerable risk to mobile device privacy and security</p>
</li>
</ul>
</div>
</li>
<li>
<p>“IMSI Catchers” and Passive Cellular Interceptors.</p>
<div class="ulist">
<ul>
<li>
<p>They allow hackers, criminals, and spies to track cell phone users and monitor or record conversations and text messages.</p>
</li>
<li>
<p>Passive cellular interceptors are difficult to detect since they only listen</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cybercrime and Fraud</p>
<div class="ulist">
<ul>
<li>
<p>Because the global mobile ecosystem is so large and so much money exchanges hands, criminals will continue to target it</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jamming</p>
<div class="ulist">
<ul>
<li>
<p>Cell phone jammers are widely available for purchase on the Internet including plans and kits and are even listed by range to show how jammers can deny service across large service areas</p>
</li>
<li>
<p>Can be used to cause cell phones to move off 3G and 4G networks and on to 2G networks where interception and decryption is much easier</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="a_framework_for_modeling_mobile_threats">A Framework for Modeling Mobile Threats</h5>
<div class="sect5">
<h6 id="seven_stage_cyber_attack_lifecycle">Seven-stage Cyber Attack Lifecycle</h6>
<div class="ulist">
<ul>
<li>
<p>Recon</p>
</li>
<li>
<p>Weaponize</p>
</li>
<li>
<p>Deliver</p>
</li>
<li>
<p>Exploit</p>
</li>
<li>
<p>Control</p>
</li>
<li>
<p>Execute</p>
</li>
<li>
<p>Maintain</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="new_or_updated_policy_standards_and_best_practices">New or Updated Policy, Standards, and Best Practices</h5>
<div class="sect5">
<h6 id="mobile_applications">Mobile Applications</h6>
<div class="ulist">
<ul>
<li>
<p>There is a need to create security guidelines for mobile application development.</p>
</li>
<li>
<p>Developer-focused guidance that communicates best practices on how to securely code, package and release applications is still lacking.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guidelines_for_managing_the_security_of_mobile_devices_in_the_enterprise">2.15. Guidelines for Managing the Security of Mobile Devices in the Enterprise</h3>
<div class="paragraph">
<p>This is a summary of notes taken from the <a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-124r1.pdf">NIST Guidelines for Managing the Security of Mobile Devices in the Enterprise</a>.</p>
</div>
<div class="sect3">
<h4 id="high_level_threats_and_vulnerabilities_for_mobile_devices">2.15.1. High-Level Threats and Vulnerabilities for Mobile Devices</h4>
<div class="sect4">
<h5 id="lack_of_physical_security_controls">Lack of Physical Security Controls</h5>
<div class="sect5">
<h6 id="mitigations">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Requiring authentication before gaining access to the mobile device or the organization’s resources accessible through the device.</p>
</li>
<li>
<p>Protecting sensitive data—either encrypting the mobile device’s storage so that sensitive data cannot be recovered from it by unauthorized parties, or not storing sensitive data on mobile devices.</p>
</li>
<li>
<p>User training and awareness, to reduce the frequency of insecure physical security practices.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use_of_untrusted_mobile_devices">Use of Untrusted Mobile Devices</h5>
<div class="sect5">
<h6 id="mitigations_2">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Restrict or prohibit use of BYOD devices, thus favoring organization-issued devices</p>
</li>
<li>
<p>Fully secure each organization-issued mobile device; this gets the mobile device in as trusted a state as possible, and deviations from this secure state can be monitored and addressed.</p>
</li>
<li>
<p>Use other technical solutions for achieving degrees of trust in BYOD devices</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use_of_untrusted_networks">Use of Untrusted Networks</h5>
<div class="sect5">
<h6 id="mitigations_3">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Using strong encryption technologies (such as virtual private networks, VPNs) to protect the confidentiality and integrity of communications</p>
</li>
<li>
<p>Using mutual authentication mechanisms to verify the identities of both endpoints before transmitting data</p>
</li>
<li>
<p>Prohibit use of insecure Wi-Fi networks</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use_of_untrusted_applications">Use of Untrusted Applications</h5>
<div class="sect5">
<h6 id="mitigations_4">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Prohibiting all installation of thirdparty applications, or implementing whitelisting to allow installation of approved applications only.</p>
</li>
<li>
<p>Perform a risk assessment on each third-party application before permitting its use on the organization’s mobile devices</p>
</li>
<li>
<p>Prohibiting or restricting browser access</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="interaction_with_other_systems">Interaction with Other Systems</h5>
<div class="sect5">
<h6 id="mitigations_5">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Preventing an organization-issued mobile device from syncing with a personally-owned computer necessitates security controls on the mobile device that restrict what devices it can synchronize with</p>
</li>
<li>
<p>Preventing a personally-owned mobile device from syncing with an organization-issued computer necessitates security controls on the organizationissued computer, restricting the connection of mobile devices</p>
</li>
<li>
<p>Preventing the use of remote backup services can possibly be achieved by blocking use of those services or by configuring the mobile devices not to use such services</p>
</li>
<li>
<p>Users should be instructed not to connect their mobile devices to unknown charging devices; they should carry and use their own charging devices</p>
</li>
<li>
<p>Mobile devices can be prevented from exchanging data with each other through logical or physical means</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use_of_untrusted_content">Use of Untrusted Content</h5>
<div class="sect5">
<h6 id="mitigations_6">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Educate users on the risks inherent in untrusted content and to discourage users from accessing untrusted content with any mobile devices they use for work</p>
</li>
<li>
<p>Have applications, such as QR readers, display the unobfuscated content (e.g., the URL) and allow users to accept or reject it before proceeding</p>
</li>
<li>
<p>Use secure web gateways, HTTP proxy servers, or other intermediate devices to validate URLs before allowing them to be contacted.</p>
</li>
<li>
<p>It is also possible to restrict peripheral use on mobile devices, such as disabling camera use in order to prevent QR codes from being processed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use_of_location_services">Use of Location Services</h5>
<div class="sect5">
<h6 id="mitigations_7">Mitigations</h6>
<div class="ulist">
<ul>
<li>
<p>Disabling location services or by prohibiting use of location services for particular applications such as social networking or photo applications.</p>
</li>
<li>
<p>Users may also be trained to turn off location services when in sensitive areas</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="technologies_for_mobile_device_management">2.15.2. Technologies for Mobile Device Management</h4>
<div class="paragraph">
<p>The MDM system should have the following capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>General policy</p>
<div class="ulist">
<ul>
<li>
<p>Restrict user and application access to hardware</p>
</li>
<li>
<p>Restrict user and application access to native OS services</p>
</li>
<li>
<p>Manage wireless network interfaces</p>
</li>
<li>
<p>Automatically monitor, detect, and report when policy violations occur</p>
</li>
<li>
<p>Limit or prevent access to enterprise services based on the mobile device’s operating system version</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Communication and Storage</p>
<div class="ulist">
<ul>
<li>
<p>Strongly encrypt data communications between the mobile device and the organization.</p>
</li>
<li>
<p>Strongly encrypt stored data on both built-in storage and removable media storage.</p>
</li>
<li>
<p>Wipe the device (to scrub its stored data) before reissuing it to another user, retiring the device, etc.</p>
</li>
<li>
<p>Remotely wipe the device (to scrub its stored data) if it is suspected that the device has been lost, stolen, or otherwise fallen into untrusted hands and is at risk of having its data recovered by an untrusted party.</p>
</li>
<li>
<p>A device often can also be configured to wipe itself after a certain number of incorrect authentication attempts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>User and Device Authentication</p>
<div class="ulist">
<ul>
<li>
<p>Require a device password/passcode and/or other authentication (e.g., token-based authentication, network-based device authentication, domain authentication) before accessing the organization’s resources.</p>
</li>
<li>
<p>If device account lockout is enabled or the device password/passcode is forgotten, an administrator can reset this remotely to restore access to the device.</p>
</li>
<li>
<p>Have the device automatically lock itself after it is idle for a period</p>
</li>
<li>
<p>Under the direction of an administrator, remotely lock the device if it is suspected that the device has been left in an unlocked state in an unsecured location</p>
</li>
</ul>
</div>
</li>
<li>
<p>Applications</p>
<div class="ulist">
<ul>
<li>
<p>Restrict which app stores may be used.</p>
</li>
<li>
<p>Restrict which applications may be installed through whitelisting (preferable) or blacklisting.</p>
</li>
<li>
<p>Restrict the permissions (e.g., camera access, location access) assigned to each application.</p>
</li>
<li>
<p>Install, update, and remove applications.</p>
</li>
<li>
<p>Restrict the use of operating system and application synchronization services (e.g., local device synchronization, remote synchronization services and websites).</p>
</li>
<li>
<p>Verify digital signatures on applications to ensure that only applications from trusted entities are installed on the device and that code has not been modified.</p>
</li>
<li>
<p>Distribute the organization’s applications from a dedicated mobile application store</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mobile_banking_applications_security_challenges">2.16. Mobile Banking Applications Security Challenges</h3>
<div class="paragraph">
<p>This is a summary of the <a href="http://info.nowsecure.com/rs/201-XEW-873/images/NowSecure-Accenture-Mobile-Banking-Apps-Security-Challenges.pdf?utm_source=mkto&amp;utm_medium=email&amp;utm_campaign=Mobile+Bank+Apps+Security+Challenges&amp;utm_content=Delivery+Email&amp;mkt_tok=eyJpIjoiWmpRMk16UTNNRGhoTjJJMiIsInQiOiJBcmZGXC9TXC8rTUJya0tZNlNxd21TdDk2K3pSK1JHelg2M1ZcL09vUm9cL2NvZmMrK01hQktMeDl4K21LV3NSWnEyZXM3YU0wUFYyTjd1Rng4dVZcL0NWQU5laWNqTlZ6eGlSU3NzVjZJZDM1WmhzN2RvVTdadE9HT082c2ZLSkxQckxhIn0%3D">Mobile Banking Applications Security Challenges</a> report.</p>
</div>
<div class="sect3">
<h4 id="vulnerabilities_11">2.16.1. Vulnerabilities</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>World-Writable Files</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Creating worldwritable files is a security risk as it could allow other apps to have write access to files, leading to potential security gaps</p>
</li>
</ol>
</div>
</li>
<li>
<p>Broken SSL Check / Sensitive Data in Transit</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lack of proper certificate validation could result in sensitive data being intercepted via a man-in-the-middle attack. Especially on Android.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Writable Executables</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A writable executable file is not a vulnerability all by itself, but in combination with another issue could lead to additional app vulnerabilities and make the app susceptible to remote code execution. Android only.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Obfuscation</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Intellectual property could be at risk because these apps can easily be reverse-engineered</p>
</li>
</ol>
</div>
</li>
<li>
<p>SecureRandom</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Apps which use the Oracle® Java Cryptography Architecture (JCA) for key generation, signing, or random number generation may not receive cryptographically strong values on Android™ devices due to improper initialization of the pseudo-random number generator (PRNG).</p>
</li>
<li>
<p>Apps that directly invoke the system-provided OpenSSL PRNG without explicit initialization on Android™ are also affected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Dynamic Code Loading</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Typically, core components and additional dependencies are loaded natively at runtime, however, dynamically loaded components are only loaded as requested</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cookie "HttpOnly"</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>When a cookie is set with the HTTPOnly flag, it instructs the browser that the cookie can only be accessed by the server and not by client-side scripts.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cookie "Secure" Tag</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>When set to true, the "secure" flag tells the browser to only send the cookie if the request is sent using a secure channel.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Transport Layer Security Traffic with Sensitive Data</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Sending sensitive data without certificate pinning creates higher risk as an attacker with network privileges, or who has compromised TLS, is better positioned to intercept data</p>
</li>
</ol>
</div>
</li>
<li>
<p>App Transport Security</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It is on by default when an app is linked to iOS® 9.0 SDK (Software Development Kit) or later.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="secure_mobile_development_guide">2.17. Secure Mobile Development Guide</h3>
<div class="paragraph">
<p>This is a summary of <a href="https://books.nowsecure.com/secure-mobile-development/en/">Secure Mobile Development Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="coding_practices">2.17.1. CODING PRACTICES</h4>
<div class="sect4">
<h5 id="increase_code_complexity_and_use_obfuscation">Increase Code Complexity and Use Obfuscation</h5>
<div class="ulist">
<ul>
<li>
<p>Restricting debuggers</p>
<div class="ulist">
<ul>
<li>
<p>Android applications should have <code>android:debuggable=”false”</code> set in the application manifest to prevent easy runtime manipulation by an attacker or malware.</p>
</li>
<li>
<p>On iOS you can make use of the <code>PT_DENY_ATTACH</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Trace Checking</p>
<div class="ulist">
<ul>
<li>
<p>Debugger tracing can be detected by checking the process status flags or using other techniques like comparing the return value of <code>ptrace attach</code>, checking the parent process, blacklisting debuggers in the process list or comparing timestamps on different parts of the program</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optimizations</p>
<div class="ulist">
<ul>
<li>
<p>In Android this can be achieved more easily by utilizing natively compiled libraries with the native development kit (NDK). In addition, using an LLVM Obfuscator or any protector SDK will provide better machine code obfuscation</p>
</li>
</ul>
</div>
</li>
<li>
<p>Stripping binaries</p>
<div class="ulist">
<ul>
<li>
<p>Stripping binaries does not discard the Objective-C class or object-mapping data on iOS.</p>
</li>
<li>
<p>On Android you can reuse techniques used on GNU/Linux systems like sstriping or using UPX</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_simple_logic">Avoid Simple Logic</h5>
<div class="ulist">
<ul>
<li>
<p>Consider a better programming paradigm, where privileges are enforced by the server when the session is not trusted, or by preventing certain data from being decrypted or otherwise available until the application can determine that the session is trusted using challenge/response, OTP, or other forms of authentication</p>
</li>
<li>
<p>it is recommended to declare all sanity check functions static inline.</p>
</li>
<li>
<p>more sophisticated approaches founded in secure coding principles may be worth further investigation.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="test_third_party_libraries">Test Third-Party Libraries</h5>
<div class="ulist">
<ul>
<li>
<p>Security auditing must thoroughly test third-party libraries and functionality as well</p>
</li>
<li>
<p>Upgrading to a new version of a third-party library (or OS version) should be treated as version of your app</p>
</li>
<li>
<p>On iOS, statically compile third-party libraries to avoid LD_PRELOAD attacks</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_anti_tamper_techniques">Implement Anti-tamper Techniques</h5>
<div class="ulist">
<ul>
<li>
<p>Use checksums, digital signatures and other validation mechanisms to help detect file tampering.</p>
</li>
<li>
<p><a href="https://gist.github.com/scottyab/b849701972d57cf9562e">Android Sample</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="securely_store_sensitive_data_in_ram">Securely Store Sensitive Data in RAM</h5>
<div class="ulist">
<ul>
<li>
<p>Nullify any variables that hold keys after use</p>
</li>
<li>
<p>Avoid using immutable objects for sensitive keys or passwords such as in Android java.lang.String and use char array instead.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="understand_secure_deletion_of_data">Understand Secure Deletion of Data</h5>
<div class="ulist">
<ul>
<li>
<p>Operate under the assumption that any data written to a device can be recovered</p>
</li>
<li>
<p>Wherever possible, avoid storing sensitive data on the device</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_query_string_for_sensitive_data">Avoid Query String for Sensitive Data</h5>
<div class="ulist">
<ul>
<li>
<p>Use secure POST to send user data, with XSRF token protection.</p>
</li>
<li>
<p>Encrypting data using a non-zero initialization vector and temporary session keys can also help prevent a replay attack.</p>
</li>
<li>
<p>query string data can be encrypted using a temporary session key negotiated between hosts using secure algorithms, such as Diffie-Hellman</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="handling_sensitive_data">2.17.2. HANDLING SENSITIVE DATA</h4>
<div class="sect4">
<h5 id="implement_secure_data_storage">Implement Secure Data Storage</h5>
<div class="ulist">
<ul>
<li>
<p>Add an additional layer of verified, third-party encryption (e.g., SQLCipher) to the data as device encryption is not sufficient</p>
</li>
<li>
<p>Android</p>
<div class="ulist">
<ul>
<li>
<p>using the standard cryptographic provider “AES” will often default to the less secure AES-ECB. Best practice is to specify AES-CBC or AES-GCM with a 256-bit key and a random IV generated by SecureRandom.</p>
</li>
<li>
<p>You should also derive the key from a passphrase using the well tested PBKDF2 (Password-Based Key Derivation Function)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="use_secure_setting_for_cookies">Use SECURE Setting For Cookies</h5>
<div class="ulist">
<ul>
<li>
<p>The Set-Cookie headers should use the “Secure” and “HTTPOnly” settings.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="fully_validate_ssl_tls">Fully Validate SSL/TLS</h5>
<div class="ulist">
<ul>
<li>
<p>use certificate pinning to protect against MITM attacks</p>
</li>
<li>
<p>If certificate pinning cannot be implemented for any app functionality that handles highly sensitive data, implement proper certificate validation</p>
<div class="ulist">
<ul>
<li>
<p>Certificate validation: Certificates presented to the app must be fully validated by the app and be signed by a trusted root CA</p>
</li>
<li>
<p>Hostname validation: The app must check and verify that the hostname (Common Name or CN) extracted from the certificate matches that of the host with which the app intends to communicate</p>
</li>
</ul>
</div>
</li>
<li>
<p>Android</p>
<div class="ulist">
<ul>
<li>
<p>Android 7.0 will only trust a preselected list of certificate authorities (CAs) maintained by the Android Open Source Project and will not trust custom CAs or CAs added by a user</p>
</li>
<li>
<p>Developers can also use the <a href="https://developer.android.com/training/articles/security-config.html">Network Security Configuration file</a> for certificate pinning</p>
</li>
<li>
<p><a href="https://github.com/commonsguy/cwac-netsecurity">CWAC-NetSecurity</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>iOS</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/datatheorem/TrustKit">TrustKit</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protect_against_ssl_downgrade_attacks">Protect Against SSL Downgrade Attacks</h5>
<div class="ulist">
<ul>
<li>
<p>Serve all traffic, even non-sensitive traffic,over TLS</p>
</li>
<li>
<p>Validate that SSL/TLS is active</p>
</li>
<li>
<p>Android recently added <code>android:usesCleartextTraffic</code></p>
</li>
<li>
<p>iOS 9 and above require that you manually add exceptions for plaintext traffic.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="limit_use_of_uuid">Limit Use of UUID</h5>
<div class="ulist">
<ul>
<li>
<p>avoid using any device-provided identifier to identify the device, especially if it&#8217;s integral to an implementation of device authentication.</p>
</li>
<li>
<p>recommend the creation of an app-unique "device factor" at the time of registration, installation, or first execution.</p>
</li>
<li>
<p>Apple recommends using the advertisingIdentifier - a unique identifier shared across all apps in the system.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="treat_geolocation_data_carefully">Treat Geolocation Data Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>avoid storing GPS data</p>
</li>
<li>
<p>Unless required, do not log or store GPS information.</p>
</li>
<li>
<p>Cameras often geo-tags images. If this is a concern, make sure to strip the EXIF data from the image</p>
</li>
<li>
<p>Do not activate GPS in applications that will run at or near secure locations, whose coordinates or wireless network topology should not be reported back to vendors.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="institute_local_session_timeout">Institute Local Session Timeout</h5>
<div class="ulist">
<ul>
<li>
<p>Any time the app is not used for more than 5 minutes, terminate the active session, redirect the user to the log-in screen, ensure that no app data is visible, and require the user to re-enter log-in credentials to access the app</p>
</li>
<li>
<p>After timeout, also discard and clear all memory associated with user data including any master keys use to decrypt that data</p>
</li>
<li>
<p>Also, make sure the session timeout occurs on both the client side and the server side</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_enhanced_two_factor_authentication">Implement Enhanced / Two-Factor Authentication</h5>
<div class="ulist">
<ul>
<li>
<p>When sensitive data or transactions are involved, implement two-factor authentication</p>
</li>
<li>
<p>may not be feasible every time a user logs in but can be used at intervals or when accessing selected functions</p>
</li>
<li>
<p>Consider step-up authentication methods to provide normal access to non-transactional areas but require a second layer of authentication for sensitive functions</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protect_application_settings">Protect Application Settings</h5>
<div class="ulist">
<ul>
<li>
<p>Compile settings into the code when possible</p>
</li>
<li>
<p>Don’t store any critical settings in dictionaries or other files unless encrypted first</p>
</li>
<li>
<p>Ideally, encrypt all configuration files using a master key encrypted with a passphrase that is supplied by the user, or with a key provided remotely when a user logs into a system</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hide_account_numbers_and_use_tokens">Hide Account Numbers and Use Tokens</h5>
<div class="ulist">
<ul>
<li>
<p>displaying partial numbers</p>
</li>
<li>
<p>store the partially hidden numbers</p>
</li>
<li>
<p>instead of account numbers, tokens be assigned to each account and provided to the client</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_secure_network_transmission_of_sensitive_data">Implement Secure Network Transmission Of Sensitive Data</h5>
<div class="ulist">
<ul>
<li>
<p>Use SSL/TLS either with standard trust validation, or, for increased security, implement certificate pinning</p>
</li>
<li>
<p>For highly sensitive values, implement additional encryption in transit</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="validate_input_from_client">Validate Input From Client</h5>
<div class="ulist">
<ul>
<li>
<p>all input from the client should be must be treated as untrusted.</p>
</li>
<li>
<p>Services must thoroughly filter and validate input from the app and user.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_storing_app_data_in_backups">Avoid Storing App Data in Backups</h5>
<div class="ulist">
<ul>
<li>
<p>Android</p>
<div class="ulist">
<ul>
<li>
<p>By default, the <code>allowBackup</code> flag within an Android app’s Manifest file is set as <code>true</code>. Therefore, explicitly declare the <code>allowBackup</code> flag as <code>false</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>iOS</p>
<div class="ulist">
<ul>
<li>
<p>avoid storing any sensitive data in plaintext within any of the files or folders within the app’s private directory or subdirectories</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="caching_and_logging">2.17.3. CACHING AND LOGGING</h4>
<div class="sect4">
<h5 id="avoid_caching_app_data">Avoid Caching App Data</h5>
<div class="ulist">
<ul>
<li>
<p>Prevent HTTP caching</p>
</li>
<li>
<p>avoid caching of URL history and page data for any Web process such as registration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_crash_logs">Avoid Crash Logs</h5>
<div class="ulist">
<ul>
<li>
<p>Ensure released apps are built without warnings and are thoroughly tested to avoid crashes.</p>
</li>
<li>
<p>Consider disabling NSAssert for iOS</p>
</li>
<li>
<p>avoid sending crash logs over the network in plaintext</p>
</li>
<li>
<p>Use secure development tools like clang-analyzer, coverity, ASAN and other linting utilities in order to identify all possible operations that can make the app crash</p>
</li>
<li>
<p>If the app is obfuscated and stripped, the developer will need keep an address-to-symbol database in order to recover meaningful backtraces in crashlogs</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="limit_caching_of_username">Limit Caching of Username</h5>
<div class="ulist">
<ul>
<li>
<p>store a masked username instead of the actual username, and replace the username value in authentication with a hash value</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="carefully_manage_debug_logs">Carefully Manage Debug Logs</h5>
<div class="ulist">
<ul>
<li>
<p>REMOVE METHOD CALLS TO THE LOG CLASS IN RELEASE BUILDS</p>
</li>
<li>
<p>SET THE “ANDROID:DEBUGGABLE” FLAG TO “FALSE” IN PRODUCTION BUILDS</p>
</li>
<li>
<p>On iOS disabling the NSLog statements on will remove potentially sensitive information which can be intercepted and as an added benefit may slightly increase the performance of the app.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="be_aware_of_the_keyboard_cache">Be Aware of the Keyboard Cache</h5>
<div class="ulist">
<ul>
<li>
<p>Disable the auto-correct feature for any sensitive information, not just for password fields.</p>
</li>
<li>
<p>Add an enterprise policy to clear the keyboard dictionary at regular intervals.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="be_aware_of_copy_and_paste">Be Aware of Copy and Paste</h5>
<div class="ulist">
<ul>
<li>
<p>Where appropriate, disable copy/paste for areas handling sensitive data</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webviews">2.17.4. WEBVIEWS</h4>
<div class="sect4">
<h5 id="prevent_framing_and_clickjacking">Prevent Framing and Clickjacking</h5>
<div class="ulist">
<ul>
<li>
<p>Use <code>X-FRAME-OPTIONS</code> HEADER</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Header add X-FRAME-OPTIONS "DENY"</code></pre>
</div>
</div>
</li>
<li>
<p>Basic frame busting javascript</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>if( self != top ) {
  top.location = self.location ;
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protect_against_csrf_with_form_tokens">Protect Against CSRF with Form Tokens</h5>
<div class="ulist">
<ul>
<li>
<p>Each form submission should contain a token which was loaded with the form or at the beginning of a user session. Check this token on the server when receiving POST requests to ensure the user originated it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ios">2.17.5. IOS</h4>
<div class="sect4">
<h5 id="use_the_keychain_carefully">Use the Keychain Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>When storing data in the keychain, use the most restrictive protection class (as defined by the kSecAttrAccessible attribute) that still allows your application to function properly</p>
</li>
<li>
<p>To prevent the exposure of keychain items via iTunes backup, use the ThisDeviceOnly protection class where practical</p>
</li>
<li>
<p>Finally, for highly sensitive data, consider augmenting protections offered by the keychain with application-level encryption.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_cached_application_snapshots">Avoid Cached Application Snapshots</h5>
<div class="ulist">
<ul>
<li>
<p>To protect sensitive data, block caching of application snapshots using API configuration or code</p>
</li>
<li>
<p>When applicationDidEnterBackground: method returns, the snapshot of the application user interface is taken, and it’s used for transition animations and stored in the filesystem.
This method should be overridden and all the sensitive information in the user interface should be removed before it returns.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_protections_against_buffer_overflow_attacks">Implement Protections Against Buffer Overflow Attacks</h5>
<div class="ulist">
<ul>
<li>
<p>Enable ARC</p>
</li>
<li>
<p>Implement full ASLR protection</p>
<div class="ulist">
<ul>
<li>
<p>can be enabled when compiling by command line with option <code>-PIE</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Implement stack-smashing protection</p>
<div class="ulist">
<ul>
<li>
<p>Compile the application with the <code>-fstack-protector-all</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_caching_http_s_requests_responses">Avoid Caching HTTP(S) Requests/Responses</h5>
<div class="ulist">
<ul>
<li>
<p>set the <code>cachePolicy</code> property of the NSURLRequest to disable the caching of HTTP(S) requests and responses</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_app_transport_security_ats">Implement App Transport Security (ATS)</h5>
<div class="ulist">
<ul>
<li>
<p>Enable ATS globally by linking to the iOS 9.0 or later SDK and NOT setting the NSAllowsArbitraryLoads key to Yes or True</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_touch_id_properly">Implement Touch ID Properly</h5>
<div class="ulist">
<ul>
<li>
<p>When using Touch ID for authentication, store the app’s secret in the Keychain with an ACL assigned to that item.</p>
</li>
<li>
<p>Developers can use Touch ID enrollment changes to detect and prevent a physically proximate attacker from enrolling their own fingerprint in order to gain access to protected Keychain items.</p>
<div class="ulist">
<ul>
<li>
<p>read <code>LAContext.evaluatedPolicyDomainState</code> to check whether the <code>evaluatedPolicyDomainState</code> value has changed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="android">2.17.6. Android</h4>
<div class="sect4">
<h5 id="implement_file_permissions_carefully">Implement File Permissions Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>Do not create files with permissions of MODEWORLD_READABLE or MODE_WORLD_WRITABLE unless it is required as any app would be able to read or write the file even though it may be stored in the app’s private data directory</p>
</li>
<li>
<p>Do not use modes such as 0666, 0777, and 0664 with the chmod binary or syscalls accepting a file mode</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_intents_carefully">Implement Intents Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>Components accessed via Intents can be public or private. it is easy to mistakenly allow the component to be or become public.</p>
</li>
<li>
<p>If a component does not need to be accessed by all other apps, consider setting a permission on the component declared in the Manifest</p>
</li>
<li>
<p>Data received by public components cannot be trusted and must be scrutinized</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="check_activities">Check Activities</h5>
<div class="ulist">
<ul>
<li>
<p>Activities can ensure proper behavior by checking internal app state to verify they are ready to load</p>
<div class="ulist">
<ul>
<li>
<p>For example, first see if the app is in the "unlocked" state and if not jump back to the lock screen.</p>
</li>
</ul>
</div>
</li>
<li>
<p>input validation is recommended when operating on data provided by an untrusted source</p>
</li>
<li>
<p>Avoid intent filters on Activities if they are private, instead use explicit intent</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="use_broadcasts_carefully">Use Broadcasts Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>Use permissions to protect Intents in your application</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_pendingintents_carefully">Implement PendingIntents Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>Use PendingIntents as delayed callbacks to private BroadcastReceivers or broadcast activities, and explicitly specify the component name in the base Intent</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protect_application_services">Protect Application Services</h5>
<div class="ulist">
<ul>
<li>
<p>When calling a service with sensitive data, validate that the correct service is being called and not a malicious service</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_intent_sniffing">Avoid Intent Sniffing</h5>
<div class="ulist">
<ul>
<li>
<p>Do not pass sensitive data between apps using broadcast intents. Instead, use explicit intents</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implement_content_providers_carefully">Implement Content Providers Carefully</h5>
<div class="ulist">
<ul>
<li>
<p>Do not give a content provider write access unless it&#8217;s absolutely necessary</p>
</li>
<li>
<p>Limit access to the minimum required for an operation</p>
</li>
<li>
<p>Treat parameters passed to content providers as untrusted input and don&#8217;t use them directly in SQL queries without sanitation</p>
</li>
<li>
<p>Content providers that serve files based on a file name being passed to the provider should ensure path traversals are filtered out.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="follow_webview_best_practices">Follow WebView Best Practices</h5>
<div class="ulist">
<ul>
<li>
<p>Disable JavaScript and Plugin support if they are not needed.</p>
</li>
<li>
<p>Disable local file access.</p>
</li>
<li>
<p>Disallow the loading of content from third-party hosts.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_storing_cached_camera_images">Avoid Storing Cached Camera Images</h5>
<div class="ulist">
<ul>
<li>
<p>Do not transmit a check image using non-volatile storage on the device where check image artifacts may be left behind.</p>
<div class="ulist">
<ul>
<li>
<p>Create a SurfaceView that displays a camera preview or live preview of what the camera sensor is seeing</p>
</li>
<li>
<p>Insert and program a button that when pressed returns the camera preview as a pixel array</p>
</li>
<li>
<p>Finally, convert the pixel array to bitmap, compress it to a .jpg, encode it to Base64, and submit it to the remote location</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="avoid_gui_objects_caching">Avoid GUI Objects Caching</h5>
<div class="ulist">
<ul>
<li>
<p>Quit the app entirely when the user logs out.</p>
</li>
<li>
<p>Any time an activity is initiated or a screen is accessed, execute a check to determine whether the user is in a logged-in state</p>
</li>
<li>
<p>Nullify the data on a GUI screen before leaving the screen or logging out</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sign_android_apks">Sign Android APKs</h5>
<div class="ulist">
<ul>
<li>
<p>Sign a production app with a production certificate, not a debug certificate</p>
</li>
<li>
<p>Make sure the certificate includes a sufficient validity period (i.e., won&#8217;t expire during the expected lifespan of the app)</p>
</li>
<li>
<p>Google recommends that your certificate use at least 2048-bit encryption</p>
</li>
<li>
<p>Make sure the keystore containing the signing key is properly protected</p>
</li>
<li>
<p>Also, restrict access to the keystore to only those people that absolutely require it</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="servers">2.17.7. Servers</h4>
<div class="sect4">
<h5 id="implement_proper_web_server_configuration">Implement Proper Web Server Configuration</h5>
<div class="ulist">
<ul>
<li>
<p>disable verbose errors</p>
</li>
<li>
<p>return the minimum amount of information in server responses.</p>
</li>
<li>
<p>change any default directories.</p>
</li>
<li>
<p>Administration or other restricted areas should not be publicly web-accessible unless absolutely necessary, and must be resistant to brute force attacks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="properly_configure_server_side_ssl">Properly Configure Server-side SSL</h5>
<div class="ulist">
<ul>
<li>
<p>Ensure SSL certificates are properly installed and configured for the highest encryption possible.</p>
</li>
<li>
<p>TLSv1 is more than 10 years old and was found vulnerable to a “renegotiation attack” in 2009</p>
</li>
<li>
<p>Avoid weak ciphers, such as:</p>
<div class="ulist">
<ul>
<li>
<p>NULL cipher suite</p>
</li>
<li>
<p>Anonymous Diffie-Hellmann</p>
</li>
<li>
<p>DES and RC4 because of their vulnerability to crypto-analytical attacks (NOTE: iOS 10 disables RC4 by default)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Avoid weak protocols, such as:</p>
<div class="ulist">
<ul>
<li>
<p>SSLv2</p>
</li>
<li>
<p>SSLv3 because of its vulnerability to the POODLE attack - CVE-2014-3566 (NOTE: In iOS 10, the Apple Secure Transport API no longer supports SSLv3)</p>
</li>
<li>
<p>TLS 1.0 and earlier because the protocols are vulnerable to the CRIME</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="use_proper_session_management">Use Proper Session Management</h5>
<div class="ulist">
<ul>
<li>
<p>Web languages (e.g. Java, .NET) offer session management, which is well-developed and security tested</p>
</li>
<li>
<p>Keep server software up-to-date with security patches</p>
</li>
<li>
<p>Ensure the size of the session cookie is sufficient</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protect_and_pen_test_web_services">Protect and Pen Test Web Services</h5>
<div class="ulist">
<ul>
<li>
<p>web server must be thoroughly tested and hardened against malicious attack</p>
</li>
<li>
<p>Production server software should be updated to the latest versions, and hardened to prevent information disclosures regarding server software and interfaces</p>
</li>
<li>
<p>Authentication forms should not reflect whether a username exists</p>
</li>
<li>
<p>All login forms and forms/pages exchanging sensitive data should implement and require HTTPS</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protect_internal_resources">Protect Internal Resources</h5>
<div class="ulist">
<ul>
<li>
<p>should be blocked from external access.</p>
</li>
<li>
<p>Any resource that does not require public Internet access should be restricted using firewall rules and network segmentation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-10-18 09:46:44 IST
</div>
</div>
</body>
</html>